"use strict";(self.webpackChunkhome=self.webpackChunkhome||[]).push([[787],{9205:(rn,Pe,$)=>{$.d(Pe,{$:()=>ee});var U=$(7788),P=$(6359),re=$(5293),D=$(6610),u=$(2919);const L=["container"];function O(oe,d){if(1&oe&&(U.qex(0),U.nrm(1,"nge-monaco-viewer",1),U.nI1(2,"json"),U.bVm()),2&oe){const K=U.XpG();U.R7$(),U.Y8G("code",U.bMT(2,1,K.state))}}let ee=(()=>{class oe{constructor(K,k){this.api=K,this.elementRef=k,this.stateChange=new U.bkB}ngOnInit(){const K=this.elementRef.nativeElement;K.parentElement?.setAttribute("id",(0,re.A)());const k=K.parentElement?.tagName.toLowerCase();this.definition=this.api.findBySelector(k||""),this.observer=new MutationObserver(H=>{H.forEach(this.onChangeAttributes.bind(this,!1))}),this.observer.observe(K.parentElement,{attributes:!0}),this.onChangeAttributes(!0)}ngOnDestroy(){this.observer?.disconnect()}parseValue(K){return K.trim().match(/^(true$|false$|\d+$|\[|\{)/)?JSON.parse(K):K}onChangeAttributes(K){const N=Array.from(this.elementRef.nativeElement.parentElement.attributes),ue=N.find(z=>"cid"===z.name);if(ue){const z=sessionStorage.getItem("component-"+ue.value);if(z)return void this.stateChange.emit(this.parseValue(z))}const ce=N.find(z=>"data-script-id"===z.name);if(ce){const z=document.querySelector(`script[id="${ce.value}"]`);return void(z&&this.stateChange.emit(this.parseValue(z.textContent||"{}")))}if(N.find(z=>"state"===z.name)&&K)return;const sn={},Wn=this.definition?.schema?.properties||{};let on=!1;for(const z of N)if(z.name in Wn){on=!0;try{sn[z.name]=this.parseValue(z.value)}catch{console.warn(`Invalid value "${z.value}" for ${z.name} attribute`)}}on&&this.stateChange.emit(sn)}static#e=this.\u0275fac=function(k){return new(k||oe)(U.rXU(P.h),U.rXU(U.aKT))};static#t=this.\u0275cmp=U.VBU({type:oe,selectors:[["wc-base"]],viewQuery:function(k,H){if(1&k&&U.GBs(L,5),2&k){let N;U.mGM(N=U.lsd())&&(H.container=N.first)}},inputs:{state:"state"},outputs:{stateChange:"stateChange"},decls:1,vars:1,consts:[[4,"ngIf"],["language","json",3,"code"]],template:function(k,H){1&k&&U.DNE(0,O,3,3,"ng-container",0),2&k&&U.Y8G("ngIf",null==H.state?null:H.state.debug)},dependencies:[D.bT,u.x1,D.TG],styles:["[_nghost-%COMP%]{display:block;margin:.5rem 0}div[_ngcontent-%COMP%]{display:none}"]})}return oe})()},1016:(rn,Pe,$)=>{$.d(Pe,{W:()=>D});var U=$(6610),P=$(2919),re=$(7788);let D=(()=>{class u{static#e=this.\u0275fac=function(ee){return new(ee||u)};static#t=this.\u0275mod=re.$C({type:u});static#n=this.\u0275inj=re.G2t({imports:[U.MD,P.OZ,U.MD]})}return u})()},6223:(rn,Pe,$)=>{$.d(Pe,{D:()=>D});var U=$(6394),P=$(7788),re=$(5689);let D=(()=>{class u{batch(O,ee){const oe=O.$__suspendChanges__$;O.$__suspendChanges__$=!0,ee(),O.onChangeState&&O.onChangeState(),O.$__changeDetector__$||(O.$__changeDetector__$=O.injector.get(P.gRc)),O.$__changeDetector__$.detectChanges(),O.$__suspendChanges__$=oe}ignore(O,ee){return(0,U.A)(function*(){const oe=O.$__suspendChanges__$;O.$__suspendChanges__$=!0;const d=yield ee();return O.$__changeDetector__$||(O.$__changeDetector__$=O.injector.get(P.gRc)),O.$__changeDetector__$.detectChanges(),O.$__suspendChanges__$=oe,d})()}changes(O){if(!O.$__stateCopy__$)return O.$__stateCopy__$=(0,re.A4)(O.$__state__$),[];const ee=[];return new Set(Object.keys(O.$__state__$).concat(Object.keys(O.$__stateCopy__$))).forEach(d=>{(0,re.bD)(O.$__state__$[d],O.$__stateCopy__$[d])||ee.push(d)}),O.$__stateCopy__$=(0,re.A4)(O.$__state__$),ee}static#e=this.\u0275fac=function(ee){return new(ee||u)};static#t=this.\u0275prov=P.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},8500:(rn,Pe,$)=>{function U(s){return(U="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(s)}function P(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function re(s,o){for(var n=0;n<o.length;n++){var i=o[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,i.key,i)}}function D(s,o,n){return o&&re(s.prototype,o),n&&re(s,n),s}function u(s,o,n){return o in s?Object.defineProperty(s,o,{value:n,enumerable:!0,configurable:!0,writable:!0}):s[o]=n,s}function L(s,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),o&&ee(s,o)}function O(s){return(O=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(s)}function ee(s,o){return(ee=Object.setPrototypeOf||function(i,e){return i.__proto__=e,i})(s,o)}function d(s){if(void 0===s)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function k(s){var o=function oe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var e,i=O(s);if(o){var t=O(this).constructor;e=Reflect.construct(i,arguments,t)}else e=i.apply(this,arguments);return function K(s,o){return!o||"object"!=typeof o&&"function"!=typeof o?d(s):o}(this,e)}}function N(s,o,n){return N=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(e,t,r){var a=function H(s,o){for(;!Object.prototype.hasOwnProperty.call(s,o)&&null!==(s=O(s)););return s}(e,t);if(a){var l=Object.getOwnPropertyDescriptor(a,t);return l.get?l.get.call(r):l.value}},N(s,o,n||s)}function ue(s,o){return function sn(s){if(Array.isArray(s))return s}(s)||function on(s,o){var n=null==s?null:typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"];if(null!=n){var r,a,i=[],e=!0,t=!1;try{for(n=n.call(s);!(e=(r=n.next()).done)&&(i.push(r.value),!o||i.length!==o);e=!0);}catch(l){t=!0,a=l}finally{try{!e&&null!=n.return&&n.return()}finally{if(t)throw a}}return i}}(s,o)||z(s,o)||function uo(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ce(s){return function er(s){if(Array.isArray(s))return $n(s)}(s)||function Wn(s){if(typeof Symbol<"u"&&null!=s[Symbol.iterator]||null!=s["@@iterator"])return Array.from(s)}(s)||z(s)||function lo(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function z(s,o){if(s){if("string"==typeof s)return $n(s,o);var n=Object.prototype.toString.call(s).slice(8,-1);if("Object"===n&&s.constructor&&(n=s.constructor.name),"Map"===n||"Set"===n)return Array.from(s);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $n(s,o)}}function $n(s,o){(null==o||o>s.length)&&(o=s.length);for(var n=0,i=new Array(o);n<o;n++)i[n]=s[n];return i}function Ke(s,o,n){return"*"===s||(s.length>0?-1!==s.indexOf(o):!n)}function M(s,o,n){var i,e=s=s||{},t=o=o||{};if(n)for(i=0;i<n.length;i++)e[n[i]]=t[n[i]];else for(i in t)e[i]=t[i];return s}function an(s){return"[object Number]"===Object.prototype.toString.call(s)}function Y(s){return"string"==typeof s}function Kn(s){return"boolean"==typeof s}function Ne(s){return null!=s&&"[object Object]"===Object.prototype.toString.call(s)}function Re(s){return"[object Function]"===Object.prototype.toString.call(s)}function ln(s){if(Y(s))return""+s;if(Kn(s))return!!s;if(function co(s){return"[object Date]"===Object.prototype.toString.call(s)}(s))return new Date(s.getTime());if(Re(s))return s;if(Array.isArray(s)){for(var o=[],n=0;n<s.length;n++)o.push(ln(s[n]));return o}if(Ne(s)){var i={};for(var e in s)i[e]=ln(s[e]);return i}return s}function un(s,o,n,i){var t,r,e={},a={};for(n=n||[],i=i||[],r=0;r<n.length;r++)e[n[r]]=!0;for(r=0;r<i.length;r++)a[i[r]]=!0;var l=ln(s);for(r in o)if(null==l[r]||a[r])l[r]=o[r];else if(e[r])(t=[]).push.apply(t,Array.isArray(l[r])?l[r]:[l[r]]),t.push(o[r]),l[r]=t;else if(Y(o[r])||Kn(o[r])||Re(o[r])||an(o[r]))l[r]=o[r];else if(Array.isArray(o[r]))t=[],Array.isArray(l[r])&&t.push.apply(t,l[r]),t.push.apply(t,o[r]),l[r]=t;else if(Ne(o[r]))for(var c in Ne(l[r])||(l[r]={}),o[r])l[r][c]=o[r][c];return l}function nr(s,o,n){for(var i=0;i<n.length;i++){var e=n[i][0][n[i][1]].apply(n[i][0],n[i][2]);if(e===o)return e}return s}function I(s,o){if(!s)return null;for(var n=0;n<s.length;n++)o(s[n])}function Te(s,o){if(s)for(var n=0;n<s.length;n++)if(o(s[n]))return n;return-1}function zn(s,o){var n=Te(s,o);return-1===n?null:s[n]}function ir(s,o){var n=null;return s.forEach(function(i){o(i)&&(n=i)}),n}function J(s,o){var n=Te(s,o);return n>-1&&s.splice(n,1),-1!==n}function cn(s){if(null!=Array.fromArray)return Array.from(s);var o=[];return Array.prototype.push.apply(o,s),o}function rr(s,o){var n=s.indexOf(o);return n>-1&&s.splice(n,1),-1!==n}function sr(s,o,n,i){var e=s[o];return null==e&&(s[o]=e=[]),e[i?"unshift":"push"](n),e}function wt(s,o,n){return-1===s.indexOf(o)&&(n?s.unshift(o):s.push(o),!0)}$.d(Pe,{Gc4:()=>Pc,UIf:()=>Sc,bIo:()=>wr,p3_:()=>mr,rMl:()=>oi,wt:()=>ri,zUE:()=>Rr});for(var te=[],It=0;It<256;It++)te[It]=(It<16?"0":"")+It.toString(16);function q(){var s=4294967295*Math.random()|0,o=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return te[255&s]+te[s>>8&255]+te[s>>16&255]+te[s>>24&255]+"-"+te[255&o]+te[o>>8&255]+"-"+te[o>>16&15|64]+te[o>>24&255]+"-"+te[63&n|128]+te[n>>8&255]+"-"+te[n>>16&255]+te[n>>24&255]+te[255&i]+te[i>>8&255]+te[i>>16&255]+te[i>>24&255]}function Lt(s,o,n){var i_x=s.x-o.x,i_y=s.y-o.y,e=Math.cos(n/360*Math.PI*2),t=Math.sin(n/360*Math.PI*2);return{x:i_x*e-i_y*t+o.x,y:i_y*e+i_x*t+o.y,cr:e,sr:t}}function qn(s){if(null==s)return null;for(var o=s.replace(/^\s\s*/,""),n=/\s/,i=o.length;n.test(o.charAt(--i)););return o.slice(0,i+1)}function or(s,o){for(var n=[],i=0;i<s.length;i++)n.push(o(s[i]));return n}function Z(){for(var s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];if(typeof console<"u")try{console.log(arguments[arguments.length-1])}catch{}}function hn(s){return s<0?-1:s>0?1:0}function fn(s,o,n){return function(){var i=null;try{null!=o&&(i=o.apply(this,arguments))}catch(e){Z("jsPlumb function failed : "+e)}if(null!=s&&(null==n||i!==n))try{i=s.apply(this,arguments)}catch(e){Z("wrapped function failed : "+e)}return i}}function ar(s,o,n){return s.has(o)||s.set(o,n()),s.get(o)}function lr(s,o){for(var n=s.__proto__;null!=n;){if(n instanceof o)return!0;n=n.__proto__}return!1}function ze(s,o,n){for(var i=(n=n||s.parentNode).querySelectorAll(o),e=0;e<i.length;e++)if(i[e]===s)return!0;return!1}function Gt(s,o){s.stopPropagation?s.stopPropagation():s.returnValue=!1,!o&&s.preventDefault&&s.preventDefault()}function Ae(s,o,n,i){if(i&&ze(s,o,n))return s;for(s=s.parentNode;null!=s&&s!==n;){if(ze(s,o))return s;s=s.parentNode}}function fe(s){return s.srcElement||s.target}function Zn(s){return null!=s.className?typeof s.className.baseVal>"u"?s.className:s.className.baseVal:""}function ur(s,o,n){var i=null==o?[]:Array.isArray(o)?o:o.split(/\s+/),e=null==n?[]:Array.isArray(n)?n:n.split(/\s+/),r=Zn(s).split(/\s+/),a=function(c,h){for(var f=0;f<h.length;f++)if(c)-1===r.indexOf(h[f])&&r.push(h[f]);else{var v=r.indexOf(h[f]);-1!==v&&r.splice(v,1)}};a(!0,i),a(!1,e),function Eo(s,o,n){o=qn(o),typeof s.className.baseVal<"u"?s.className.baseVal=o:s.className=o;try{var i=s.classList;if(null!=i){for(;i.length>0;)i.remove(i.item(0));for(var e=0;e<n.length;e++)n[e]&&i.add(n[e])}}catch(t){Z("WARN: cannot set class list",t)}}(s,r.join(" "),r)}function ut(s){return!Y(s)&&!Array.isArray(s)&&null!=s.length&&null==s.documentElement&&null==s.nodeType}function qe(s,o){var n=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?I(qn(t).split(/\s+/),function(a){e.classList.add(a)}):ur(e,t))};ut(s)?I(s,function(i){return n(i,o)}):n(s,o)}function Jn(s,o){var n=function(e,t){null!=e&&null!=t&&t.length>0&&(e.classList?qn(t).split(/\s+/).forEach(function(a){e.classList.remove(a)}):ur(e,null,t))};ut(s)?I(s,function(i){return n(i,o)}):n(s,o)}function cr(s,o,n,i){return hr(null,s,o,n,i)}function hr(s,o,n,i,e){var r,t=null==s?document.createElement(o):document.createElementNS(s,o);for(r in n=n||{})t.style[r]=n[r];for(r in i&&(t.className=i),e=e||{})t.setAttribute(r,""+e[r]);return t}function ct(s){var o=s.getBoundingClientRect(),n=document.body,i=document.documentElement,e=window.pageYOffset||i.scrollTop||n.scrollTop,t=window.pageXOffset||i.scrollLeft||n.scrollLeft,l=o.top+e-(i.clientTop||n.clientTop||0);return{x:Math.round(o.left+t-(i.clientLeft||n.clientLeft||0)),y:Math.round(l)}}function dn(s,o){var n=o.getContainer().getBoundingClientRect(),i=s.getBoundingClientRect(),e=o.currentZoom;return{x:(i.left-n.left)/e,y:(i.top-n.top)/e}}function Nt(s,o){var n=s.getBoundingClientRect(),i=o.currentZoom;return{w:n.width/i,h:n.height/i}}var ht=function(s){return s.SVG="SVG",s.HTML="HTML",s}(ht||{});function Qn(s){return s instanceof SVGElement?ht.SVG:ht.HTML}function Ze(){for(var s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return o.map(function(i){return"."+i}).join(",")}function vn(){for(var s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return o.map(function(i){return"["+i+"]"}).join(",")}var ei="source",ti="block",ft="none",Rt="absolute",vr="data-jtk-group",Fe="data-jtk-managed",pn="data-jtk-not-draggable",pr="tabindex",gr="data-jtk-scope-",yr="checkCondition",ni="jtk-connector",dt="jtk-endpoint",ii="jtk-floating-endpoint",gn="jtk-group-collapsed",Ft="jtk-group-expanded",yn="jtk-overlay",ri="connection",_r="internal.connection",mr="connection:detach",Er="connection:move",Cr="internal.endpoint:unregistered",si="internal.connection:detached",xr="element:manage",br="maxConnections",kr="element:unmanage",vt="isDetachAllowed",oi="beforeDrop",Pr="beforeDetach",X=vn(Fe),Tr={"stroke-linejoin":"stroke-linejoin","stroke-dashoffset":"stroke-dashoffset","stroke-linecap":"stroke-linecap"},jt="stroke-dasharray",ai="dashstyle",ia="fill",ra="stroke",sa="stroke-width",oa="strokeWidth",li="path",ui={svg:"http://www.w3.org/2000/svg"};function Ee(s,o){for(var n in o)s.setAttribute(n,""+o[n])}function Ce(s,o){return(o=o||{}).version="1.1",o.xmlns=ui.svg,hr(ui.svg,s,null,null,o)}function Or(s){return"position:absolute;left:"+s[0]+"px;top:"+s[1]+"px"}function ci(s,o,n){if(o.setAttribute(ia,n.fill?n.fill:ft),o.setAttribute(ra,n.stroke?n.stroke:ft),n.strokeWidth&&o.setAttribute(sa,n.strokeWidth),n[ai]&&n[oa]&&!n[jt]){var i=-1===n[ai].indexOf(",")?" ":",",e=n[ai].split(i),t="";I(e,function(a){t+=Math.floor(a*n.strokeWidth)+i}),o.setAttribute(jt,t)}else n[jt]&&o.setAttribute(jt,n[jt]);for(var r in Tr)n[r]&&o.setAttribute(Tr[r],n[r])}function _n(s,o,n){s.childNodes.length>n?s.insertBefore(o,s.childNodes[n]):s.appendChild(o)}function V(s,o,n){var i=[s,o];return n&&i.push(n),i.join(":")}var Ht,Ut,Dr="data-jtk-container",mn="data-jtk-enabled",hi="data-jtk-scope",Oe="endpoint",xe="element",be="connection",ae="click",De="contextmenu",de="dblclick",ve="dbltap",F="mousedown",fi="mouseenter",di="mouseexit",Q="mousemove",j="mouseup",pe="mouseout",ge="mouseover",ye="tap",wr="drag:stop",En="revert",Ir="connection:drag",Lr=V(xe,ae),pa=V(xe,de),Gr=V(xe,ve),ga=V(xe,pe),ya=V(xe,ge),_a=V(xe,Q),ma=V(xe,j),Ea=V(xe,F),Ca=V(xe,De),Nr=V(xe,ye),xa=V(Oe,ae),ba=V(Oe,de),ka=(V(Oe,ve),V(Oe,pe)),Sa=V(Oe,ge),Pa=V(Oe,j),Ta=V(Oe,F),Rr=(V(Oe,ye),V(be,ae)),Aa=V(be,de),Oa=V(be,ve),Da=V(be,pe),Ma=V(be,ge),wa=V(be,j),Ia=V(be,F),La=V(be,De),Ga=V(be,ye),Fr="position",_e=Ze(ni),Je=Ze(dt),Na=vn(vr),Ra=vn("data-jtk-group-content"),Me=Ze(yn),Qe=function(s){return s.Circle="Circle",s.Ellipse="Ellipse",s.Triangle="Triangle",s.Diamond="Diamond",s.Rectangle="Rectangle",s.Square="Square",s}(Qe||{}),we=function(s){return s.Assign="Assign",s.AutoDefault="AutoDefault",s.Bottom="Bottom",s.BottomLeft="BottomLeft",s.BottomRight="BottomRight",s.Center="Center",s.Continuous="Continuous",s.ContinuousBottom="ContinuousBottom",s.ContinuousLeft="ContinuousLeft",s.ContinuousRight="ContinuousRight",s.ContinuousTop="ContinuousTop",s.ContinuousLeftRight="ContinuousLeftRight",s.ContinuousTopBottom="ContinuousTopBottom",s.Left="Left",s.Perimeter="Perimeter",s.Right="Right",s.Top="Top",s.TopLeft="TopLeft",s.TopRight="TopRight",s}(we||{}),vi=function(){function s(o){P(this,s),this.params=o,u(this,"x1",void 0),u(this,"x2",void 0),u(this,"y1",void 0),u(this,"y2",void 0),u(this,"extents",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),u(this,"type",void 0),this.x1=o.x1,this.y1=o.y1,this.x2=o.x2,this.y2=o.y2}return D(s,[{key:"findClosestPointOnPath",value:function(n,i){return{d:1/0,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(n,i,e,t){return[]}},{key:"boxIntersection",value:function(n,i,e,t){var r=[];return r.push.apply(r,this.lineIntersection(n,i,n+e,i)),r.push.apply(r,this.lineIntersection(n+e,i,n+e,i+t)),r.push.apply(r,this.lineIntersection(n+e,i+t,n,i+t)),r.push.apply(r,this.lineIntersection(n,i+t,n,i)),r}},{key:"boundingBoxIntersection",value:function(n){return this.boxIntersection(n.x,n.y,n.w,n.h)}}]),s}(),jr="undefined",xn="default",pt="false";function gt(s,o,n){for(var i=(n=n||s.parentNode).querySelectorAll(o),e=0;e<i.length;e++)if(i[e]===s)return!0;return!1}function Vt(s){return s.srcElement||s.target}function pi(s,o,n,i){if(i){var e=s.composedPath?s.composedPath():s.path;if(typeof e<"u"&&e.indexOf)return{path:e,end:e.indexOf(n)};var t={path:[],end:-1};return function a(l){t.path.push(l),l===n?t.end=t.path.length-1:null!=l.parentNode&&a(l.parentNode)}(o),t}return{path:[o],end:1}}var Ba=1,Ur=!1;function Bt(){return Ur||"ontouchstart"in document.documentElement||null!=navigator.maxTouchPoints&&navigator.maxTouchPoints>0}function bn(){return"onmousedown"in document.documentElement}var Ie=(u(Ht={},F,"touchstart"),u(Ht,j,"touchend"),u(Ht,Q,"touchmove"),Ht),Ya="page";function gi(s,o){if(null==s)return{x:0,y:0};var i=function Br(s,o){return s.item?s.item(o):s[o]}(yi(s),0);return{x:i[o+"X"],y:i[o+"Y"]}}function kn(s){return gi(s,Ya)}function yi(s){return s.touches&&s.touches.length>0?s.touches:s.changedTouches&&s.changedTouches.length>0?s.changedTouches:s.targetTouches&&s.targetTouches.length>0?s.targetTouches:[s]}function Sn(s,o,n,i,e){if(Xr(s,o,n),i.__tauid=n.__tauid,s.addEventListener)s.addEventListener(o,n,!1,e);else if(s.attachEvent){var t=o+n.__tauid;s["e"+t]=n,s[t]=function(){s["e"+t]&&s["e"+t](window.event)},s.attachEvent("on"+o,s[t])}}function Yt(s,o,n){var i=this;null!=n&&Yr(s,function(e){if(function qa(s,o,n){if(s.__ta&&s.__ta[o]&&delete s.__ta[o][n.__tauid],n.__taExtra){for(var i=0;i<n.__taExtra.length;i++)Yt(s,n.__taExtra[i][0],n.__taExtra[i][1]);n.__taExtra.length=0}n.__taUnstore&&n.__taUnstore()}(e,o,n),null!=n.__tauid)if(e.removeEventListener)e.removeEventListener(o,n,!1),Bt()&&Ie[o]&&e.removeEventListener(Ie[o],n,!1);else if(i.detachEvent){var t=o+n.__tauid;e[t]&&e.detachEvent("on"+o,e[t]),e[t]=null,e["e"+t]=null}n.__taTouchProxy&&Yt(s,n.__taTouchProxy[1],n.__taTouchProxy[0])})}function Yr(s,o){if(null!=s)for(var n="string"==typeof s?document.querySelectorAll(s):null!=s.length?s:[s],i=0;i<n.length;i++)o(n[i])}function Xr(s,o,n){var i=Ba++;return s.__ta=s.__ta||{},s.__ta[o]=s.__ta[o]||{},s.__ta[o][i]=n,n.__tauid=i,i}var Za=/:not\(([^)]+)\)/;function Pn(s,o,n,i){if(null==s)return n;var e=s.split(","),t=[],r=[];I(e,function(l){var c=l.match(Za);null!=c?r.push(c[1]):t.push(l)}),r.length>0&&0===t.length&&t.push("*");var a=function l(c){l.__tauid=n.__tauid;var h=Vt(c),f=!1,v=h,p=pi(c,h,o,null!=s);if(-1!=p.end)for(var g=0;!f&&g<p.end;g++){v=p.path[g];for(var _=0;_<r.length;_++)if(gt(v,r[_],o))return;for(var y=0;!f&&y<t.length;y++)if(gt(v,t[y],o)){n.apply(v,[c,v]),f=!0;break}}};return function Ja(s,o,n){s.__taExtra=s.__taExtra||[],s.__taExtra.push([o,n])}(n,i,a),a}var Tn=function(o,n,i,e,t){if(Bt()&&Ie[n]){var r=Pn(e,o,i,Ie[n]);Sn(o,Ie[n],r,i,t)}"focus"===n&&null==o.getAttribute(pr)&&o.setAttribute(pr,"1"),Sn(o,n,Pn(e,o,i,n),i,t)},_i=(u(Ut={},ye,{touches:1,taps:1}),u(Ut,ve,{touches:1,taps:2}),u(Ut,De,{touches:2,taps:1}),Ut);function Wr(s,o,n,i){for(var e in n.__tamee[s])n.__tamee[s].hasOwnProperty(e)&&n.__tamee[s][e].apply(i,[o])}var Qa=function(){function s(){P(this,s)}return D(s,null,[{key:"generate",value:function(n,i){return function(e,t,r,a){if(t==De&&bn())Tn(e,t,r,a);else{if(null==e.__taTapHandler){var l=e.__taTapHandler={tap:[],dbltap:[],down:!1,taps:0,downSelectors:[]},c=function(g){for(var _=Vt(g),y=pi(g,_,e,null!=a),m=!1,E=0;E<y.end;E++){if(m)return;_=y.path[E];for(var C=0;C<l.downSelectors.length;C++)if(null==l.downSelectors[C]||gt(_,l.downSelectors[C],e)){l.down=!0,setTimeout(f,n),setTimeout(v,i),m=!0;break}}},h=function(g){if(l.down){var y,m,_=Vt(g);l.taps++;var E=function za(s){return yi(s).length}(g);for(var C in _i)if(_i.hasOwnProperty(C)){var b=_i[C];if(b.touches===E&&(1===b.taps||b.taps===l.taps))for(var A=0;A<l[C].length;A++){m=pi(g,_,e,null!=l[C][A][1]);for(var w=0;w<m.end;w++)if(y=m.path[w],null==l[C][A][1]||gt(y,l[C][A][1],e)){l[C][A][0].apply(y,[g,y]);break}}}}},f=function(){l.down=!1},v=function(){l.taps=0};e.__taTapHandler.downHandler=c,e.__taTapHandler.upHandler=h,Tn(e,F,c),Tn(e,j,h)}e.__taTapHandler.downSelectors.push(a),e.__taTapHandler[t].push([r,a]),r.__taUnstore=function(){null!=e.__taTapHandler&&(J(e.__taTapHandler.downSelectors,function(p){return p===a}),function Va(s,o){var i,n=0;for(n=0,i=s.length;n<i&&s[n][0]!==o;n++);n<s.length&&s.splice(n,1)}(e.__taTapHandler[t],r),0===e.__taTapHandler.downSelectors.length&&(Yt(e,F,e.__taTapHandler.downHandler),Yt(e,j,e.__taTapHandler.upHandler),delete e.__taTapHandler))}}}}}]),s}(),el=function(){function s(){P(this,s)}return D(s,null,[{key:"generate",value:function(){var n=[];return function(i,e,t,r){if(!i.__tamee){i.__tamee={over:!1,mouseenter:[],mouseexit:[]};var a=function(h){var f=Vt(h);(null==r&&f==i&&!i.__tamee.over||gt(f,r,i)&&(null==f.__tamee||!f.__tamee.over))&&(Wr(fi,h,i,f),f.__tamee=f.__tamee||{},f.__tamee.over=!0,n.push(f))},l=function(h){for(var f=Vt(h),v=0;v<n.length;v++)f==n[v]&&!gt(h.relatedTarget||h.toElement,"*",f)&&(f.__tamee.over=!1,n.splice(v,1),Wr(di,h,i,f))};Sn(i,ge,Pn(r,i,a,ge),a),Sn(i,pe,Pn(r,i,l,pe),l)}t.__taUnstore=function(){delete i.__tamee[e][t.__tauid]},Xr(i,e,t),i.__tamee[e][t.__tauid]=t}}}]),s}(),mi=function(){function s(o){P(this,s),u(this,"clickThreshold",void 0),u(this,"dblClickThreshold",void 0),u(this,"tapHandler",void 0),u(this,"mouseEnterExitHandler",void 0),this.clickThreshold=(o=o||{}).clickThreshold||250,this.dblClickThreshold=o.dblClickThreshold||450,this.mouseEnterExitHandler=el.generate(),this.tapHandler=Qa.generate(this.clickThreshold,this.dblClickThreshold)}return D(s,[{key:"_doBind",value:function(n,i,e,t,r){if(null!=e){var a=n;i===ye||i===ve||i===De?this.tapHandler(a,i,e,t,r):i===fi||i==di?this.mouseEnterExitHandler(a,i,e,t,r):Tn(a,i,e,t,r)}}},{key:"on",value:function(n,i,e,t,r){return this._doBind(n,i,t??e,null==t?null:e,r),this}},{key:"off",value:function(n,i,e){return Yt(n,i,e),this}},{key:"trigger",value:function(n,i,e,t,r){var a=bn()&&(typeof MouseEvent>"u"||null==e||e.constructor===MouseEvent),l=Bt()&&!bn()&&Ie[i]?Ie[i]:i,c=!(Bt()&&!bn()&&Ie[i]),h=kn(e),f=function $a(s){return gi(s,"screen")}(e),v=function Ka(s){return gi(s,"client")}(e);return Yr(n,function(p){var g;e=e||{screenX:f.x,screenY:f.y,clientX:v.x,clientY:v.y};var y={TouchEvent:function(b){var A=function Ua(s,o,n,i,e,t,r){return function Ha(){var s=[];return s.push.apply(s,arguments),s.item=function(o){return this[o]},s}(function ja(s,o,n,i,e,t,r){return new Touch({target:s,identifier:q(),pageX:o,pageY:n,screenX:i,screenY:e,clientX:t||i,clientY:r||e})}(s,o,n,i,e,t,r))}(p,h.x,h.y,f.x,f.y,v.x,v.y);(b.initTouchEvent||b.initEvent)(l,!0,!0,window,null,f.x,f.y,v.x,v.y,!1,!1,!1,!1,A,A,A,1,0)},MouseEvents:function(b){b.initMouseEvent(l,!0,!0,window,r??1,f.x,f.y,v.x,v.y,!1,!1,!1,!1,1,p)}},E=!c&&!a&&Bt()&&Ie[i]?"TouchEvent":"MouseEvents";g=document.createEvent(E),y[E](g),t&&(g.payload=t),p.dispatchEvent(g)}),this}}]),s}(),tl=[null,[1,-1],[1,1],[-1,1],[-1,-1]],nl=[null,[-1,-1],[-1,1],[1,1],[1,-1]],tt=2*Math.PI;function yt(s,o){return o.x===s.x?o.y>s.y?1/0:-1/0:o.y===s.y?o.x>s.x?0:-0:(o.y-s.y)/(o.x-s.x)}function Ei(s,o){return Math.sqrt(Math.pow(o.y-s.y,2)+Math.pow(o.x-s.x,2))}function Ci(s,o){return o.x>s.x||o.x==s.x?o.y>s.y?2:1:o.y>s.y?3:4}function $r(s,o){var n=s.x,i=s.x+s.w,e=s.y,t=s.y+s.h,r=o.x,a=o.x+o.w,l=o.y,c=o.y+o.h;return n<=r&&r<=i&&e<=l&&l<=t||n<=a&&a<=i&&e<=l&&l<=t||n<=r&&r<=i&&e<=c&&c<=t||n<=a&&r<=i&&e<=c&&c<=t||r<=n&&n<=a&&l<=e&&e<=c||r<=i&&i<=a&&l<=e&&e<=c||r<=n&&n<=a&&l<=t&&t<=c||r<=i&&n<=a&&l<=t&&t<=c}function nt(s,o,n){var i=yt(s,o),e=Ci(s,o),t=n>0?tl[e]:nl[e],r=Math.atan(i),a=Math.abs(n*Math.sin(r))*t[1],l=Math.abs(n*Math.cos(r))*t[0];return{x:s.x+l,y:s.y+a}}function ul(s,o,n){if(ze(o,n,s))return o;for(var i=o.parentNode;null!=i&&i!==s;){if(ze(i,n,s))return i;i=i.parentNode}}function zr(s,o,n){var e=s.getSize(o.parentNode),t=s.getSize(o),r=n.x,l=n.y;return r+t.w>0&&r<e.w&&l+t.h>0&&l<e.h}var Zr="beforeStart",xi=function(){return!0},_l=function(){return!1},ke=function(s){return s.absolutePosition="absolutePosition",s.transform="transform",s.xyAttributes="xyAttributes",s}(ke||{}),bi=new Map;bi.set(ke.absolutePosition,function(s,o){s.style.left="".concat(o.x,"px"),s.style.top="".concat(o.y,"px")}),bi.set(ke.xyAttributes,function(s,o){s.setAttribute("x","".concat(o.x)),s.setAttribute("y","".concat(o.y))});var ki=new Map;ki.set(ke.absolutePosition,function(s){return{x:s.offsetLeft,y:s.offsetTop}}),ki.set(ke.xyAttributes,function(s){return{x:parseFloat(s.getAttribute("x")),y:parseFloat(s.getAttribute("y"))}});var Si=new Map;Si.set(ke.absolutePosition,function(s,o){s.style.width="".concat(o.w,"px"),s.style.height="".concat(o.h,"px")}),Si.set(ke.xyAttributes,function(s,o){s.setAttribute("width","".concat(o.w)),s.setAttribute("height","".concat(o.h))});var Pi=new Map;Pi.set(ke.absolutePosition,function(s){return{w:s.offsetWidth,h:s.offsetHeight}}),Pi.set(ke.xyAttributes,function(s){return{w:parseFloat(s.getAttribute("width")),h:parseFloat(s.getAttribute("height"))}});var Et,Ct,xt,Ti=["stop","start","drag","drop","over","out",Zr],ml=function(){},_t=function(o,n){if(null!=o){o=Y(o)||null!=o.tagName||null==o.length?[o]:o;for(var i=0;i<o.length;i++)n.apply(o[i],[o[i]])}},Cl=function(){function s(o,n){P(this,s),this.el=o,this.manager=n,u(this,"_class",void 0),u(this,"uuid",q()),u(this,"enabled",!0),u(this,"scopes",[]),u(this,"eventManager",void 0),this.eventManager=n.eventManager}return D(s,[{key:"setEnabled",value:function(n){this.enabled=n}},{key:"isEnabled",value:function(){return this.enabled}},{key:"toggleEnabled",value:function(){this.enabled=!this.enabled}},{key:"addScope",value:function(n){var i={};for(var e in _t(this.scopes,function(t){i[t]=!0}),_t(n?n.split(/\s+/):[],function(t){i[t]=!0}),this.scopes.length=0,i)this.scopes.push(e)}},{key:"removeScope",value:function(n){var i={};for(var e in _t(this.scopes,function(t){i[t]=!0}),_t(n?n.split(/\s+/):[],function(t){delete i[t]}),this.scopes.length=0,i)this.scopes.push(e)}},{key:"toggleScope",value:function(n){var i={};for(var e in _t(this.scopes,function(t){i[t]=!0}),_t(n?n.split(/\s+/):[],function(t){i[t]?delete i[t]:i[t]=!0}),this.scopes.length=0,i)this.scopes.push(e)}}]),s}(),An=function(s){return s.notNegative="notNegative",s.parent="parent",s.parentEnclosed="parentEnclosed",s}(An||{}),bl=function(s){L(n,s);var o=k(n);function n(i,e,t){var r;if(P(this,n),u(d(r=o.call(this,i,t)),"_class",void 0),u(d(r),"rightButtonCanDrag",void 0),u(d(r),"consumeStartEvent",void 0),u(d(r),"clone",void 0),u(d(r),"scroll",void 0),u(d(r),"trackScroll",void 0),u(d(r),"_downAt",void 0),u(d(r),"_posAtDown",void 0),u(d(r),"_pagePosAtDown",void 0),u(d(r),"_pageDelta",{x:0,y:0}),u(d(r),"_moving",void 0),u(d(r),"_lastPosition",void 0),u(d(r),"_lastScrollValues",{x:0,y:0}),u(d(r),"_initialScroll",{x:0,y:0}),u(d(r),"_size",void 0),u(d(r),"_currentParentPosition",void 0),u(d(r),"_ghostParentPosition",void 0),u(d(r),"_dragEl",void 0),u(d(r),"_multipleDrop",void 0),u(d(r),"_ghostProxyOffsets",void 0),u(d(r),"_ghostDx",void 0),u(d(r),"_ghostDy",void 0),u(d(r),"_isConstrained",!1),u(d(r),"_ghostProxyParent",void 0),u(d(r),"_useGhostProxy",void 0),u(d(r),"_ghostProxyFunction",void 0),u(d(r),"_activeSelectorParams",void 0),u(d(r),"_availableSelectors",[]),u(d(r),"_canDrag",void 0),u(d(r),"_consumeFilteredEvents",void 0),u(d(r),"_parent",void 0),u(d(r),"_ignoreZoom",void 0),u(d(r),"_filters",{}),u(d(r),"_constrainRect",void 0),u(d(r),"_elementToDrag",void 0),u(d(r),"downListener",void 0),u(d(r),"moveListener",void 0),u(d(r),"upListener",void 0),u(d(r),"scrollTracker",void 0),u(d(r),"listeners",{start:[],drag:[],stop:[],over:[],out:[],beforeStart:[],revert:[]}),r._class=r.manager.css.draggable,qe(r.el,r._class),r.downListener=r._downListener.bind(d(r)),r.upListener=r._upListener.bind(d(r)),r.moveListener=r._moveListener.bind(d(r)),r.rightButtonCanDrag=!0===e.rightButtonCanDrag,r.consumeStartEvent=!1!==e.consumeStartEvent,r._dragEl=r.el,r.clone=!0===e.clone,r.scroll=!0===e.scroll,r.trackScroll=!1!==e.trackScroll,r._multipleDrop=!1!==e.multipleDrop,r._canDrag=e.canDrag||xi,r._consumeFilteredEvents=e.consumeFilteredEvents,r._parent=e.parent,r._ignoreZoom=!0===e.ignoreZoom,r._ghostProxyParent=e.ghostProxyParent,r.trackScroll&&(r.scrollTracker=r._trackScroll.bind(d(r)),document.addEventListener("scroll",r.scrollTracker)),r._useGhostProxy=!0===e.ghostProxy?xi:e.ghostProxy&&"function"==typeof e.ghostProxy?e.ghostProxy:function(l,c){return!(!r._activeSelectorParams||!r._activeSelectorParams.useGhostProxy)&&r._activeSelectorParams.useGhostProxy(l,c)},r._ghostProxyFunction=e.makeGhostProxy?e.makeGhostProxy:function(l){return r._activeSelectorParams&&r._activeSelectorParams.makeGhostProxy?r._activeSelectorParams.makeGhostProxy(l):l.cloneNode(!0)},e.selector){var a=r.el.getAttribute("katavorio-draggable");null==a&&(a=""+(new Date).getTime(),r.el.setAttribute("katavorio-draggable",a)),r._availableSelectors.push(e)}return r.eventManager.on(r.el,F,r.downListener),r}return D(n,[{key:"_trackScroll",value:function(e){if(this._moving){var t={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},l={x:t.x-this._lastScrollValues.x+this._lastPosition.x,y:t.y-this._lastScrollValues.y+this._lastPosition.y},c=l.x-this._downAt.x,h=l.y-this._downAt.y,f=this._ignoreZoom?1:this.manager.getZoom();this._dragEl&&this._dragEl.parentNode&&(c+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,h+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),this.moveBy(c/=f,h/=f,e),this._lastPosition=l,this._lastScrollValues=t}}},{key:"on",value:function(e,t){this.listeners[e]&&this.listeners[e].push(t)}},{key:"off",value:function(e,t){if(this.listeners[e]){for(var r=[],a=0;a<this.listeners[e].length;a++)this.listeners[e][a]!==t&&r.push(this.listeners[e][a]);this.listeners[e]=r}}},{key:"_upListener",value:function(e){this._downAt&&(this._downAt=null,this.eventManager.off(document,Q,this.moveListener),this.eventManager.off(document,j,this.upListener),Jn(document.body,"katavorio-drag-no-select"),this.unmark(e),this.stop(e),this._moving=!1,this.clone?(this._dragEl&&this._dragEl.parentNode&&this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=null):this._activeSelectorParams&&this._activeSelectorParams.revertFunction&&!0===this._activeSelectorParams.revertFunction(this._dragEl,this.manager.getPosition(this._dragEl))&&(this.manager.setPosition(this._dragEl,this._posAtDown),this._dispatch(En,this._dragEl)))}},{key:"_downListener",value:function(e){if(!e.defaultPrevented&&(this.rightButtonCanDrag||3!==e.which&&2!==e.button)&&this.isEnabled()&&this._canDrag()){var r=this._testFilter(e)&&function(o,n,i){return!ze(o.srcElement||o.target,i.getInputFilterSelector(),n)}(e,this.el,this.manager);if(r){this._activeSelectorParams=null,this._elementToDrag=null,0===this._availableSelectors.length&&console.log("JSPLUMB: no available drag selectors");var l=function hl(s,o,n){for(var i=null,e=o.getAttribute("katavorio-draggable"),t=null!=e?"[katavorio-draggable='"+e+"'] ":"",r=0;r<s.length;r++)if(null!=(i=ul(o,n,t+s[r].selector))){if(s[r].filter){var a=ze(n,s[r].filter,i);if(!0===s[r].filterExclude&&!a||a)return null}return[s[r],i]}return null}(this._availableSelectors,this.el,e.target||e.srcElement);if(null!=l&&(this._activeSelectorParams=l[0],this._elementToDrag=l[1]),null==this._activeSelectorParams||null==this._elementToDrag)return;var c=this._activeSelectorParams.dragInit?this._activeSelectorParams.dragInit(this._elementToDrag,e):null;if(null!=c&&(this._elementToDrag=c),this.clone)if(this._dragEl=this._elementToDrag.cloneNode(!0),qe(this._dragEl,"katavorio-clone-drag"),this._dragEl.setAttribute("id",null),this._dragEl.style.position="absolute",null!=this._parent){var h=this.manager.getPosition(this.el);this._dragEl.style.left=h.x+"px",this._dragEl.style.top=h.y+"px",this._parent.appendChild(this._dragEl)}else{var f=ct(this._elementToDrag);this._dragEl.style.left=f.x+"px",this._dragEl.style.top=f.y+"px",document.body.appendChild(this._dragEl)}else this._dragEl=this._elementToDrag;this.consumeStartEvent&&Gt(e),this._downAt=kn(e),this._dragEl&&this._dragEl.parentNode&&(this._initialScroll={x:this._dragEl.parentNode.scrollLeft,y:this._dragEl.parentNode.scrollTop}),this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=ct(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),this.eventManager.on(document,Q,this.moveListener),this.eventManager.on(document,j,this.upListener),qe(document.body,"katavorio-drag-no-select"),this._dispatch(Zr,{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size})}else this._consumeFilteredEvents&&Gt(e)}}},{key:"_moveListener",value:function(e){if(this._downAt){if(!this._moving){var t=this._dispatch("start",{el:this.el,pos:this._posAtDown,e,drag:this,size:this._size});if(!1!==t){if(!this._downAt)return;this.mark(t),this._moving=!0}else this.abort()}if(this._downAt){var r=kn(e),a=r.x-this._downAt.x,l=r.y-this._downAt.y,c=this._ignoreZoom?1:this.manager.getZoom();this._lastPosition={x:r.x,y:r.y},this._lastScrollValues={x:document.documentElement.scrollLeft,y:document.documentElement.scrollTop},this._dragEl&&this._dragEl.parentNode&&(a+=this._dragEl.parentNode.scrollLeft-this._initialScroll.x,l+=this._dragEl.parentNode.scrollTop-this._initialScroll.y),this.moveBy(a/=c,l/=c,e)}}}},{key:"getDragDelta",value:function(){return null!=this._posAtDown&&null!=this._downAt?{x:this._downAt.x-this._posAtDown.x,y:this._downAt.y-this._posAtDown.y}:{x:0,y:0}}},{key:"mark",value:function(e){this._posAtDown=this.manager.getPosition(this._dragEl),this._pagePosAtDown=ct(this._dragEl),this._pageDelta={x:this._pagePosAtDown.x-this._posAtDown.x,y:this._pagePosAtDown.y-this._posAtDown.y},this._size=this.manager.getSize(this._dragEl),qe(this._dragEl,this.manager.css.drag),this._constrainRect=function xl(s){return{w:s.parentNode.offsetWidth+s.parentNode.scrollLeft,h:s.parentNode.offsetHeight+s.parentNode.scrollTop}}(this._dragEl),this._ghostDx=0,this._ghostDy=0}},{key:"unmark",value:function(e){this._isConstrained&&this._useGhostProxy(this._elementToDrag,this._dragEl)?(this._ghostProxyOffsets={x:this._dragEl.offsetLeft-this._ghostDx,y:this._dragEl.offsetTop-this._ghostDy},this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag):this._ghostProxyOffsets=null,Jn(this._dragEl,this.manager.css.drag),this._isConstrained=!1}},{key:"moveBy",value:function(e,t,r){var a=this.toGrid({x:this._posAtDown.x+e,y:this._posAtDown.y+t}),l=this._doConstrain(a,this._dragEl,this._constrainRect,this._size,r);if(null!=l){if(this._useGhostProxy(this.el,this._dragEl))if(a.x!==l.x||a.y!==l.y){if(!this._isConstrained){var c=this._ghostProxyFunction(this._elementToDrag);qe(c,"katavorio-ghost-proxy"),this._ghostProxyParent?(this._ghostProxyParent.appendChild(c),this._currentParentPosition=ct(this._elementToDrag.parentNode),this._ghostParentPosition=ct(this._ghostProxyParent),this._ghostDx=this._currentParentPosition.x-this._ghostParentPosition.x,this._ghostDy=this._currentParentPosition.y-this._ghostParentPosition.y):this._elementToDrag.parentNode.appendChild(c),this._dragEl=c,this._isConstrained=!0}l=a}else this._isConstrained&&(this._dragEl.parentNode.removeChild(this._dragEl),this._dragEl=this._elementToDrag,this._isConstrained=!1,this._currentParentPosition=null,this._ghostParentPosition=null,this._ghostDx=0,this._ghostDy=0);this.manager.setPosition(this._dragEl,{x:l.x+this._ghostDx,y:l.y+this._ghostDy}),this._dispatch("drag",{el:this.el,pos:l,e:r,drag:this,size:this._size,originalPos:this._posAtDown})}}},{key:"abort",value:function(){null!=this._downAt&&this._upListener()}},{key:"getDragElement",value:function(e){return e?this._elementToDrag||this.el:this._dragEl||this.el}},{key:"stop",value:function(e,t){if(t||this._moving){var r=[],a=this.manager.getPosition(this._dragEl);r.push([this._dragEl,a,this,this._size]),this._dispatch("stop",{el:this._dragEl,pos:this._ghostProxyOffsets||a,finalPos:a,e,drag:this,selection:r,size:this._size,originalPos:{x:this._posAtDown.x,y:this._posAtDown.y}})}else this._moving||this._activeSelectorParams.dragAbort&&this._activeSelectorParams.dragAbort(this._elementToDrag)}},{key:"_dispatch",value:function(e,t){var r=null;if(this._activeSelectorParams&&this._activeSelectorParams[e])r=this._activeSelectorParams[e](t);else if(this.listeners[e])for(var a=0;a<this.listeners[e].length;a++)try{var l=this.listeners[e][a](t);null!=l&&(r=l)}catch{}return r}},{key:"resolveGrid",value:function(){var e={grid:null,thresholdX:5,thresholdY:5};return null!=this._activeSelectorParams&&null!=this._activeSelectorParams.grid&&(e.grid=this._activeSelectorParams.grid,null!=this._activeSelectorParams.snapThreshold&&(e.thresholdX=this._activeSelectorParams.snapThreshold,e.thresholdY=this._activeSelectorParams.snapThreshold)),e}},{key:"toGrid",value:function(e){var t=this.resolveGrid(),r=t.grid;return null==r?e:function ll(s,o,n,i){n=n??(null==o.thresholdX?o.w/2:o.thresholdX),i=i??(null==o.thresholdY?o.h/2:o.thresholdY);var e=Math.floor(s.x/o.w),t=o.w*e,r=t+o.w,a=Math.abs(s.x-t)<=n?t:Math.abs(r-s.x)<=n?r:s.x,l=Math.floor(s.y/o.h),c=o.h*l,h=c+o.h;return{x:a,y:Math.abs(s.y-c)<=i?c:Math.abs(h-s.y)<=i?h:s.y}}(e,r,r?r.w/2:t.thresholdX,r?r.h/2:t.thresholdY)}},{key:"setUseGhostProxy",value:function(e){this._useGhostProxy=e?xi:_l}},{key:"_doConstrain",value:function(e,t,r,a,l){return null!=this._activeSelectorParams&&this._activeSelectorParams.constrainFunction&&"function"==typeof this._activeSelectorParams.constrainFunction?this._activeSelectorParams.constrainFunction(e,t,r,a,l):e}},{key:"_testFilter",value:function(e){for(var t in this._filters){var r=this._filters[t],a=r[0](e);if(r[1]&&(a=!a),!a)return!1}return!0}},{key:"addFilter",value:function(e,t){var r=this;if(e){var a=function cl(s){return"function"==typeof s?(s._katavorioId=q(),s._katavorioId):s}(e);this._filters[a]=[function(l){var h,c=l.srcElement||l.target;return Y(e)?h=ze(c,e,r.el):"function"==typeof e&&(h=e(l,r.el)),h},!1!==t]}}},{key:"removeFilter",value:function(e){delete this._filters["function"==typeof e?e._katavorioId:e]}},{key:"clearAllFilters",value:function(){this._filters={}}},{key:"addSelector",value:function(e,t){e.selector&&(t?this._availableSelectors.unshift(e):this._availableSelectors.push(e))}},{key:"destroy",value:function(){this.eventManager.off(this.el,F,this.downListener),this.eventManager.off(document,Q,this.moveListener),this.eventManager.off(document,j,this.upListener),this.downListener=null,this.upListener=null,this.moveListener=null,null!=this.scrollTracker&&document.removeEventListener("scroll",this.scrollTracker)}}]),n}(Cl),Sl=["input","textarea","select","button","option"].join(","),Pl=function(){function s(o){P(this,s),u(this,"eventManager",void 0),u(this,"zoom",1),u(this,"css",{}),u(this,"inputFilterSelector",void 0),u(this,"positioningStrategy",void 0),u(this,"_positionSetter",void 0),u(this,"_positionGetter",void 0),u(this,"_sizeSetter",void 0),u(this,"_sizeGetter",void 0),this.inputFilterSelector=(o=o||{}).inputFilterSelector||Sl,this.eventManager=new mi,this.zoom=o.zoom||1,this.positioningStrategy=o.positioningStrategy||ke.absolutePosition,this._positionGetter=ki.get(this.positioningStrategy),this._positionSetter=bi.get(this.positioningStrategy),this._sizeGetter=Pi.get(this.positioningStrategy),this._sizeSetter=Si.get(this.positioningStrategy),M(this.css,o.css||{})}return D(s,[{key:"getPosition",value:function(n){return this._positionGetter(n)}},{key:"setPosition",value:function(n,i){this._positionSetter(n,i)}},{key:"getSize",value:function(n){return this._sizeGetter(n)}},{key:"getZoom",value:function(){return this.zoom}},{key:"setZoom",value:function(n){this.zoom=n}},{key:"_prepareParams",value:function(n){n=n||{};var e,i={events:{}};for(e in n)i[e]=n[e];for(e=0;e<Ti.length;e++)i.events[Ti[e]]=n[Ti[e]]||ml;return i}},{key:"getInputFilterSelector",value:function(){return this.inputFilterSelector}},{key:"setInputFilterSelector",value:function(n){return this.inputFilterSelector=n,this}},{key:"draggable",value:function(n,i){if(null==n._katavorioDrag){var e=this._prepareParams(i),t=new bl(n,e,this);return qe(n,"katavorio-delegated-draggable"),n._katavorioDrag=t,t}return n._katavorioDrag}},{key:"destroyDraggable",value:function(n){n._katavorioDrag&&(n._katavorioDrag.destroy(),delete n._katavorioDrag)}}]),s}(),On="jtk-drag-selected",Tl=function(){function s(o){P(this,s),this.instance=o,u(this,"_dragSelection",[]),u(this,"_dragSizes",new Map),u(this,"_dragElements",new Map),u(this,"_dragElementStartPositions",new Map),u(this,"_dragElementPositions",new Map),u(this,"__activeSet",void 0)}return D(s,[{key:"_activeSet",get:function(){return null==this.__activeSet?this._dragSelection:this.__activeSet}},{key:"length",get:function(){return this._dragSelection.length}},{key:"filterActiveSet",value:function(n){var i=this;this.__activeSet=[],I(this._dragSelection,function(e){n(e)&&i.__activeSet.push(e)})}},{key:"clear",value:function(){var n=this;this.reset(),I(this._dragSelection,function(i){return n.instance.removeClass(i.jel,On)}),this._dragSelection.length=0}},{key:"reset",value:function(){this._dragElementStartPositions.clear(),this._dragElementPositions.clear(),this._dragSizes.clear(),this._dragElements.clear(),this.__activeSet=null}},{key:"initialisePositions",value:function(){var n=this;I(this._activeSet,function(i){var e=n.instance.viewport.getPosition(i.id),t={x:parseInt(""+i.jel.offsetLeft,10),y:parseInt(""+i.jel.offsetTop,10)};n._dragElementStartPositions.set(i.id,t),n._dragElementPositions.set(i.id,t),n._dragSizes.set(i.id,{w:e.w,h:e.h})})}},{key:"updatePositions",value:function(n,i,e){var t=this,r=n.x-i.x,a=n.y-i.y;I(this._activeSet,function(l){var c=t._dragElementStartPositions.get(l.id);if(c){var h=c.x+r,f=c.y+a,v=t._dragSizes.get(l.id),p={x:h,y:f,w:v.w,h:v.h};if(l.jel._jsPlumbParentGroup&&l.jel._jsPlumbParentGroup.constrain){var g={w:l.jel.parentNode.offsetWidth+l.jel.parentNode.scrollLeft,h:l.jel.parentNode.offsetHeight+l.jel.parentNode.scrollTop};p.x=Math.max(p.x,0),p.y=Math.max(p.y,0),p.x=Math.min(p.x,g.w-v.w),p.y=Math.min(p.y,g.h-v.h)}t._dragElementPositions.set(l.id,{x:h,y:f}),l.jel.style.left=p.x+"px",l.jel.style.top=p.y+"px",e(l.jel,l.id,v,p)}})}},{key:"each",value:function(n){var i=this;I(this._activeSet,function(e){var t=i._dragSizes.get(e.id),r=i._dragElementPositions.get(e.id),a=i._dragElementStartPositions.get(e.id);n(e.jel,e.id,r,t,a)})}},{key:"add",value:function(n,i){var e=n;i=i||this.instance.getId(e),-1===Te(this._dragSelection,function(r){return r.id===i})&&(this.instance.addClass(n,On),this._dragSelection.push({id:i,jel:e}))}},{key:"remove",value:function(n){var i=this,e=n;this._dragSelection=this._dragSelection.filter(function(t){var r=t.jel!==e;return r||i.instance.removeClass(t.jel,On),r})}},{key:"toggle",value:function(n){var i=n;-1!==Te(this._dragSelection,function(t){return t.jel===i})?this.remove(i):this.add(n)}}]),s}(),je="jtk-drag-active",He="jtk-drag-hover",Il=function(){function s(o,n,i){var e=this;P(this,s),this.instance=o,this.dragSelection=n,u(this,"collicat",void 0),u(this,"drag",void 0),u(this,"_draggables",{}),u(this,"_dlist",[]),u(this,"_elementsWithEndpoints",{}),u(this,"_draggablesForElements",{}),u(this,"handlers",[]),u(this,"_trackScroll",void 0),u(this,"_filtersToAdd",[]),this.collicat=new Pl({zoom:this.instance.currentZoom,css:{noSelect:this.instance.dragSelectClass,delegatedDraggable:"jtk-delegated-draggable",draggable:"jtk-draggable",drag:"jtk-drag",selected:On,active:je,hover:He,ghostProxy:"jtk-ghost-proxy"}}),this.instance.bind("zoom",function(t){e.collicat.setZoom(t)}),this._trackScroll=!1!==(i=i||{}).trackScroll}return D(s,[{key:"addHandler",value:function(n,i){var e=this,t=M({selector:n.selector},i||{});t.start=fn(t.start,function(l){return n.onStart(l)},!1),t.drag=fn(t.drag,function(l){return n.onDrag(l)}),t.stop=fn(t.stop,function(l){return n.onStop(l)});var r=(n.onBeforeStart||function(l){}).bind(n);if(t.beforeStart=fn(t.beforeStart,function(l){return r(l)}),t.dragInit=function(l,c){return n.onDragInit(l,c)},t.dragAbort=function(l){return n.onDragAbort(l)},n.useGhostProxy&&(t.useGhostProxy=n.useGhostProxy,t.makeGhostProxy=n.makeGhostProxy),null==t.constrainFunction&&null!=t.containment)switch(t.containment){case An.notNegative:t.constrainFunction=function(l,c,h,f){return{x:Math.max(0,Math.min(l.x)),y:Math.max(0,Math.min(l.y))}};break;case An.parent:var a=t.containmentPadding||5;t.constrainFunction=function(l,c,h,f){return{x:l.x<0?0:l.x>h.w-a?h.w-a:l.x,y:l.y<0?0:l.y>h.h-a?h.h-a:l.y}};break;case An.parentEnclosed:t.constrainFunction=function(l,c,h,f){return{x:l.x<0?0:l.x+f.w>h.w?h.w-f.w:l.x,y:l.y<0?0:l.y+f.h>h.h?h.h-f.h:l.y}}}null==this.drag?(t.trackScroll=this._trackScroll,this.drag=this.collicat.draggable(this.instance.getContainer(),t),I(this._filtersToAdd,function(l){return e.drag.addFilter(l[0],l[1])}),this.drag.on(En,function(l){e.instance.revalidate(l)})):this.drag.addSelector(t),this.handlers.push({handler:n,options:t}),n.init(this.drag)}},{key:"addSelector",value:function(n,i){this.drag&&this.drag.addSelector(n,i)}},{key:"addFilter",value:function(n,i){null==this.drag?this._filtersToAdd.push([n,!0===i]):this.drag.addFilter(n,i)}},{key:"removeFilter",value:function(n){null!=this.drag&&this.drag.removeFilter(n)}},{key:"setFilters",value:function(n){var i=this;I(n,function(e){i.drag.addFilter(e[0],e[1])})}},{key:"reset",value:function(){var n=[];if(I(this.handlers,function(t){t.handler.reset()}),this.handlers.length=0,null!=this.drag){var i=this.drag._filters;for(var e in i)n.push([e,i[e][1]]);this.collicat.destroyDraggable(this.instance.getContainer())}return delete this.drag,n}},{key:"setOption",value:function(n,i){var e=zn(this.handlers,function(t){return t.handler===n});null!=e&&M(e.options,i||{})}}]),s}(),Ai=function(){function s(o,n){P(this,s),this.instance=o,this._dragSelection=n,u(this,"selector","> "+X+":not("+Ze(yn)+")"),u(this,"_dragOffset",null),u(this,"_groupLocations",[]),u(this,"_intersectingGroups",[]),u(this,"_currentDragParentGroup",null),u(this,"_dragGroupByElementIdMap",{}),u(this,"_dragGroupMap",{}),u(this,"_currentDragGroup",null),u(this,"_currentDragGroupOffsets",new Map),u(this,"_currentDragGroupSizes",new Map),u(this,"_currentDragGroupOriginalPositions",new Map),u(this,"_dragPayload",null),u(this,"drag",void 0),u(this,"originalPosition",void 0)}return D(s,[{key:"onDragInit",value:function(n){return null}},{key:"onDragAbort",value:function(n){return null}},{key:"getDropGroup",value:function(){var n=null;if(this._intersectingGroups.length>0){var i=this._intersectingGroups[0].groupLoc.group,e=this._intersectingGroups[0].intersectingElement,t=e._jsPlumbParentGroup;t!==i&&(null==t||!t.overrideDrop(e,i))&&(n=this._intersectingGroups[0])}return n}},{key:"onStop",value:function(n){var i,e=this,t=n.drag.getDragElement(),r=this.getDropGroup(),a=[];function l(g,_,y,m,E){var C=y.x,b=y.y;if(g._jsPlumbParentGroup&&g._jsPlumbParentGroup.constrain){var A={w:g.parentNode.offsetWidth+g.parentNode.scrollLeft,h:g.parentNode.offsetHeight+g.parentNode.scrollTop};C=Math.max(C,0),b=Math.max(b,0),C=Math.min(C,A.w-m.w),b=Math.min(b,A.h-m.h),y.x=C,y.y=b}a.push({el:g,id:_,pos:y,originalPos:E,originalGroup:g._jsPlumbParentGroup,redrawResult:null,reverted:!1,dropGroup:r?.groupLoc.group})}if(a.push({el:t,id:this.instance.getId(t),pos:n.finalPos,originalGroup:t._jsPlumbParentGroup,redrawResult:null,originalPos:n.originalPos,reverted:!1,dropGroup:null!=r?r.groupLoc.group:null}),this._dragSelection.each(function(g,_,y,m,E){g!==n.el&&l(g,_,{x:y.x,y:y.y},m,E)}),null===(i=this._currentDragGroup)||void 0===i||i.members.forEach(function(g){if(g.el!==n.el){var _=e._currentDragGroupOffsets.get(g.elId),y=e._currentDragGroupSizes.get(g.elId);l(g.el,g.elId,{x:n.finalPos.x+_[0].x,y:n.finalPos.y+_[0].y},y,e._currentDragGroupOriginalPositions.get(g.elId))}}),I(a,function(g){var _=null!=g.originalGroup,y=_&&zr(e.instance,g.el,g.pos),m={x:0,y:0};if(_&&!y){if(null==r){var E=e._pruneOrOrphan(g,!0,!0);null!=E.pos?g.pos=E.pos.pos:!E.pruned&&g.originalGroup.revert&&(g.pos=g.originalPos,g.reverted=!0)}}else _&&y&&(m=e._computeOffsetByParentGroup(g.originalGroup));null==r||y?g.dropGroup=null:e.instance.groupManager.addToGroup(r.groupLoc.group,!1,g.el),g.reverted&&e.instance.setPosition(g.el,g.pos),g.redrawResult=e.instance.setElementPosition(g.el,g.pos.x+m.x,g.pos.y+m.y),e.instance.removeClass(g.el,"jtk-dragged"),e.instance.select({source:g.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.sourceElementDraggingClass,!0),e.instance.select({target:g.el}).removeClass(e.instance.elementDraggingClass+" "+e.instance.targetElementDraggingClass,!0)}),null!=a[0].originalGroup){var c=t._jsPlumbParentGroup;if(c!==a[0].originalGroup){var h=n.drag.getDragElement(!0);if(a[0].originalGroup.ghost){var f=this.instance.getPosition(this.instance.getGroupContentArea(c)),v=this.instance.getPosition(this.instance.getGroupContentArea(a[0].originalGroup)),p={x:v.x+n.pos.x-f.x,y:v.y+n.pos.y-f.y};h.style.left=p.x+"px",h.style.top=p.y+"px",this.instance.revalidate(h)}}}this.instance.fire(wr,{elements:a,e:n.e,el:t,payload:this._dragPayload}),this._cleanup()}},{key:"_cleanup",value:function(){var n=this;I(this._groupLocations,function(i){n.instance.removeClass(i.el,je),n.instance.removeClass(i.el,He)}),this._currentDragParentGroup=null,this._groupLocations.length=0,this.instance.hoverSuspended=!1,this._dragOffset=null,this._dragSelection.reset(),this._dragPayload=null,this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroupOriginalPositions.clear(),this._currentDragGroup=null}},{key:"reset",value:function(){}},{key:"init",value:function(n){this.drag=n}},{key:"onDrag",value:function(n){var i=this,e=n.drag.getDragElement(),t=this.instance.getId(e),r=n.pos,a=this.instance.viewport.getPosition(t),l={x:r.x,y:r.y};this._intersectingGroups.length=0,null!=this._dragOffset&&(l.x+=this._dragOffset.x,l.y+=this._dragOffset.y);var c=function(v,p,g){if(g){var _=new Set;I(i._groupLocations,function(y){!_.has(y.group.id)&&$r(p,y.r)?(y.group!==i._currentDragParentGroup&&i.instance.addClass(y.el,He),i._intersectingGroups.push({groupLoc:y,intersectingElement:n.drag.getDragElement(!0),d:0}),I(i.instance.groupManager.getAncestors(y.group),function(m){return _.add(m.id)})):i.instance.removeClass(y.el,He)})}i.instance.setElementPosition(v,p.x,p.y),i.instance.fire("drag:move",{el:v,e:n.e,pos:{x:p.x,y:p.y},originalPosition:i.originalPosition,payload:i._dragPayload})},h={x:l.x,y:l.y,w:a.w,h:a.h};c(e,h,!0),this._dragSelection.updatePositions(r,this.originalPosition,function(f,v,p,g){c(f,g,!1)}),this._currentDragGroupOffsets.forEach(function(f,v){var p=i._currentDragGroupSizes.get(v),g={x:h.x+f[0].x,y:h.y+f[0].y,w:p.w,h:p.h};f[1].style.left=g.x+"px",f[1].style.top=g.y+"px",c(f[1],g,!1)})}},{key:"_computeOffsetByParentGroup",value:function(n){var i=this.instance.getPosition(n.el),e=n.contentArea;if(e!==n.el){var t=this.instance.getPosition(e);i.x+=t.x,i.y+=t.y}if(n.el._jsPlumbParentGroup){var r=this._computeOffsetByParentGroup(n.el._jsPlumbParentGroup);i.x+=r.x,i.y+=r.y}return i}},{key:"onStart",value:function(n){var i=this,e=n.drag.getDragElement(),t=this.instance.getPosition(e);this.originalPosition={x:n.pos.x,y:n.pos.y},e._jsPlumbParentGroup&&(this._dragOffset=this._computeOffsetByParentGroup(e._jsPlumbParentGroup),this._currentDragParentGroup=e._jsPlumbParentGroup);var r=!0,a=e.getAttribute(pn);if((!1===this.instance.elementsDraggable||null!=a&&a!==pt)&&(r=!1),r){this._groupLocations.length=0,this._intersectingGroups.length=0,this.instance.hoverSuspended=!0;var l=n.drag.getDragElement(!0),c=l.querySelectorAll(X),h=function Nl(s){for(var o=[],n=s._jsPlumbParentGroup;null!=n;)o.push(n.el),n=n.group;return o}(l),f=[];Array.prototype.push.apply(f,c),Array.prototype.push.apply(f,h),this._dragSelection.filterActiveSet(function(_){return-1===f.indexOf(_.jel)}),this._dragSelection.initialisePositions();var v=function(y,m,E){if(!y._isJsPlumbGroup||i.instance.allowNestedGroups){var C=!y._jsPlumbParentGroup;(C||(C||!0!==y._jsPlumbParentGroup.dropOverride)&&!C&&(y._jsPlumbParentGroup.ghost||!0!==y._jsPlumbParentGroup.constrain))&&(I(i.instance.groupManager.getGroups(),function(w){if(!1!==w.droppable&&!1!==w.enabled&&y._jsPlumbGroup!==w&&!i.instance.groupManager.isDescendant(w,y._jsPlumbGroup)){var x=w.el,R=i.instance.getId(x),G=i.instance.viewport.getPosition(R);i._groupLocations.push({el:x,r:{x:G.x,y:G.y,w:G.w,h:G.h},group:w}),w!==i._currentDragParentGroup&&i.instance.addClass(x,je)}}),i._groupLocations.sort(function(w,S){return i.instance.groupManager.isDescendant(w.group,S.group)?-1:i.instance.groupManager.isAncestor(S.group,w.group)?1:0}))}return i.instance.select({source:y}).addClass(i.instance.elementDraggingClass+" "+i.instance.sourceElementDraggingClass,!0),i.instance.select({target:y}).addClass(i.instance.elementDraggingClass+" "+i.instance.targetElementDraggingClass,!0),i.instance.fire("drag:start",{el:y,e:n.e,originalPosition:i.originalPosition,pos:i.originalPosition,dragGroup:m,dragGroupMemberSpec:E})},p=this.instance.getId(e);this._currentDragGroup=this._dragGroupByElementIdMap[p],this._currentDragGroup&&!function Gl(s,o){var n=ir(s.members,function(i){return i.el===o});return null!==n&&!0===n.active}(this._currentDragGroup,e)&&(this._currentDragGroup=null);var g=v(e);if(!1===g)return this._cleanup(),!1;this._dragPayload=g,null!=this._currentDragGroup&&(this._currentDragGroupOffsets.clear(),this._currentDragGroupSizes.clear(),this._currentDragGroup.members.forEach(function(_){var y=i.instance.viewport.getPosition(_.elId);i._currentDragGroupOffsets.set(_.elId,[{x:y.x-t.x,y:y.y-t.y},_.el]),i._currentDragGroupSizes.set(_.elId,y),i._currentDragGroupOriginalPositions.set(_.elId,{x:y.x,y:y.y}),v(_.el,i._currentDragGroup,_)}))}return r}},{key:"addToDragGroup",value:function(n){var i=this,e=function Ll(s,o){return Y(o)?{id:o,active:!0}:{id:o.id,active:o.active}}(0,n),t=this._dragGroupMap[e.id];null==t&&(this._dragGroupMap[e.id]=t={id:e.id,members:new Set});for(var r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];this.removeFromDragGroup.apply(this,a),I(a,function(c){var h=i.instance.getId(c);t.members.add({elId:h,el:c,active:e.active}),i._dragGroupByElementIdMap[h]=t})}},{key:"removeFromDragGroup",value:function(){for(var n=this,i=arguments.length,e=new Array(i),t=0;t<i;t++)e[t]=arguments[t];I(e,function(r){var a=n.instance.getId(r),l=n._dragGroupByElementIdMap[a];if(null!=l){var c=new Set;l.members.forEach(function(h){h.el!==r&&c.add(h)}),l.members=c,delete n._dragGroupByElementIdMap[a]}})}},{key:"setDragGroupState",value:function(n){for(var i=this,e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];I(t.map(function(l){return i.instance.getId(l)}),function(l){var c=i._dragGroupByElementIdMap[l];if(null!=c){var h=ir(c.members,function(f){return f.elId===l});null!=h&&(h.active=n)}})}},{key:"clearDragGroup",value:function(n){var i=this,e=this._dragGroupMap[n];null!=e&&(e.members.forEach(function(t){delete i._dragGroupByElementIdMap[t.elId]}),e.members.clear())}},{key:"_pruneOrOrphan",value:function(n,i,e){var t=n.el,r={pruned:!1,pos:null};if(e||!zr(this.instance,t,n.pos)){var a=t._jsPlumbParentGroup;a.prune?(t._isJsPlumbGroup?this.instance.removeGroup(t._jsPlumbGroup):a.remove(n.el,!0),r.pruned=!0):a.orphan&&(r.pos=this.instance.groupManager.orphan(n.el,i),t._isJsPlumbGroup?a.removeGroup(t._jsPlumbGroup):a.remove(n.el))}return r}}]),s}(),ts={},ns={},is={},Ue={get:function(o,n,i){var e=ts[n];if(e)return new e(o,i);throw{message:"jsPlumb: unknown endpoint type '"+n+"'"}},clone:function(o){return Ue.get(o.endpoint,o.type,is[o.type].getParams(o))},compute:function(o,n,i,e){var t=ns[o.type];if(null!=t)return t(o,n,i,e);Z("jsPlumb: cannot find endpoint calculator for endpoint of type ",o.type)},registerHandler:function(o){is[o.type]=o,ts[o.type]=o.cls,ns[o.type]=o.compute}},mt=function(){function s(o,n){P(this,s),this.endpoint=o,u(this,"typeId",void 0),u(this,"x",void 0),u(this,"y",void 0),u(this,"w",void 0),u(this,"h",void 0),u(this,"computedValue",void 0),u(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),u(this,"classes",[]),u(this,"instance",void 0),u(this,"type",void 0),n=n||{},this.instance=o.instance,o.cssClass&&this.classes.push(o.cssClass),n.cssClass&&this.classes.push(n.cssClass)}return D(s,[{key:"addClass",value:function(n){this.classes.push(n),this.instance.addEndpointClass(this.endpoint,n)}},{key:"removeClass",value:function(n){this.classes=this.classes.filter(function(i){return i!==n}),this.instance.removeEndpointClass(this.endpoint,n)}},{key:"compute",value:function(n,i,e){this.computedValue=Ue.compute(this,n,i,e),this.bounds.xmin=this.x,this.bounds.ymin=this.y,this.bounds.xmax=this.x+this.w,this.bounds.ymax=this.y+this.h}},{key:"setVisible",value:function(n){this.instance.setEndpointVisible(this.endpoint,n)}}]),s}(),Wt=function(s){return s.top="top",s.left="left",s.right="right",s.bottom="bottom",s}(Wt||{}),W=Wt.top,se=Wt.left,ne=Wt.right,le=Wt.bottom,Rl=[se,ne],Fl=[W,le],jl=function(){function s(o,n,i){P(this,s),this.instance=o,this.element=n,u(this,"isFloating",!0),u(this,"isContinuous",void 0),u(this,"isDynamic",void 0),u(this,"locations",[]),u(this,"currentLocation",0),u(this,"locked",!1),u(this,"cssClass",""),u(this,"timestamp",null),u(this,"type","Floating"),u(this,"id",q()),u(this,"orientation",[0,0]),u(this,"size",void 0),this.size=o.viewport.getPosition(i),this.locations.push({x:.5,y:.5,ox:this.orientation[0],oy:this.orientation[1],offx:0,offy:0,iox:this.orientation[0],ioy:this.orientation[1],cls:""})}return D(s,[{key:"_updateOrientationInRouter",value:function(){this.instance.router.setAnchorOrientation(this,[this.locations[0].ox,this.locations[0].oy])}},{key:"over",value:function(n){this.orientation=this.instance.router.getEndpointOrientation(n),this.locations[0].ox=this.orientation[0],this.locations[0].oy=this.orientation[1],this._updateOrientationInRouter()}},{key:"out",value:function(){this.orientation=null,this.locations[0].ox=this.locations[0].iox,this.locations[0].oy=this.locations[0].ioy,this._updateOrientationInRouter()}}]),s}(),rs=(u(Et={},W,le),u(Et,ne,se),u(Et,se,ne),u(Et,le,W),Et),ss=(u(Ct={},W,ne),u(Ct,ne,le),u(Ct,se,W),u(Ct,le,se),Ct),os=(u(xt={},W,se),u(xt,ne,W),u(xt,se,le),u(xt,le,ne),xt);function Hl(s){return 0===s.faces.length?W:s.faces[0]}function $t(s,o){return-1!==s.faces.indexOf(o)}function as(s,o){return null==s.lockedAxis?null==s.lockedFace?!0===$t(s,o):s.lockedFace===o:-1!==s.lockedAxis.indexOf(o)}var ls={x:.5,y:0,ox:0,oy:-1,offx:0,offy:0},us={x:.5,y:1,ox:0,oy:1,offx:0,offy:0},cs={x:0,y:.5,ox:-1,oy:0,offx:0,offy:0},hs={x:1,y:.5,ox:1,oy:0,offx:0,offy:0},fs={Top:[ls],Bottom:[us],Left:[cs],Right:[hs],TopLeft:[{x:0,y:0,ox:0,oy:-1,offx:0,offy:0}],TopRight:[{x:1,y:0,ox:1,oy:-1,offx:0,offy:0}],BottomLeft:[{x:0,y:1,ox:0,oy:1,offx:0,offy:0}],BottomRight:[{x:1,y:1,ox:0,oy:1,offx:0,offy:0}],Center:[{x:.5,y:.5,ox:0,oy:0,offx:0,offy:0}],AutoDefault:[ls,cs,us,hs]},zl={Continuous:{faces:[W,se,le,ne]},ContinuousTop:{faces:[W]},ContinuousRight:{faces:[ne]},ContinuousBottom:{faces:[le]},ContinuousLeft:{faces:[se]},ContinuousLeftRight:{faces:[se,ne]},ContinuousTopBottom:{faces:[W,le]}};function ds(s,o){if(o=o||{},s===we.Perimeter)return function iu(s){var o=(s=s||{}).anchorCount||60,n=s.shape;if(!n)throw new Error("no shape supplied to Perimeter Anchor type");if(!Ve.has(n))throw new Error("Shape ["+n+"] is unknown by Perimeter Anchor type");var i=Ve.get(n)(o);return s.rotation&&(i=function nu(s,o){for(var n=[],i=o/180*Math.PI,e=0;e<s.length;e++){var t=s[e].x-.5,r=s[e].y-.5;n.push({x:t*Math.cos(i)-r*Math.sin(i)+.5,y:t*Math.sin(i)+r*Math.cos(i)+.5,ox:s[e].ox,oy:s[e].oy,offx:0,offy:0,iox:0,ioy:0,cls:""})}return n}(i,s.rotation)),M(Dn(we.Perimeter,i,s),{shape:n})}(o);var n=fs[s];if(null!=n)return Dn(s,or(n,function(i){return M({iox:i.ox,ioy:i.oy},i)}),o);if(null!=(n=zl[s]))return function Jl(s,o,n){var i={type:s,locations:[],currentLocation:0,locked:!1,id:q(),cssClass:n.cssClass||"",isFloating:!1,isContinuous:!0,timestamp:null,faces:n.faces||o,lockedFace:null,lockedAxis:null,clockwise:!1!==n.clockwise,__currentFace:null};return Object.defineProperty(i,Zl,{get:function(){return this.__currentFace},set:function(t){this.__currentFace=function Bl(s,o){if($t(s,o))return o;if($t(s,rs[o]))return rs[o];var n=function Ul(s,o){return(s.clockwise?ss:os)[o]}(s,o);if($t(s,n))return n;var i=function Vl(s,o){return(s.clockwise?os:ss)[o]}(s,o);return $t(s,i)?i:o}(this,t)}}),i}(s,n.faces,o);throw{message:"jsPlumb: unknown anchor type '"+s+"'"}}function Dn(s,o,n){return{type:s,locations:o,currentLocation:0,locked:!1,id:q(),isFloating:!1,isContinuous:!1,isDynamic:o.length>1,timestamp:null,cssClass:n.cssClass||""}}var Zl="currentFace";function vs(s){return s.length<7&&s.every(an)||7===s.length&&s.slice(0,5).every(an)&&Y(s[6])}function Kt(s){return Y(s)?ds(s,null):Array.isArray(s)?vs(s)?Dn(null,[{x:s[0],y:s[1],ox:s[2],oy:s[3],offx:null==s[4]?0:s[4],offy:null==s[5]?0:s[5],iox:s[2],ioy:s[3],cls:s[6]||""}],{cssClass:s[6]||""}):Dn("Dynamic",or(s,function(e){if(Y(e)){var t=fs[e];return null!=t?M({iox:t[0].ox,ioy:t[0].oy,cls:""},t[0]):null}if(vs(e))return{x:e[0],y:e[1],ox:e[2],oy:e[3],offx:null==e[4]?0:e[4],offy:null==e[5]?0:e[5],iox:e[2],ioy:e[3],cls:e[6]||""}}).filter(function(e){return null!=e}),{}):ds(s.type,s.options)}function ps(s){for(var o=.5,n=2*Math.PI/s,i=[],e=0,t=0;t<s;t++){var r=o+o*Math.sin(e),a=o+o*Math.cos(e);i.push({x:r,y:a,ox:0,oy:0,offx:0,offy:0,iox:0,ioy:0,cls:""}),e+=n}return i}function Oi(s,o){for(var n=[],i=0;i<s.length;i++)n.push([s[i][0],s[i][1],s[i][2],s[i][3],1/s.length,s[i][4],s[i][5]]);return function Ql(s,o){for(var n=o/s.length,i=[],e=function(a,l,c,h,f,v,p){for(var g=(c-a)/(n=o*f),_=(h-l)/n,y=0;y<n;y++)i.push({x:a+g*y,y:l+_*y,ox:v??0,oy:p??0,offx:0,offy:0,iox:0,ioy:0,cls:""})},t=0;t<s.length;t++)e.apply(null,s[t]);return i}(n,o)}function gs(s){return Oi([[0,0,1,0,0,-1],[1,0,1,1,1,0],[1,1,0,1,0,1],[0,1,0,0,-1,0]],s)}var Ve=new Map;Ve.set(Qe.Circle,ps),Ve.set(Qe.Ellipse,ps),Ve.set(Qe.Rectangle,gs),Ve.set(Qe.Square,gs),Ve.set(Qe.Diamond,function eu(s){return Oi([[.5,0,1,.5],[1,.5,.5,1],[.5,1,0,.5],[0,.5,.5,0]],s)}),Ve.set(Qe.Triangle,function tu(s){return Oi([[.5,0,1,1],[1,1,0,1],[0,1,.5,0]],s)});var ys=function(){function s(o,n){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];P(this,s),this.selector=o,this.def=n,this.exclude=i,u(this,"id",void 0),u(this,"redrop",void 0),this.id=q(),this.redrop=n.def.redrop||_s}return D(s,[{key:"setEnabled",value:function(n){this.def.enabled=n}},{key:"isEnabled",value:function(){return!1!==this.def.enabled}}]),s}(),_s="strict";function uu(s,o,n,i,e){for(var t=s.target||s.srcElement,r=!1,a=i.getSelector(o,n),l=0;l<a.length;l++)if(a[l]===t){r=!0;break}return e?!r:r}var cu=Ze(je,He),ms="sourceSelectorEndpoint",Es=function(){function s(o){P(this,s),this.instance=o,u(this,"jpc",void 0),u(this,"existingJpc",void 0),u(this,"_originalAnchorSpec",void 0),u(this,"ep",void 0),u(this,"endpointRepresentation",void 0),u(this,"canvasElement",void 0),u(this,"_activeDefinition",void 0),u(this,"placeholderInfo",{id:null,element:null}),u(this,"floatingIndex",void 0),u(this,"floatingId",void 0),u(this,"floatingElement",void 0),u(this,"floatingEndpoint",void 0),u(this,"floatingAnchor",void 0),u(this,"_stopped",void 0),u(this,"inPlaceCopy",void 0),u(this,"endpointDropTargets",[]),u(this,"currentDropTarget",null),u(this,"payload",void 0),u(this,"floatingConnections",{}),u(this,"_forceReattach",void 0),u(this,"_forceDetach",void 0),u(this,"mousedownHandler",void 0),u(this,"mouseupHandler",void 0),u(this,"selector",Ze(dt));var n=o.getContainer();this.mousedownHandler=this._mousedownHandler.bind(this),this.mouseupHandler=this._mouseupHandler.bind(this),o.on(n,F,X,this.mousedownHandler),o.on(n,j,[X,Ze(dt)].join(","),this.mouseupHandler)}return D(s,[{key:"_resolveDragParent",value:function(n,i){var e=this.instance.getContainer(),t=Ae(i,X,e,!0);if(null!=n.parentSelector){var r=Ae(i,n.parentSelector,e,!0);return null!=r&&(t=Ae(r.parentNode,X,e,!1)),r||t}return t}},{key:"_mousedownHandler",value:function(n){var i,e;if(3!==n.which&&2!==n.button){var t=n.target||n.srcElement;if((null==(e=this._getSourceDefinition(n))||null!=(i=this._resolveDragParent(e.def.def,t))&&i.getAttribute(mn)!==pt)&&e){var a,r=n.currentTarget;if(t.getAttribute(mn)!==pt){if(Gt(n),this._activeDefinition=e,null!=(a=e.def.def).canAcceptNewConnection&&!a.canAcceptNewConnection(i,n))return!1;var l=Us(n,i,this.instance.currentZoom),c={element:i};if(M(c,a),c.isTemporarySource=!0,a.scope)c.scope=a.scope;else{var h=t.getAttribute(hi);null!=h&&(c.scope=h)}if(null!=(c=un(c,a.parameterExtractor?a.parameterExtractor(i,t,n):{})).maxConnections&&c.maxConnections>=0&&this.instance.select({source:i}).length>=c.maxConnections)return Gt(n),a.onMaxConnections&&a.onMaxConnections({element:i,maxConnections:c.maxConnections},n),n.stopImmediatePropagation&&n.stopImmediatePropagation(),!1;if(a.anchorPositionFinder){var p=a.anchorPositionFinder(i,l,a,n);null!=p&&(c.anchor=p)}this._originalAnchorSpec=c.anchor||(this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors[0]:this.instance.defaults.anchor);var g=this.instance.router.prepareAnchor(this._originalAnchorSpec),_=[l.x,l.y,0,0];if(g.locations.length>0)_[2]=g.locations[0].ox,_[3]=g.locations[0].oy;else if(g.isContinuous){var y=l.x<.5?l.x:1-l.x,m=l.y<.5?l.y:1-l.y;_[2]=y<m?l.x<.5?-1:1:0,_[3]=m<y?l.y<.5?-1:1:0}c.anchor=_,c.deleteOnEmpty=!0,this.ep=this.instance._internal_newEndpoint(c);var E={};if(a.extract){for(var C in a.extract){var b=t.getAttribute(C);b&&(E[a.extract[C]]=b)}this.ep.mergeParameters(E)}if(c.uniqueEndpoint){var A=this.ep.elementId,w=this.instance.getManagedData(A,ms,e.id);null==w?(this.instance.setManagedData(A,ms,e.id,this.ep),this.ep.deleteOnEmpty=!1):this.ep.finalEndpoint=w}r._jsPlumbOrphanedEndpoints=r._jsPlumbOrphanedEndpoints||[],r._jsPlumbOrphanedEndpoints.push(this.ep),this.instance.trigger(this.ep.endpoint.canvas,F,n,E)}}}}},{key:"_mouseupHandler",value:function(n){var i=n.currentTarget||n.srcElement;i._jsPlumbOrphanedEndpoints&&(function _o(s,o){s=null==s.length||"string"==typeof s?[s]:s;for(var n=0;n<s.length;n++)o(s[n])}(i._jsPlumbOrphanedEndpoints,this.instance._maybePruneEndpoint.bind(this.instance)),i._jsPlumbOrphanedEndpoints.length=0),this._activeDefinition=null}},{key:"onDragInit",value:function(n){var i=dn(n,this.instance),e=Nt(n,this.instance);return this._makeDraggablePlaceholder(i,e),this.placeholderInfo.element.jtk=n.jtk,this.placeholderInfo.element}},{key:"onDragAbort",value:function(n){this._cleanupDraggablePlaceholder()}},{key:"_makeDraggablePlaceholder",value:function(n,i){this.placeholderInfo=this.placeholderInfo||{};var e=cr("div",{position:"absolute"});this.instance._appendElementToContainer(e);var t=this.instance.getId(e);return this.instance.setPosition(e,n),e.style.width=i.w+"px",e.style.height=i.h+"px",this.instance.manage(e),this.placeholderInfo.id=t,this.placeholderInfo.element=e,e}},{key:"_cleanupDraggablePlaceholder",value:function(){this.placeholderInfo.element&&(this.instance.unmanage(this.placeholderInfo.element,!0),delete this.placeholderInfo.element,delete this.placeholderInfo.id)}},{key:"reset",value:function(){var n=this.instance.getContainer();this.instance.off(n,j,this.mouseupHandler),this.instance.off(n,F,this.mousedownHandler)}},{key:"init",value:function(n){}},{key:"startNewConnectionDrag",value:function(n,i){this.jpc=this.instance._newConnection({sourceEndpoint:this.ep,targetEndpoint:this.floatingEndpoint,source:this.ep.element,target:this.placeholderInfo.element,paintStyle:this.ep.connectorStyle,hoverPaintStyle:this.ep.connectorHoverStyle,connector:this.ep.connector,overlays:this.ep.connectorOverlays,type:this.ep.edgeType,cssClass:this.ep.connectorClass,hoverClass:this.ep.connectorHoverClass,scope:n,data:i}),this.jpc.pending=!0,this.jpc.addClass(this.instance.draggingClass),this.ep.addClass(this.instance.draggingClass),this.instance.fire(Ir,this.jpc)}},{key:"startExistingConnectionDrag",value:function(){this.existingJpc=!0,this.instance.setHover(this.jpc,!1);var n=this.jpc.endpoints[0].id===this.ep.id?0:1;this.ep.detachFromConnection(this.jpc,null,!0),this.floatingEndpoint.addConnection(this.jpc),this.instance.fire(Ir,this.jpc),this.instance.sourceOrTargetChanged(this.jpc.endpoints[n].elementId,this.placeholderInfo.id,this.jpc,this.placeholderInfo.element,n),this.jpc.suspendedEndpoint=this.jpc.endpoints[n],this.jpc.suspendedElement=this.jpc.endpoints[n].element,this.jpc.suspendedElementId=this.jpc.endpoints[n].elementId,this.jpc.suspendedElementType=0===n?ei:"target",this.instance.setHover(this.jpc.suspendedEndpoint,!1),this.floatingEndpoint.referenceEndpoint=this.jpc.suspendedEndpoint,this.floatingEndpoint.mergeParameters(this.jpc.suspendedEndpoint.parameters),this.jpc.endpoints[n]=this.floatingEndpoint,this.jpc.addClass(this.instance.draggingClass),this.floatingId=this.placeholderInfo.id,this.floatingIndex=n,this.instance._refreshEndpoint(this.ep)}},{key:"_shouldStartDrag",value:function(){var n=!0;this.ep.enabled||(n=!1),null==this.jpc&&!this.ep.isSource&&!this.ep.isTemporarySource&&(n=!1),this.ep.isSource&&this.ep.isFull()&&!(null!=this.jpc&&this.ep.dragAllowedWhenFull)&&(n=!1),null!=this.jpc&&!this.jpc.isDetachable(this.ep)&&(this.ep.isFull()?n=!1:this.jpc=null);var i={},e=this.instance.checkCondition(null==this.jpc?"beforeDrag":"beforeStartDetach",{endpoint:this.ep,source:this.ep.element,sourceId:this.ep.elementId,connection:this.jpc});return!1===e?n=!1:"object"===U(e)?M(i=e,this.payload||{}):i=this.payload||{},[n,i]}},{key:"_createFloatingEndpoint",value:function(n){var i=this.ep.endpoint;null!=this.ep.edgeType&&(i=this.instance._deriveEndpointAndAnchorSpec(this.ep.edgeType).endpoints[1]),this.floatingEndpoint=function lu(s,o,n,i,e,t){var r=function ql(s,o,n){return new jl(s,o,n)}(t,i,e),a={paintStyle:s.getPaintStyle(),preparedAnchor:r,element:i,scope:s.scope,cssClass:[ii,s.cssClass].join(" ")};null!=o&&(lr(o,mt)?a.existingEndpoint=o:a.endpoint=o);var l=t._internal_newEndpoint(a);return t._paintEndpoint(l,{}),l}(this.ep,i,0,this.placeholderInfo.element,this.placeholderInfo.id,this.instance),this.floatingAnchor=this.floatingEndpoint._anchor,this.floatingEndpoint.deleteOnEmpty=!0,this.floatingElement=this.floatingEndpoint.endpoint.canvas,this.floatingId=this.instance.getId(this.floatingElement)}},{key:"_populateTargets",value:function(n,i){var e=this,t=this.jpc&&this.jpc.endpoints[0]===this.ep;if(I(this.instance.getContainer().querySelectorAll([".",dt,"[",gr,this.ep.scope,"]:not(.",ii,")"].join("")),function(f){if((null!=e.jpc||f!==n)&&f!==e.floatingElement&&(null!=e.jpc||!f.jtk.endpoint.isFull())&&(t&&f.jtk.endpoint.isSource||!t&&f.jtk.endpoint.isTarget)){var v=dn(f,e.instance),p=Nt(f,e.instance);e.endpointDropTargets.push({el:f,targetEl:f,r:{x:v.x,y:v.y,w:p.w,h:p.h},endpoint:f.jtk.endpoint,def:null}),e.instance.addClass(f,je)}}),t){var l=zn(this.instance.sourceSelectors,function(f){return f.isEnabled()&&(null==f.def.def.scope||f.def.def.scope===e.ep.scope)});null!=l&&I(this._findTargetZones(l),function(f){if(f.getAttribute(mn)!==pt){var v=f.getAttribute(hi);if(null!=v&&v!==e.ep.scope)return;var p={r:null,el:f};p.targetEl=Ae(f,X,e.instance.getContainer(),!0);var g=dn(p.el,e.instance),_=Nt(p.el,e.instance);p.r={x:g.x,y:g.y,w:_.w,h:_.h},null!=l.def.def.rank&&(p.rank=l.def.def.rank),p.def=l.def,e.endpointDropTargets.push(p),e.instance.addClass(p.targetEl,je)}})}else{var h=function go(s,o){var n=function po(s,o){var n=[];if(s)for(var i=0;i<s.length;i++)o(s[i])&&n.push(i);return n}(s,o);return n.map(function(i){return s[i]})}(this.instance.targetSelectors,function(f){return f.isEnabled()});h.forEach(function(f){I(e._findTargetZones(f),function(p){if(p.getAttribute(mn)!==pt){var g=p.getAttribute(hi);if(null!=g&&g!==e.ep.scope)return;var _={r:null,el:p};if(null!=f.def.def.parentSelector&&(_.targetEl=Ae(p,f.def.def.parentSelector,e.instance.getContainer(),!0)),null==_.targetEl&&(_.targetEl=Ae(p,X,e.instance.getContainer(),!0)),(!1===f.def.def.allowLoopback||e._activeDefinition&&!1===e._activeDefinition.def.def.allowLoopback)&&_.targetEl===e.ep.element||null!=f.def.def.canAcceptNewConnection&&!f.def.def.canAcceptNewConnection(_.targetEl,i))return;var y=f.def.def.maxConnections;if(null!=y&&-1!==y&&e.instance.select({target:_.targetEl}).length>=y)return;var m=dn(p,e.instance),E=Nt(p,e.instance);_.r={x:m.x,y:m.y,w:E.w,h:E.h},_.def=f.def,null!=f.def.def.rank&&(_.rank=f.def.def.rank),e.endpointDropTargets.push(_),e.instance.addClass(_.targetEl,je)}})})}this.endpointDropTargets.sort(function(f,v){if(f.targetEl._isJsPlumbGroup&&!v.targetEl._isJsPlumbGroup)return 1;if(!f.targetEl._isJsPlumbGroup&&v.targetEl._isJsPlumbGroup)return-1;if(f.targetEl._isJsPlumbGroup&&v.targetEl._isJsPlumbGroup){if(e.instance.groupManager.isAncestor(f.targetEl._jsPlumbGroup,v.targetEl._jsPlumbGroup))return-1;if(e.instance.groupManager.isAncestor(v.targetEl._jsPlumbGroup,f.targetEl._jsPlumbGroup))return 1}else{if(null==f.rank||null==v.rank)return 0;if(f.rank>v.rank)return-1;if(f.rank<v.rank)return 1}})}},{key:"_findTargetZones",value:function(n){var i;if("any"===n.redrop){var e=this.instance.targetSelectors.map(function(r){return r.selector});e.push.apply(e,ce(this.instance.sourceSelectors.map(function(r){return r.selector}))),e.push(X),i=e.join(",")}else if(n.redrop===_s)i=n.selector;else if("anySource"===n.redrop)i=this.instance.sourceSelectors.map(function(r){return r.selector}).join(",");else if("anyTarget"===n.redrop)i=this.instance.targetSelectors.map(function(r){return r.selector}).join(",");else if("anySourceOrTarget"===n.redrop){var t=this.instance.targetSelectors.map(function(r){return r.selector});t.push.apply(t,ce(this.instance.sourceSelectors.map(function(r){return r.selector}))),i=t.join(",")}return this.instance.getContainer().querySelectorAll(i)}},{key:"onStart",value:function(n){this.endpointDropTargets.length=0,this.currentDropTarget=null,this._stopped=!1;var i=n.drag.getDragElement();if(this.ep=i.jtk.endpoint,!this.ep)return!1;this.endpointRepresentation=this.ep.endpoint,this.canvasElement=this.endpointRepresentation.canvas,this.jpc=this.ep.connectorSelector();var t=ue(this._shouldStartDrag(),2),a=t[1];if(!1===t[0])return this._stopped=!0,!1;this.instance.setHover(this.ep,!1),this.instance.isConnectionBeingDragged=!0,this.jpc&&!this.ep.isFull()&&this.ep.isSource&&(this.jpc=null),this._createFloatingEndpoint(this.canvasElement),this._populateTargets(this.canvasElement,n.e),null==this.jpc?this.startNewConnectionDrag(this.ep.scope,a):this.startExistingConnectionDrag(),this._registerFloatingConnection(this.placeholderInfo,this.jpc),this.instance.currentlyDragging=!0}},{key:"onBeforeStart",value:function(n){this.payload=n.e.payload||{}}},{key:"onDrag",value:function(n){if(this._stopped)return!0;if(this.placeholderInfo.element){var i=Nt(this.floatingElement,this.instance);this.instance.setElementPosition(this.placeholderInfo.element,n.pos.x,n.pos.y);for(var t,r,e={x:n.pos.x,y:n.pos.y,w:i.w,h:i.h},l=0;l<this.endpointDropTargets.length;l++)if($r(e,this.endpointDropTargets[l].r)){t=this.endpointDropTargets[l];break}t!==this.currentDropTarget&&null!=this.currentDropTarget&&(r=this._getFloatingAnchorIndex(),this.instance.removeClass(this.currentDropTarget.el,He),this.currentDropTarget.endpoint&&(this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),this.currentDropTarget.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.out()),null!=t&&(this.instance.addClass(t.el,He),r=this._getFloatingAnchorIndex(),null!=t.endpoint)&&(t.endpoint.isSource&&0===r||t.endpoint.isTarget&&0!==r||this.jpc.suspendedEndpoint&&t.endpoint.referenceEndpoint&&t.endpoint.referenceEndpoint.id===this.jpc.suspendedEndpoint.id?(this.instance.checkCondition("checkDropAllowed",{sourceEndpoint:this.jpc.endpoints[r],targetEndpoint:t.endpoint.endpoint,connection:this.jpc})?(t.endpoint.endpoint.addClass(this.instance.endpointDropAllowedClass),t.endpoint.endpoint.removeClass(this.instance.endpointDropForbiddenClass)):(t.endpoint.endpoint.removeClass(this.instance.endpointDropAllowedClass),t.endpoint.endpoint.addClass(this.instance.endpointDropForbiddenClass)),this.floatingAnchor.over(t.endpoint),this.instance._paintConnection(this.jpc)):t=null),this.currentDropTarget=t}}},{key:"_maybeCleanup",value:function(n){n._mtNew&&0===n.connections.length?this.instance.deleteEndpoint(n):delete n._mtNew}},{key:"_reattachOrDiscard",value:function(n){var i=null!=this.jpc.suspendedEndpoint,e=this._getFloatingAnchorIndex();return i&&this._shouldReattach()?(0===e?(this.jpc.source=this.jpc.suspendedElement,this.jpc.sourceId=this.jpc.suspendedElementId):(this.jpc.target=this.jpc.suspendedElement,this.jpc.targetId=this.jpc.suspendedElementId),this._doForceReattach(e),!0):(this._discard(e,n),!1)}},{key:"onStop",value:function(n){var i=this,e=n.e;this.instance.isConnectionBeingDragged=!1,this.instance.currentlyDragging=!1;var t=function Ao(){for(var s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return o.join(" ")}(He,je);if(I(this.instance.getContainer().querySelectorAll(cu),function(v){i.instance.removeClass(v,t)}),this.jpc&&null!=this.jpc.endpoints){var h,a=null!=this.jpc.suspendedEndpoint,l=this._getFloatingAnchorIndex(),c=this.jpc.suspendedEndpoint;if(null!=this.currentDropTarget)if(null==(h=this._getDropEndpoint(n,this.jpc)))this._reattachOrDiscard(n.e);else if(c&&c.id===h.id)this._doForceReattach(l);else if(h.enabled)if(h.isFull())h.fire(br,{endpoint:this,connection:this.jpc,maxConnections:this.instance.defaults.maxConnections},e),this._reattachOrDiscard(n.e);else{0===l?(this.jpc.source=h.element,this.jpc.sourceId=h.elementId):(this.jpc.target=h.element,this.jpc.targetId=h.elementId);var f=!0;a&&this.jpc.suspendedEndpoint.id!==h.id&&(!this.jpc.isDetachAllowed(this.jpc)||!this.jpc.endpoints[l].isDetachAllowed(this.jpc)||!this.jpc.suspendedEndpoint.isDetachAllowed(this.jpc)||!this.instance.checkCondition("beforeDetach",this.jpc))&&(f=!1),(f=f&&h.isDropAllowed(this.jpc.sourceId,this.jpc.targetId,this.jpc.scope,this.jpc,h))?this._drop(h,l,e,f):this._reattachOrDiscard(n.e)}else this._reattachOrDiscard(n.e);else this._reattachOrDiscard(n.e);this.instance._refreshEndpoint(this.ep),this.ep.removeClass(this.instance.draggingClass),this._cleanupDraggablePlaceholder(),this.jpc.removeClass(this.instance.draggingClass),delete this.jpc.suspendedEndpoint,delete this.jpc.suspendedElement,delete this.jpc.suspendedElementType,delete this.jpc.suspendedElementId,delete this.jpc.suspendedIndex,delete this.floatingId,delete this.floatingIndex,delete this.floatingElement,delete this.floatingEndpoint,delete this.floatingAnchor,delete this.jpc.pending,null!=h&&this._maybeCleanup(h)}}},{key:"_getSourceDefinition",value:function(n){for(var i,e=this.instance.getContainer(),t=0;t<this.instance.sourceSelectors.length;t++)if((i=this.instance.sourceSelectors[t]).isEnabled()&&!1!==uu(n,e,i.selector,this.instance,i.exclude))return i}},{key:"_getDropEndpoint",value:function(n,i){var e;if(null==this.currentDropTarget.endpoint){var t=this.currentDropTarget.def,r=n.e.target||n.e.srcElement;if(null==t)return null;var a=this.currentDropTarget.targetEl,l=Us(n.e,a,this.instance.currentZoom),c=this.instance._deriveEndpointAndAnchorSpec(i.getType().join(" "),!0),h=c.endpoints?M(n,{endpoint:t.def.endpoint||c.endpoints[1],cssClass:t.def.cssClass||"",source:!0===t.def.source,target:!0===t.def.target}):n,f=this.instance.validAnchorsSpec(c.anchors)?c.anchors:this.instance.areDefaultAnchorsSet()?this.instance.defaults.anchors:null,v=t.def.anchor,g=(t.def.anchorPositionFinder?t.def.anchorPositionFinder(a,l,t.def,n.e):null)??v??(null!=f&&null!=f[1]?f[1]:null);if(null!=g&&(h=M(h,{anchor:g})),null!=t.def.portId&&(h.portId=t.def.portId),(h=un(h,t.def.parameterExtractor?t.def.parameterExtractor(this.currentDropTarget.el,r,n.e):{})).element=a,(e=this.instance._internal_newEndpoint(h))._mtNew=!0,e.deleteOnEmpty=!0,t.def.parameters&&e.mergeParameters(t.def.parameters),t.def.extract){var y={};for(var m in t.def.extract){var E=this.currentDropTarget.el.getAttribute(m);E&&(y[t.def.extract[m]]=E)}e.mergeParameters(y)}}else e=this.currentDropTarget.endpoint;return e&&(e.removeClass(this.instance.endpointDropAllowedClass),e.removeClass(this.instance.endpointDropForbiddenClass)),e}},{key:"_doForceReattach",value:function(n){this.floatingEndpoint.detachFromConnection(this.jpc,null,!0),this.jpc.endpoints[n]=this.jpc.suspendedEndpoint,this.instance.setHover(this.jpc,!1),this.jpc._forceDetach=!0,this.jpc.suspendedEndpoint.addConnection(this.jpc),this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.suspendedEndpoint.elementId,this.jpc,this.jpc.suspendedEndpoint.element,n),this.instance.deleteEndpoint(this.floatingEndpoint),this.instance.repaint(this.jpc.source),delete this.jpc._forceDetach}},{key:"_shouldReattach",value:function(){return!(!this.jpc.isReattach()&&!this.jpc._forceReattach&&nr(!0,!1,[[this.jpc.suspendedEndpoint,vt,[this.jpc]],[this.jpc.endpoints[this.jpc.suspendedElementType==ei?1:0],vt,[this.jpc]],[this.jpc,vt,[this.jpc]],[this.instance,yr,[Pr,this.jpc]]]))}},{key:"_discard",value:function(n,i){this.jpc.pending?this.instance.fire("connection:abort",this.jpc,i):(0===n?(this.jpc.source=this.jpc.suspendedEndpoint.element,this.jpc.sourceId=this.jpc.suspendedEndpoint.elementId):(this.jpc.target=this.jpc.suspendedEndpoint.element,this.jpc.targetId=this.jpc.suspendedEndpoint.elementId),this.jpc.endpoints[n]=this.jpc.suspendedEndpoint),this.floatingEndpoint&&this.floatingEndpoint.detachFromConnection(this.jpc),this.instance.deleteConnection(this.jpc,{originalEvent:i,force:!0})}},{key:"_drop",value:function(n,i,e,t){if(this.jpc.endpoints[i].detachFromConnection(this.jpc),this.jpc.suspendedEndpoint&&this.jpc.suspendedEndpoint.detachFromConnection(this.jpc),this.jpc.endpoints[i]=n,n.addConnection(this.jpc),this.jpc.suspendedEndpoint){var r=this.jpc.suspendedEndpoint.elementId;this.instance.fireMoveEvent({index:i,originalSourceId:0===i?r:this.jpc.sourceId,newSourceId:0===i?n.elementId:this.jpc.sourceId,originalTargetId:1===i?r:this.jpc.targetId,newTargetId:1===i?n.elementId:this.jpc.targetId,originalEndpoint:this.jpc.suspendedEndpoint,connection:this.jpc,newEndpoint:n},e)}1===i?this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.targetId,this.jpc,this.jpc.target,1):this.instance.sourceOrTargetChanged(this.floatingId,this.jpc.sourceId,this.jpc,this.jpc.source,0),this.jpc.endpoints[0].finalEndpoint&&(this.jpc.endpoints[0].detachFromConnection(this.jpc),this.jpc.endpoints[0]=this.jpc.endpoints[0].finalEndpoint,this.jpc.endpoints[0].addConnection(this.jpc)),Ne(t)&&this.jpc.mergeData(t),this._originalAnchorSpec&&(this.jpc.endpoints[0].setAnchor(this._originalAnchorSpec),this._originalAnchorSpec=null),this.instance._finaliseConnection(this.jpc,null,e),this.instance.setHover(this.jpc,!1),this.instance.revalidate(this.jpc.endpoints[0].element)}},{key:"_registerFloatingConnection",value:function(n,i){this.floatingConnections[n.id]=i}},{key:"_getFloatingAnchorIndex",value:function(){return null==this.floatingIndex?1:this.floatingIndex}}]),s}(),Cs=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),(t=o.call(this,i,e)).instance=i,t.dragSelection=e,u(d(t),"selector",[">",Na,X].join(" ")),u(d(t),"doRevalidate",void 0),t.doRevalidate=t._revalidate.bind(d(t)),t}return D(n,[{key:"reset",value:function(){this.drag.off(En,this.doRevalidate)}},{key:"_revalidate",value:function(e){this.instance.revalidate(e)}},{key:"init",value:function(e){this.drag=e,e.on(En,this.doRevalidate)}},{key:"useGhostProxy",value:function(e,t){var r=t._jsPlumbParentGroup;return null!=r&&!0===r.ghost}},{key:"makeGhostProxy",value:function(e){var t=e,r=t.cloneNode(!0);return r._jsPlumbParentGroup=t._jsPlumbParentGroup,r}}]),n}(Ai),Di=function(){function s(o,n){P(this,s),this.instance=o,this.overlay=n,u(this,"htmlElementOverlay",void 0),this.htmlElementOverlay=n}return D(s,null,[{key:"getElement",value:function(n,i,e){if(null==n.canvas){for(var r in e&&i?(n.canvas=e(i),n.instance.addClass(n.canvas,n.instance.overlayClass+" "+(n.cssClass?n.cssClass:""))):n.canvas=cr("div",{},n.instance.overlayClass+" "+(n.cssClass?n.cssClass:"")),n.instance.setAttribute(n.canvas,"jtk-overlay-id",n.id),n.attributes)n.instance.setAttribute(n.canvas,r,n.attributes[r]);n.canvas.style.position=Rt,n.instance._appendElement(n.canvas,n.instance.getContainer()),n.instance.getId(n.canvas);var a="translate(-50%, -50%)";n.canvas.style.webkitTransform=a,n.canvas.style.mozTransform=a,n.canvas.style.msTransform=a,n.canvas.style.oTransform=a,n.canvas.style.transform=a,n.isVisible()||(n.canvas.style.display=ft),n.canvas.jtk={overlay:n}}return n.canvas}},{key:"destroy",value:function(n){n.canvas&&n.canvas.parentNode&&n.canvas.parentNode.removeChild(n.canvas),delete n.canvas,delete n.cachedDimensions}},{key:"_getDimensions",value:function(n,i){return(null==n.cachedDimensions||i)&&(n.cachedDimensions={w:1,h:1}),n.cachedDimensions}}]),s}(),zt=function(){function s(){P(this,s),u(this,"_listeners",{}),u(this,"eventsSuspended",!1),u(this,"tick",!1),u(this,"eventsToDieOn",{ready:!0}),u(this,"queue",[])}return D(s,[{key:"fire",value:function(n,i,e){var t=null;if(this.tick)this.queue.unshift(arguments);else{if(this.tick=!0,!this.eventsSuspended&&this._listeners[n]){var r=this._listeners[n].length,a=0,l=!1;if(!this.shouldFireEvent||this.shouldFireEvent(n,i,e))for(;!l&&a<r&&!1!==t;){if(this.eventsToDieOn[n])this._listeners[n][a](i,e);else try{t=this._listeners[n][a](i,e)}catch(c){Z("jsPlumb: fire failed for event "+n+" : "+(c.message||c))}a++,(null==this._listeners||null==this._listeners[n])&&(l=!0)}}this.tick=!1,this._drain()}return t}},{key:"_drain",value:function(){var n=this.queue.pop();n&&this.fire.apply(this,n)}},{key:"unbind",value:function(n,i){if(0===arguments.length)this._listeners={};else if(1===arguments.length){if("string"==typeof n)delete this._listeners[n];else if(n.__jsPlumb)for(var t in n.__jsPlumb)rr(this._listeners[n.__jsPlumb[t]]||[],n)}else 2===arguments.length&&rr(this._listeners[n]||[],i);return this}},{key:"getListener",value:function(n){return this._listeners[n]||[]}},{key:"isSuspendEvents",value:function(){return this.eventsSuspended}},{key:"setSuspendEvents",value:function(n){this.eventsSuspended=n}},{key:"bind",value:function(n,i,e){var t=this,r=function(c){sr(t._listeners,c,i,e),i.__jsPlumb=i.__jsPlumb||{},i.__jsPlumb[q()]=c};if("string"==typeof n)r(n);else if(null!=n.length)for(var a=0;a<n.length;a++)r(n[a]);return this}},{key:"silently",value:function(n){this.setSuspendEvents(!0);try{n()}catch(i){Z("Cannot execute silent function "+i)}this.setSuspendEvents(!1)}}]),s}();function Mi(s){var o=null;return(o=Y(s)?{type:s,options:{}}:s).options.id=o.options.id||q(),o}!function(s){L(n,s);var o=k(n);function n(){return P(this,n),o.apply(this,arguments)}D(n,[{key:"shouldFireEvent",value:function(e,t,r){return!0}}])}(zt);var Mn=function(s){L(n,s);var o=k(n);function n(i,e,t){var r;for(var a in P(this,n),(r=o.call(this)).instance=i,r.component=e,u(d(r),"id",void 0),u(d(r),"type",void 0),u(d(r),"cssClass",void 0),u(d(r),"visible",!0),u(d(r),"location",void 0),u(d(r),"events",void 0),u(d(r),"attributes",void 0),r.id=(t=t||{}).id||q(),r.cssClass=t.cssClass||"",r.setLocation(t.location),r.events=t.events||{},r.attributes=t.attributes||{},r.events)r.bind(a,r.events[a]);return r}return D(n,[{key:"setLocation",value:function(e){var t=null==this.location?.5:this.location;if(null!=e)try{var r="string"==typeof e?parseFloat(e):e;isNaN(r)||(t=r)}catch{}this.location=t}},{key:"shouldFireEvent",value:function(e,t,r){return!0}},{key:"setVisible",value:function(e){this.visible=e,this.instance.setOverlayVisible(this,e)}},{key:"isVisible",value:function(){return this.visible}}]),n}(zt),xs={},it_get=function(o,n,i,e){var t=xs[n];if(t)return new t(o,i,e);throw{message:"jsPlumb: unknown overlay type '"+n+"'"}},it_register=function(o,n){xs[o]=n},rt=function(s){L(n,s);var o=k(n);function n(i,e,t){var r;return P(this,n),(r=o.call(this,i,e,t)).instance=i,r.component=e,u(d(r),"label",void 0),u(d(r),"labelText",void 0),u(d(r),"type",n.type),u(d(r),"cachedDimensions",void 0),r.setLabel((t=t||{label:""}).label),r}return D(n,[{key:"getLabel",value:function(){return Re(this.label)?this.label(this):this.labelText}},{key:"setLabel",value:function(e){this.label=e,this.labelText=null,this.instance.updateLabel(this)}},{key:"getDimensions",value:function(){return{w:1,h:1}}},{key:"updateFrom",value:function(e){null!=e.label&&this.setLabel(e.label),null!=e.location&&(this.setLocation(e.location),this.instance.updateLabel(this))}}]),n}(Mn);function Be(s){return s.type===rt.type}function wn(s){return null==s?null:s.split(" ").filter(function(o){return null!=o&&o.length>0})}function bs(s,o,n){for(var i in o)s[i]=n}u(rt,"type","Label"),it_register(rt.type,rt);var ks="__default",qt="__label",Ss="overlay";function bt(s,o){if(s.getDefaultType){var n=s.getTypeDescriptor(),i={},e=s.getDefaultType(),t=M({},e);bs(i,e,ks),s._types.forEach(function(r){if(r!==ks){var a=s.instance.getType(r,n);if(null!=a){var l=new Set(["connector","anchor","anchors"]);if("override"===a.mergeStrategy)for(var c in a)l.add(c);t=un(t,a,["cssClass"],function yo(s){var o=[];return s.forEach(function(n){o.push(n)}),o}(l)),bs(i,a,r)}}}),o&&(t=function vo(s,o,n,i){return function r(a){if(null!=a){if(Y(a))return function(a){var l=a.match(/(\${.*?})/g);if(null!=l)for(var c=0;c<l.length;c++){var h=o[l[c].substring(2,l[c].length-1)]||"";null!=h&&(a=a.replace(l[c],h))}if(null!=(l=a.match(/({{.*?}})/g)))for(var f=0;f<l.length;f++){var v=o[l[f].substring(2,l[f].length-2)]||"";null!=v&&(a=a.replace(l[f],v))}return a}(a);if(Re(a)&&!i&&(null==n||0===(a.name||"").indexOf(n)))return a(o);if(Array.isArray(a)){for(var l=[],c=0;c<a.length;c++)l.push(r(a[c]));return l}if(Ne(a)){var h={};for(var f in a)h[f]=r(a[f]);return h}return a}}(s)}(t,o,"_")),s.applyType(t,i)}}function wi(s,o){var n=s.instance.getType(o,s.getTypeDescriptor());null!=n&&n.cssClass&&s.removeClass(n.cssClass)}function As(s){if(s.paintStyle&&s.hoverPaintStyle){var o={};M(o,s.paintStyle),M(o,s.hoverPaintStyle),s.hoverPaintStyle=o}}var Os=function(s){L(n,s);var o=k(n);function n(i,e){var t;if(P(this,n),(t=o.call(this)).instance=i,u(d(t),"defaultLabelLocation",.5),u(d(t),"overlays",{}),u(d(t),"overlayPositions",{}),u(d(t),"overlayPlacements",{}),u(d(t),"clone",void 0),u(d(t),"deleted",void 0),u(d(t),"segment",void 0),u(d(t),"x",void 0),u(d(t),"y",void 0),u(d(t),"w",void 0),u(d(t),"h",void 0),u(d(t),"id",void 0),u(d(t),"visible",!0),u(d(t),"typeId",void 0),u(d(t),"params",{}),u(d(t),"paintStyle",void 0),u(d(t),"hoverPaintStyle",void 0),u(d(t),"paintStyleInUse",void 0),u(d(t),"_hover",!1),u(d(t),"lastPaintedAt",void 0),u(d(t),"data",void 0),u(d(t),"_defaultType",void 0),u(d(t),"events",void 0),u(d(t),"parameters",void 0),u(d(t),"_types",void 0),u(d(t),"_typeCache",void 0),u(d(t),"cssClass",void 0),u(d(t),"hoverClass",void 0),u(d(t),"beforeDetach",void 0),u(d(t),"beforeDrop",void 0),t.cssClass=(e=e||{}).cssClass||"",t.hoverClass=e.hoverClass||i.defaults.hoverClass,t.beforeDetach=e.beforeDetach,t.beforeDrop=e.beforeDrop,t._types=new Set,t._typeCache={},t.parameters=ln(e.parameters||{}),t.id=e.id||t.getIdPrefix()+(new Date).getTime(),t._defaultType={parameters:t.parameters,scope:e.scope||t.instance.defaultScope,overlays:{}},e.events)for(var r in e.events)t.bind(r,e.events[r]);t.clone=function(){var p=Object.create(t.constructor.prototype);return t.constructor.apply(p,[i,e]),p},t.overlays={},t.overlayPositions={};var a=e.overlays||[],l={},c=t.getDefaultOverlayKey();if(c){var h=t.instance.defaults[c];h&&a.push.apply(a,ce(h));for(var f=0;f<a.length;f++){var v=Mi(a[f]);l[v.options.id]=v}}return t._defaultType.overlays=l,e.label&&(t.getDefaultType().overlays[qt]={type:rt.type,options:{label:e.label,location:e.labelLocation||t.defaultLabelLocation,id:qt,cssClass:"jtk-default-label"}}),t}return D(n,[{key:"isDetachAllowed",value:function(e){var t=!0;if(this.beforeDetach)try{t=this.beforeDetach(e)}catch(r){Z("jsPlumb: beforeDetach callback failed",r)}return t}},{key:"isDropAllowed",value:function(e,t,r,a,l){var c,h={sourceId:e,targetId:t,scope:r,connection:a,dropEndpoint:l};if(this.beforeDrop)try{c=this.beforeDrop(h)}catch(f){Z("jsPlumb: beforeDrop callback failed",f)}else c=this.instance.checkCondition(oi,h);return c}},{key:"getDefaultType",value:function(){return this._defaultType}},{key:"appendToDefaultType",value:function(e){for(var t in e)this._defaultType[t]=e[t]}},{key:"getId",value:function(){return this.id}},{key:"cacheTypeItem",value:function(e,t,r){this._typeCache[r]=this._typeCache[r]||{},this._typeCache[r][e]=t}},{key:"getCachedTypeItem",value:function(e,t){return this._typeCache[t]?this._typeCache[t][e]:null}},{key:"setType",value:function(e,t){this.clearTypes(),(wn(e)||[]).forEach(this._types.add,this._types),bt(this,t)}},{key:"getType",value:function(){return Array.from(this._types.keys())}},{key:"reapplyTypes",value:function(e){bt(this,e)}},{key:"hasType",value:function(e){return this._types.has(e)}},{key:"addType",value:function(e,t){var r=wn(e),a=!1;if(null!=r){for(var l=0,c=r.length;l<c;l++)this._types.has(r[l])||(this._types.add(r[l]),a=!0);a&&bt(this,t)}}},{key:"removeType",value:function(e,t){var p,r=this,a=wn(e),l=!1;if(null!=a){for(var h=0,f=a.length;h<f;h++)l=!!r._types.has(p=a[h])&&(wi(r,p),r._types.delete(p),!0)||l;l&&bt(this,t)}}},{key:"clearTypes",value:function(e){var t=this;this._types.forEach(function(r){wi(t,r)}),this._types.clear(),bt(this,e)}},{key:"toggleType",value:function(e,t){var r=wn(e);if(null!=r){for(var a=0,l=r.length;a<l;a++)this._types.has(r[a])?(wi(this,r[a]),this._types.delete(r[a])):this._types.add(r[a]);bt(this,t)}}},{key:"applyType",value:function(e,t){if(this.setPaintStyle(e.paintStyle),this.setHoverPaintStyle(e.hoverPaintStyle),this.mergeParameters(e.parameters),this.paintStyleInUse=this.getPaintStyle(),e.overlays){var a,r={};for(a in e.overlays){var l=this.overlays[e.overlays[a].options.id];if(l)l.updateFrom(e.overlays[a].options),r[e.overlays[a].options.id]=!0,this.instance.reattachOverlay(l,this);else{var c=this.getCachedTypeItem(Ss,e.overlays[a].options.id);null!=c?(this.instance.reattachOverlay(c,this),c.setVisible(!0),c.updateFrom(e.overlays[a].options),this.overlays[c.id]=c):c=this.addOverlay(e.overlays[a]),r[c.id]=!0}}for(a in this.overlays)null==r[this.overlays[a].id]&&this.removeOverlay(this.overlays[a].id,!0)}}},{key:"setPaintStyle",value:function(e){this.paintStyle=e,this.paintStyleInUse=this.paintStyle,As(this)}},{key:"getPaintStyle",value:function(){return this.paintStyle}},{key:"setHoverPaintStyle",value:function(e){this.hoverPaintStyle=e,As(this)}},{key:"getHoverPaintStyle",value:function(){return this.hoverPaintStyle}},{key:"destroy",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions={},this.unbind(),this.clone=null}},{key:"isHover",value:function(){return this._hover}},{key:"mergeParameters",value:function(e){null!=e&&M(this.parameters,e)}},{key:"setVisible",value:function(e){this.visible=e,e?this.showOverlays():this.hideOverlays()}},{key:"isVisible",value:function(){return this.visible}},{key:"setAbsoluteOverlayPosition",value:function(e,t){this.overlayPositions[e.id]=t}},{key:"getAbsoluteOverlayPosition",value:function(e){return this.overlayPositions?this.overlayPositions[e.id]:null}},{key:"_clazzManip",value:function(e,t){for(var r in this.overlays)"add"===e?this.instance.addOverlayClass(this.overlays[r],t):"remove"===e&&this.instance.removeOverlayClass(this.overlays[r],t)}},{key:"addClass",value:function(e,t){var r=(this.cssClass||"").split(" ");r.push(e),this.cssClass=r.join(" "),this._clazzManip("add",e)}},{key:"removeClass",value:function(e,t){var r=(this.cssClass||"").split(" ");this.cssClass=r.filter(function(a){return a!==e}).join(" "),this._clazzManip("remove",e)}},{key:"getClass",value:function(){return this.cssClass}},{key:"shouldFireEvent",value:function(e,t,r){return!0}},{key:"getData",value:function(){return this.data}},{key:"setData",value:function(e){this.data=e||{}}},{key:"mergeData",value:function(e){this.data=M(this.data,e)}},{key:"addOverlay",value:function(e){var t=function mu(s,o){var n=null;if(Y(o))n=it_get(s.instance,o,s,{});else if(null!=o.type&&null!=o.options){var i=o,e=M({},i.options);n=it_get(s.instance,i.type,s,e)}else n=o;return n.id=n.id||q(),s.cacheTypeItem(Ss,n,n.id),s.overlays[n.id]=n,n}(this,e);if(this.getData&&t.type===rt.type&&!Y(e)){var r=this.getData();if(r){var c=r[e.options.labelLocationAttribute||"labelLocation"];c&&(t.location=c)}}return t}},{key:"getOverlay",value:function(e){return this.overlays[e]}},{key:"getOverlays",value:function(){return this.overlays}},{key:"hideOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!1)}},{key:"hideOverlays",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var a in t=t||[],this.overlays)(0===t.length||-1!==t.indexOf(a))&&this.overlays[a].setVisible(!1)}},{key:"showOverlay",value:function(e){var t=this.getOverlay(e);t&&t.setVisible(!0)}},{key:"showOverlays",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var a in t=t||[],this.overlays)(0===t.length||-1!==t.indexOf(a))&&this.overlays[a].setVisible(!0)}},{key:"removeAllOverlays",value:function(){for(var e in this.overlays)this.instance.destroyOverlay(this.overlays[e]);this.overlays={},this.overlayPositions=null,this.overlayPlacements={}}},{key:"removeOverlay",value:function(e,t){var r=this.overlays[e];r&&(r.setVisible(!1),t||this.instance.destroyOverlay(r),delete this.overlays[e],this.overlayPositions&&delete this.overlayPositions[e],this.overlayPlacements&&delete this.overlayPlacements[e])}},{key:"removeOverlays",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(var a=0,l=t.length;a<l;a++)this.removeOverlay(arguments[a])}},{key:"getLabel",value:function(){var e=this.getLabelOverlay();return null!=e?e.getLabel():null}},{key:"getLabelOverlay",value:function(){return this.getOverlay(qt)}},{key:"setLabel",value:function(e){var t=this.getLabelOverlay();if(t)if(Y(e)||Re(e))t.setLabel(e);else{var a=e;a.label&&t.setLabel(a.label),a.location&&(t.location=a.location)}else t=function _u(s,o){var i=M({cssClass:o.cssClass,id:qt,component:s},o);return new rt(s.instance,s,i)}(this,Y(e)||Re(e)?{label:e}:e),this.overlays[qt]=t}}]),n}(zt),Eu=["connectorStyle","connectorHoverStyle","connectorOverlays","connector","connectionType","connectorClass","connectorHoverClass"],kt=function(s){L(n,s);var o=k(n);function n(i,e){var t;P(this,n),(t=o.call(this,i,e)).instance=i,u(d(t),"connections",[]),u(d(t),"endpoint",void 0),u(d(t),"element",void 0),u(d(t),"elementId",void 0),u(d(t),"dragAllowedWhenFull",!0),u(d(t),"timestamp",void 0),u(d(t),"portId",void 0),u(d(t),"maxConnections",void 0),u(d(t),"proxiedBy",void 0),u(d(t),"connectorClass",void 0),u(d(t),"connectorHoverClass",void 0),u(d(t),"finalEndpoint",void 0),u(d(t),"enabled",!0),u(d(t),"isSource",void 0),u(d(t),"isTarget",void 0),u(d(t),"isTemporarySource",void 0),u(d(t),"connectionCost",1),u(d(t),"connectionsDirected",void 0),u(d(t),"connectionsDetachable",void 0),u(d(t),"reattachConnections",void 0),u(d(t),"currentAnchorClass",void 0),u(d(t),"referenceEndpoint",void 0),u(d(t),"edgeType",void 0),u(d(t),"connector",void 0),u(d(t),"connectorOverlays",void 0),u(d(t),"connectorStyle",void 0),u(d(t),"connectorHoverStyle",void 0),u(d(t),"deleteOnEmpty",void 0),u(d(t),"uuid",void 0),u(d(t),"scope",void 0),u(d(t),"_anchor",void 0),u(d(t),"defaultLabelLocation",[.5,.5]),t.appendToDefaultType({edgeType:e.edgeType,maxConnections:null==e.maxConnections?t.instance.defaults.maxConnections:e.maxConnections,paintStyle:e.paintStyle||t.instance.defaults.endpointStyle,hoverPaintStyle:e.hoverPaintStyle||t.instance.defaults.endpointHoverStyle,connectorStyle:e.connectorStyle,connectorHoverStyle:e.connectorHoverStyle,connectorClass:e.connectorClass,connectorHoverClass:e.connectorHoverClass,connectorOverlays:e.connectorOverlays,connector:e.connector}),t.enabled=!1!==e.enabled,t.visible=!0,t.element=e.element,t.uuid=e.uuid,t.portId=e.portId,t.elementId=e.elementId,t.connectionCost=null==e.connectionCost?1:e.connectionCost,t.connectionsDirected=e.connectionsDirected,t.currentAnchorClass="",t.events={},t.connectorOverlays=e.connectorOverlays,t.connectorStyle=e.connectorStyle,t.connectorHoverStyle=e.connectorHoverStyle,t.connector=e.connector,t.edgeType=e.edgeType,t.connectorClass=e.connectorClass,t.connectorHoverClass=e.connectorHoverClass,t.deleteOnEmpty=!0===e.deleteOnEmpty,t.isSource=e.source||!1,t.isTemporarySource=e.isTemporarySource||!1,t.isTarget=e.target||!1,t.connections=e.connections||[],t.scope=e.scope||i.defaultScope,t.timestamp=null,t.reattachConnections=e.reattachConnections||i.defaults.reattachConnections,t.connectionsDetachable=i.defaults.connectionsDetachable,!1===e.connectionsDetachable&&(t.connectionsDetachable=!1),t.dragAllowedWhenFull=!1!==e.dragAllowedWhenFull,e.onMaxConnections&&t.bind(br,e.onMaxConnections),t.setEndpoint(e.endpoint||e.existingEndpoint||i.defaults.endpoint),null!=e.preparedAnchor?t.setPreparedAnchor(e.preparedAnchor):t.setAnchor(e.anchor?e.anchor:e.anchors?e.anchors:i.defaults.anchor||we.Top);var l=[xn,e.type||""].join(" ");return t.addType(l,e.data),t}return D(n,[{key:"getIdPrefix",value:function(){return"_jsplumb_e"}},{key:"getTypeDescriptor",value:function(){return"endpoint"}},{key:"getXY",value:function(){return{x:this.endpoint.x,y:this.endpoint.y}}},{key:"getDefaultOverlayKey",value:function(){return"endpointOverlays"}},{key:"_updateAnchorClass",value:function(){var e=this._anchor&&this._anchor.cssClass;if(null!=e&&e.length>0){var t=this.instance.endpointAnchorClassPrefix+"-"+this.currentAnchorClass;this.currentAnchorClass=e;var r=this.instance.endpointAnchorClassPrefix+(this.currentAnchorClass?"-"+this.currentAnchorClass:"");t!==r&&(this.removeClass(t),this.addClass(r),this.instance.removeClass(this.element,t),this.instance.addClass(this.element,r))}}},{key:"setPreparedAnchor",value:function(e){return this.instance.router.setAnchor(this,e),this._updateAnchorClass(),this}},{key:"_anchorLocationChanged",value:function(e){this.fire("anchor:changed",{endpoint:this,anchor:e}),this._updateAnchorClass()}},{key:"setAnchor",value:function(e){var t=this.instance.router.prepareAnchor(e);return this.setPreparedAnchor(t),this}},{key:"addConnection",value:function(e){this.connections.push(e),this.instance._refreshEndpoint(this)}},{key:"detachFromConnection",value:function(e,t,r){(t=t??this.connections.indexOf(e))>=0&&(this.connections.splice(t,1),this.instance._refreshEndpoint(this)),!r&&this.deleteOnEmpty&&0===this.connections.length&&this.instance.deleteEndpoint(this)}},{key:"deleteEveryConnection",value:function(e){for(var t=this.connections.length,r=0;r<t;r++)this.instance.deleteConnection(this.connections[0],e)}},{key:"detachFrom",value:function(e){for(var t=[],r=0;r<this.connections.length;r++)(this.connections[r].endpoints[1]===e||this.connections[r].endpoints[0]===e)&&t.push(this.connections[r]);for(var a=0,l=t.length;a<l;a++)this.instance.deleteConnection(t[0]);return this}},{key:"setVisible",value:function(e,t,r){if(N(O(n.prototype),"setVisible",this).call(this,e),this.endpoint.setVisible(e),e?this.showOverlays():this.hideOverlays(),!t)for(var a=0;a<this.connections.length;a++)if(this.connections[a].setVisible(e),!r){var l=this===this.connections[a].endpoints[0]?1:0;1===this.connections[a].endpoints[l].connections.length&&this.connections[a].endpoints[l].setVisible(e,!0,!0)}}},{key:"applyType",value:function(e,t){N(O(n.prototype),"applyType",this).call(this,e,t),this.setPaintStyle(e.endpointStyle||e.paintStyle),this.setHoverPaintStyle(e.endpointHoverStyle||e.hoverPaintStyle),this.connectorStyle=e.connectorStyle,this.connectorHoverStyle=e.connectorHoverStyle,this.connector=e.connector,this.connectorOverlays=e.connectorOverlays,this.edgeType=e.edgeType,null!=e.maxConnections&&(this.maxConnections=e.maxConnections),e.scope&&(this.scope=e.scope),M(e,Eu),this.instance.applyEndpointType(this,e)}},{key:"destroy",value:function(){N(O(n.prototype),"destroy",this).call(this),this.deleted=!0,null!=this.endpoint&&this.instance.destroyEndpoint(this)}},{key:"isFull",value:function(){return 0===this.maxConnections||!(this.isFloating()||this.maxConnections<0||this.connections.length<this.maxConnections)}},{key:"isFloating",value:function(){return this.instance.router.isFloating(this)}},{key:"isConnectedTo",value:function(e){var t=!1;if(e)for(var r=0;r<this.connections.length;r++)if(this.connections[r].endpoints[1]===e||this.connections[r].endpoints[0]===e){t=!0;break}return t}},{key:"setDragAllowedWhenFull",value:function(e){this.dragAllowedWhenFull=e}},{key:"getUuid",value:function(){return this.uuid}},{key:"connectorSelector",value:function(){return this.connections[0]}},{key:"prepareEndpoint",value:function(e,t){var a,r={cssClass:this.cssClass,endpoint:this};if(lr(e,mt))(a=Ue.clone(e)).classes=r.cssClass.split(" ");else if(Y(e))a=Ue.get(this,e,r);else{var c=e;M(r,c.options||{}),a=Ue.get(this,c.type,r)}return a.typeId=t,a}},{key:"setEndpoint",value:function(e){var t=this.prepareEndpoint(e);this.setPreparedEndpoint(t)}},{key:"setPreparedEndpoint",value:function(e){null!=this.endpoint&&this.instance.destroyEndpoint(this),this.endpoint=e}},{key:"addClass",value:function(e,t){N(O(n.prototype),"addClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.addClass(e)}},{key:"removeClass",value:function(e,t){N(O(n.prototype),"removeClass",this).call(this,e,t),null!=this.endpoint&&this.endpoint.removeClass(e)}}]),n}(Os),In="anchors",Ii="connector";function Ds(s,o,n,i,e,t,r){var a;if(o)s.endpoints[n]=o,o.addConnection(s);else{var l=r||s.endpointSpec||s.endpointsSpec[n]||s.instance.defaults.endpoints[n]||s.instance.defaults.endpoint,c=s.endpointStyles[n]||s.endpointStyle||s.instance.defaults.endpointStyles[n]||s.instance.defaults.endpointStyle;null==c.fill&&null!=s.paintStyle&&(c.fill=s.paintStyle.stroke),null==c.outlineStroke&&null!=s.paintStyle&&(c.outlineStroke=s.paintStyle.outlineStroke),null==c.outlineWidth&&null!=s.paintStyle&&(c.outlineWidth=s.paintStyle.outlineWidth);var h=s.endpointHoverStyles[n]||s.endpointHoverStyle||s.endpointHoverStyle||s.instance.defaults.endpointHoverStyles[n]||s.instance.defaults.endpointHoverStyle;null!=s.hoverPaintStyle&&(null==h&&(h={}),null==h.fill&&(h.fill=s.hoverPaintStyle.stroke)),a=s.instance._internal_newEndpoint({paintStyle:c,hoverPaintStyle:h,endpoint:l,connections:[s],uuid:s.uuids?s.uuids[n]:null,element:e,scope:s.scope,anchor:i=i??(null!=s.instance.defaults.anchors?s.instance.defaults.anchors[n]:s.instance.defaults.anchor),reattachConnections:s.reattach||s.instance.defaults.reattachConnections,connectionsDetachable:s.detachable||s.instance.defaults.connectionsDetachable}),s.instance._refreshEndpoint(a),null==o&&(a.deleteOnEmpty=!0),s.endpoints[n]=a}return a}var Zt=function(s){L(n,s);var o=k(n);function n(i,e){var t;P(this,n),(t=o.call(this,i,e)).instance=i,u(d(t),"connector",void 0),u(d(t),"defaultLabelLocation",.5),u(d(t),"scope",void 0),u(d(t),"typeId","_jsplumb_connection"),u(d(t),"previousConnection",void 0),u(d(t),"sourceId",void 0),u(d(t),"targetId",void 0),u(d(t),"source",void 0),u(d(t),"target",void 0),u(d(t),"detachable",!0),u(d(t),"reattach",!1),u(d(t),"uuids",void 0),u(d(t),"cost",1),u(d(t),"directed",void 0),u(d(t),"endpoints",[null,null]),u(d(t),"endpointStyles",void 0),u(d(t),"endpointSpec",void 0),u(d(t),"endpointsSpec",void 0),u(d(t),"endpointStyle",{}),u(d(t),"endpointHoverStyle",{}),u(d(t),"endpointHoverStyles",void 0),u(d(t),"suspendedEndpoint",void 0),u(d(t),"suspendedIndex",void 0),u(d(t),"suspendedElement",void 0),u(d(t),"suspendedElementId",void 0),u(d(t),"suspendedElementType",void 0),u(d(t),"_forceReattach",void 0),u(d(t),"_forceDetach",void 0),u(d(t),"proxies",[]),u(d(t),"pending",!1),t.id=e.id,t.previousConnection=e.previousConnection,t.source=e.source,t.target=e.target,e.sourceEndpoint?(t.source=e.sourceEndpoint.element,t.sourceId=e.sourceEndpoint.elementId):t.sourceId=i.getId(t.source),e.targetEndpoint?(t.target=e.targetEndpoint.element,t.targetId=e.targetEndpoint.elementId):t.targetId=i.getId(t.target),t.scope=e.scope;var r=e.anchors?e.anchors[0]:e.anchor,a=e.anchors?e.anchors[1]:e.anchor;i.manage(t.source),i.manage(t.target),t.visible=!0,t.params={cssClass:e.cssClass,hoverClass:e.hoverClass,"pointer-events":e["pointer-events"],overlays:e.overlays},t.lastPaintedAt=null,e.type&&(e.endpoints=e.endpoints||t.instance._deriveEndpointAndAnchorSpec(e.type).endpoints),t.endpointSpec=e.endpoint,t.endpointsSpec=e.endpoints||[null,null],t.endpointStyle=e.endpointStyle,t.endpointHoverStyle=e.endpointHoverStyle,t.endpointStyles=e.endpointStyles||[null,null],t.endpointHoverStyles=e.endpointHoverStyles||[null,null],t.paintStyle=e.paintStyle,t.hoverPaintStyle=e.hoverPaintStyle,t.uuids=e.uuids,t.makeEndpoint(!0,t.source,t.sourceId,r,e.sourceEndpoint),t.makeEndpoint(!1,t.target,t.targetId,a,e.targetEndpoint),t.scope||(t.scope=t.endpoints[0].scope),null!=e.deleteEndpointsOnEmpty&&(t.endpoints[0].deleteOnEmpty=e.deleteEndpointsOnEmpty,t.endpoints[1].deleteOnEmpty=e.deleteEndpointsOnEmpty);var l=t.instance.defaults.connectionsDetachable;!1===e.detachable&&(l=!1),!1===t.endpoints[0].connectionsDetachable&&(l=!1),!1===t.endpoints[1].connectionsDetachable&&(l=!1),t.endpointsSpec=e.endpoints||[null,null],t.endpointSpec=e.endpoint||null;var c=e.reattach||t.endpoints[0].reattachConnections||t.endpoints[1].reattachConnections||t.instance.defaults.reattachConnections,h=M({},t.endpoints[0].connectorStyle||t.endpoints[1].connectorStyle||e.paintStyle||t.instance.defaults.paintStyle);if(t.appendToDefaultType({detachable:l,reattach:c,paintStyle:h,hoverPaintStyle:M({},t.endpoints[0].connectorHoverStyle||t.endpoints[1].connectorHoverStyle||e.hoverPaintStyle||t.instance.defaults.hoverPaintStyle)}),e.outlineWidth&&(h.outlineWidth=e.outlineWidth),e.outlineColor&&(h.outlineStroke=e.outlineColor),e.lineWidth&&(h.strokeWidth=e.lineWidth),e.color&&(h.stroke=e.color),!t.instance._suspendDrawing){var f=t.instance._suspendedAt||q();t.instance._paintEndpoint(t.endpoints[0],{timestamp:f}),t.instance._paintEndpoint(t.endpoints[1],{timestamp:f})}t.cost=e.cost||t.endpoints[0].connectionCost,t.directed=e.directed,null==e.directed&&(t.directed=t.endpoints[0].connectionsDirected);var v=M({},t.endpoints[1].parameters);M(v,t.endpoints[0].parameters),M(v,t.parameters),t.parameters=v,t.paintStyleInUse=t.getPaintStyle()||{},t._setConnector(t.endpoints[0].connector||t.endpoints[1].connector||e.connector||t.instance.defaults.connector,!0);var p=null!=e.data&&Ne(e.data)?e.data:{};t.setData(p);var g=[xn,t.endpoints[0].edgeType,t.endpoints[1].edgeType,e.type].join(" ");return/[^\s]/.test(g)&&t.addType(g,e.data),t}return D(n,[{key:"getIdPrefix",value:function(){return"_jsPlumb_c"}},{key:"getDefaultOverlayKey",value:function(){return"connectionOverlays"}},{key:"getXY",value:function(){return{x:this.connector.x,y:this.connector.y}}},{key:"makeEndpoint",value:function(e,t,r,a,l){return r=r||this.instance.getId(t),Ds(this,l,e?0:1,a,t)}},{key:"getTypeDescriptor",value:function(){return n.type}},{key:"isDetachable",value:function(e){return!1!==this.detachable&&(null!=e?!0===e.connectionsDetachable:!0===this.detachable)}},{key:"setDetachable",value:function(e){this.detachable=!0===e}},{key:"isReattach",value:function(){return!0===this.reattach||!0===this.endpoints[0].reattachConnections||!0===this.endpoints[1].reattachConnections}},{key:"setReattach",value:function(e){this.reattach=!0===e}},{key:"applyType",value:function(e,t){var r=null;null!=e.connector&&(null==(r=this.getCachedTypeItem(Ii,t.connector))&&(r=this.prepareConnector(e.connector,t.connector),this.cacheTypeItem(Ii,r,t.connector)),this.setPreparedConnector(r)),N(O(n.prototype),"applyType",this).call(this,e,t),null!=e.detachable&&this.setDetachable(e.detachable),null!=e.reattach&&this.setReattach(e.reattach),e.scope&&(this.scope=e.scope);var a=null;e.anchor?null==(a=this.getCachedTypeItem(In,t.anchor))&&(a=[Kt(e.anchor),Kt(e.anchor)],this.cacheTypeItem(In,a,t.anchor)):e.anchors&&null==(a=this.getCachedTypeItem(In,t.anchors))&&(a=[Kt(e.anchors[0]),Kt(e.anchors[1])],this.cacheTypeItem(In,a,t.anchors)),null!=a&&(this.instance.router.setConnectionAnchors(this,a),this.instance.router.isDynamicAnchor(this.endpoints[1])&&this.instance.repaint(this.endpoints[1].element)),this.instance.applyConnectorType(this.connector,e)}},{key:"addClass",value:function(e,t){N(O(n.prototype),"addClass",this).call(this,e),t&&(this.endpoints[0].addClass(e),this.endpoints[1].addClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.addClass(e)),this.connector&&this.instance.addConnectorClass(this.connector,e)}},{key:"removeClass",value:function(e,t){N(O(n.prototype),"removeClass",this).call(this,e),t&&(this.endpoints[0].removeClass(e),this.endpoints[1].removeClass(e),this.suspendedEndpoint&&this.suspendedEndpoint.removeClass(e)),this.connector&&this.instance.removeConnectorClass(this.connector,e)}},{key:"setVisible",value:function(e){N(O(n.prototype),"setVisible",this).call(this,e),this.connector&&this.instance.setConnectorVisible(this.connector,e),this.instance._paintConnection(this)}},{key:"destroy",value:function(){N(O(n.prototype),"destroy",this).call(this),this.endpoints=null,this.endpointStyles=null,this.source=null,this.target=null,this.instance.destroyConnector(this),this.connector=null,this.deleted=!0}},{key:"getUuids",value:function(){return[this.endpoints[0].getUuid(),this.endpoints[1].getUuid()]}},{key:"prepareConnector",value:function(e,t){var a,r={cssClass:this.params.cssClass,hoverClass:this.params.hoverClass,"pointer-events":this.params["pointer-events"]};return a=Y(e)?this.instance._makeConnector(this,e,r):this.instance._makeConnector(this,e.type,un(e.options||{},r)),null!=t&&(a.typeId=t),a}},{key:"setPreparedConnector",value:function(e,t,r,a){if(this.connector!==e){var l,c="";if(null!=this.connector&&(l=this.connector,c=this.instance.getConnectorClass(this.connector),this.instance.destroyConnector(this)),this.connector=e,a&&this.cacheTypeItem(Ii,e,a),this.addClass(c),null!=l){var h=this.getOverlays();for(var f in h)this.instance.reattachOverlay(h[f],this)}t||this.instance._paintConnection(this)}}},{key:"_setConnector",value:function(e,t,r,a){var l=this.prepareConnector(e,a);this.setPreparedConnector(l,t,r,a)}},{key:"replaceEndpoint",value:function(e,t){var r=this.endpoints[e],l=this.instance.getEndpoints(r.element),c=l.indexOf(r),h=Ds(this,null,e,null,r.element,0,t);this.endpoints[e]=h,l.splice(c,1,h),r.detachFromConnection(this),this.instance.deleteEndpoint(r),this.instance.fire("endpoint:replaced",{previous:r,current:h})}}]),n}(Os);function Jt(s){if(null==s.path){var o=M({"jtk-overlay-id":s.id},s.attributes);s.path=Ce(li,o),s.instance.addClass(s.path,s.instance.overlayClass+" "+(s.cssClass?s.cssClass:"")),s.path.jtk={overlay:s}}var i=s.path.parentNode;if(null==i){if(s.component instanceof Zt){var e=s.component.connector;i=null!=e?e.canvas:null}else if(s.component instanceof kt){var t=s.component.endpoint;i=null!=t?t.canvas:t}null!=i&&_n(i,s.path,1)}return s.path}u(Zt,"type","connection"),function(s){L(n,s);var o=k(n);function n(){var i;P(this,n);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return u(d(i=o.call.apply(o,[this].concat(t))),"path",void 0),i}}(Mn);var Ms=function(){function s(){P(this,s)}return D(s,null,[{key:"paint",value:function(n,i,e,t){if(null!=e){var r=[n.x,n.y],a=[n.w,n.h];if(null!=t&&(t.xmin<0&&(r[0]+=t.xmin),t.ymin<0&&(r[1]+=t.ymin),a[0]=t.xmax+(t.xmin<0?-t.xmin:0),a[1]=t.ymax+(t.ymin<0?-t.ymin:0)),isFinite(a[0])&&isFinite(a[1]))Ee(n.canvas,M({width:""+(a[0]||0),height:""+(a[1]||0)},i.containerType===ht.HTML?{style:Or([r[0],r[1]])}:{x:r[0],y:r[1]}))}}}]),s}();var Su=function(){function s(){P(this,s)}return D(s,null,[{key:"getEndpointElement",value:function(n){if(null!=n.canvas)return n.canvas;var i=Ce("svg",{style:"",width:"0",height:"0","pointer-events":"all",position:Rt});n.canvas=i;var e=n.classes.join(" ");n.instance.addClass(i,e);for(var t=n.endpoint.scope.split(/\s/),r=0;r<t.length;r++)n.instance.setAttribute(i,gr+t[r],"true");return n.instance._appendElementToContainer(i),null!=n.cssClass&&n.instance.addClass(i,n.cssClass),n.instance.addClass(i,n.instance.endpointClass),i.jtk=i.jtk||{},i.jtk.endpoint=n.endpoint,i.style.display=!1!==n.endpoint.visible?ti:ft,i}},{key:"paint",value:function(n,i,e){if(!0!==n.endpoint.deleted){this.getEndpointElement(n),Ms.paint(n,n.instance,e);var t=M({},e);t.outlineStroke&&(t.stroke=t.outlineStroke),null==n.node?(n.node=i.makeNode(n,t),n.canvas.appendChild(n.node)):null!=i.updateNode&&i.updateNode(n,n.node),ci(0,n.node,t)}}}]),s}(),Ln=function(){function s(o,n){P(this,s),this.connection=o,u(this,"type",void 0),u(this,"edited",!1),u(this,"stub",void 0),u(this,"sourceStub",void 0),u(this,"targetStub",void 0),u(this,"maxStub",void 0),u(this,"typeId",void 0),u(this,"gap",void 0),u(this,"sourceGap",void 0),u(this,"targetGap",void 0),u(this,"segments",[]),u(this,"totalLength",0),u(this,"segmentProportions",[]),u(this,"segmentProportionalLengths",[]),u(this,"paintInfo",null),u(this,"strokeWidth",void 0),u(this,"x",void 0),u(this,"y",void 0),u(this,"w",void 0),u(this,"h",void 0),u(this,"segment",void 0),u(this,"bounds",{xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}),u(this,"cssClass",void 0),u(this,"hoverClass",void 0),u(this,"geometry",void 0),this.stub=n.stub||this.getDefaultStubs(),this.sourceStub=Array.isArray(this.stub)?this.stub[0]:this.stub,this.targetStub=Array.isArray(this.stub)?this.stub[1]:this.stub,this.gap=n.gap||0,this.sourceGap=Array.isArray(this.gap)?this.gap[0]:this.gap,this.targetGap=Array.isArray(this.gap)?this.gap[1]:this.gap,this.maxStub=Math.max(this.sourceStub,this.targetStub),this.cssClass=n.cssClass||"",this.hoverClass=n.hoverClass||""}return D(s,[{key:"getTypeDescriptor",value:function(){return"connector"}},{key:"getIdPrefix",value:function(){return"_jsplumb_connector"}},{key:"setGeometry",value:function(n,i){this.geometry=n,this.edited=null!=n&&!i}},{key:"exportGeometry",value:function(){return this.geometry}},{key:"importGeometry",value:function(n){return this.geometry=n,!0}},{key:"resetGeometry",value:function(){this.geometry=null,this.edited=!1}},{key:"transformAnchorPlacement",value:function(n,i,e){return{x:n.x,y:n.y,ox:n.ox,oy:n.oy,curX:n.curX+i,curY:n.curY+e}}},{key:"resetBounds",value:function(){this.bounds={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0}}},{key:"findSegmentForPoint",value:function(n,i){for(var e={d:1/0,s:null,x:null,y:null,l:null,x1:null,y1:null,x2:null,y2:null,index:null,connectorLocation:null},t=0;t<this.segments.length;t++){var r=this.segments[t].findClosestPointOnPath(n,i);r.d<e.d&&(e.d=r.d,e.l=r.l,e.x=r.x,e.y=r.y,e.s=this.segments[t],e.x1=r.x1,e.x2=r.x2,e.y1=r.y1,e.y2=r.y2,e.index=t,e.connectorLocation=this.segmentProportions[t][0]+r.l*(this.segmentProportions[t][1]-this.segmentProportions[t][0]))}return e}},{key:"lineIntersection",value:function(n,i,e,t){for(var r=[],a=0;a<this.segments.length;a++)r.push.apply(r,this.segments[a].lineIntersection(n,i,e,t));return r}},{key:"boxIntersection",value:function(n,i,e,t){for(var r=[],a=0;a<this.segments.length;a++)r.push.apply(r,this.segments[a].boxIntersection(n,i,e,t));return r}},{key:"boundingBoxIntersection",value:function(n){for(var i=[],e=0;e<this.segments.length;e++)i.push.apply(i,this.segments[e].boundingBoxIntersection(n));return i}},{key:"_updateSegmentProportions",value:function(){for(var n=0,i=0;i<this.segments.length;i++){var e=this.segments[i].getLength();this.segmentProportionalLengths[i]=e/this.totalLength,this.segmentProportions[i]=[n,n+=e/this.totalLength]}}},{key:"_findSegmentForLocation",value:function(n,i){var e,t,r;if(i&&(n=n>0?n/this.totalLength:(this.totalLength+n)/this.totalLength),1===n)e=this.segments.length-1,r=1;else if(0===n)r=0,e=0;else if(n>=.5){for(e=0,r=0,t=this.segmentProportions.length-1;t>-1;t--)if(this.segmentProportions[t][1]>=n&&this.segmentProportions[t][0]<=n){e=t,r=(n-this.segmentProportions[t][0])/this.segmentProportionalLengths[t];break}}else for(e=this.segmentProportions.length-1,r=1,t=0;t<this.segmentProportions.length;t++)if(this.segmentProportions[t][1]>=n){e=t,r=(n-this.segmentProportions[t][0])/this.segmentProportionalLengths[t];break}return{segment:this.segments[e],proportion:r,index:e}}},{key:"_addSegment",value:function(n,i){if(i.x1!==i.x2||i.y1!==i.y2){var e=new n(i);this.segments.push(e),this.totalLength+=e.getLength(),this.updateBounds(e)}}},{key:"_clearSegments",value:function(){this.totalLength=0,this.segments.length=0,this.segmentProportions.length=0,this.segmentProportionalLengths.length=0}},{key:"getLength",value:function(){return this.totalLength}},{key:"_prepareCompute",value:function(n){this.strokeWidth=n.strokeWidth;var i=n.sourcePos.curX,e=n.targetPos.curX,t=n.sourcePos.curY,r=n.targetPos.curY,a=Ci({x:i,y:t},{x:e,y:r}),l=e<i,c=r<t,h=[n.sourcePos.ox,n.sourcePos.oy],f=[n.targetPos.ox,n.targetPos.oy],v=l?e:i,p=c?r:t,g=Math.abs(e-i),_=Math.abs(r-t),y=0===h[0]&&0===h[1],m=0===f[0]&&0===f[1];if(y||m){var E=g>_?0:1,C=[1,0][E],b=0===E?i:t,A=0===E?e:r;y&&(h[E]=b>A?-1:1,h[C]=0),m&&(f[E]=b>A?1:-1,f[C]=0)}var w=l?g+this.sourceGap*h[0]:this.sourceGap*h[0],S=c?_+this.sourceGap*h[1]:this.sourceGap*h[1],x=l?this.targetGap*f[0]:g+this.targetGap*f[0],R=c?this.targetGap*f[1]:_+this.targetGap*f[1],G=h[0]*f[0]+h[1]*f[1],B={sx:w,sy:S,tx:x,ty:R,xSpan:Math.abs(x-w),ySpan:Math.abs(R-S),mx:(w+x)/2,my:(S+R)/2,so:h,to:f,x:v,y:p,w:g,h:_,segment:a,startStubX:w+h[0]*this.sourceStub,startStubY:S+h[1]*this.sourceStub,endStubX:x+f[0]*this.targetStub,endStubY:R+f[1]*this.targetStub,isXGreaterThanStubTimes2:Math.abs(w-x)>this.sourceStub+this.targetStub,isYGreaterThanStubTimes2:Math.abs(S-R)>this.sourceStub+this.targetStub,opposite:-1===G,perpendicular:0===G,orthogonal:1===G,sourceAxis:0===h[0]?"y":"x",points:[v,p,g,_,w,S,x,R],stubs:[this.sourceStub,this.targetStub]};return B.anchorOrientation=B.opposite?"opposite":B.orthogonal?"orthogonal":"perpendicular",B}},{key:"updateBounds",value:function(n){var i=n.extents;this.bounds.xmin=Math.min(this.bounds.xmin,i.xmin),this.bounds.xmax=Math.max(this.bounds.xmax,i.xmax),this.bounds.ymin=Math.min(this.bounds.ymin,i.ymin),this.bounds.ymax=Math.max(this.bounds.ymax,i.ymax)}},{key:"dumpSegmentsToConsole",value:function(){Z("SEGMENTS:");for(var n=0;n<this.segments.length;n++)Z(this.segments[n].type,""+this.segments[n].getLength(),""+this.segmentProportions[n])}},{key:"pointOnPath",value:function(n,i){var e=this._findSegmentForLocation(n,i);return e.segment&&e.segment.pointOnPath(e.proportion,!1)||{x:0,y:0}}},{key:"gradientAtPoint",value:function(n,i){var e=this._findSegmentForLocation(n,i);return e.segment&&e.segment.gradientAtPoint(e.proportion,!1)||0}},{key:"pointAlongPathFrom",value:function(n,i,e){var t=this._findSegmentForLocation(n,e);return t.segment&&t.segment.pointAlongPathFrom(t.proportion,i,!1)||{x:0,y:0}}},{key:"compute",value:function(n){this.paintInfo=this._prepareCompute(n),this._clearSegments(),this._compute(this.paintInfo,n),this.x=this.paintInfo.points[0],this.y=this.paintInfo.points[1],this.w=this.paintInfo.points[2],this.h=this.paintInfo.points[3],this.segment=this.paintInfo.segment,this._updateSegmentProportions()}},{key:"setAnchorOrientation",value:function(n,i){}}]),s}(),St=function(s){L(n,s);var o=k(n);function n(i,e,t){var r;return P(this,n),(r=o.call(this,i,e,t)).instance=i,r.component=e,u(d(r),"width",void 0),u(d(r),"length",void 0),u(d(r),"foldback",void 0),u(d(r),"direction",void 0),u(d(r),"location",.5),u(d(r),"paintStyle",void 0),u(d(r),"type",n.type),u(d(r),"cachedDimensions",void 0),r.width=(t=t||{}).width||20,r.length=t.length||20,r.direction=(t.direction||1)<0?-1:1,r.foldback=t.foldback||.623,r.paintStyle=t.paintStyle||{strokeWidth:1},r.location=null==t.location?r.location:Array.isArray(t.location)?t.location[0]:t.location,r}return D(n,[{key:"draw",value:function(e,t,r){if(e instanceof Ln){var l,h,f,a=e;if(this.location>1||this.location<0){var p=this.location<0?1:0;h=nt(l=a.pointAlongPathFrom(p,this.location,!1),a.pointAlongPathFrom(p,this.location-this.direction*this.length/2,!1),this.length)}else if(1===this.location){if(h=nt(l=a.pointOnPath(this.location),a.pointAlongPathFrom(this.location,-this.length),this.length),-1===this.direction){var g=h;h=l,l=g}}else if(0===this.location){if(l=nt(h=a.pointOnPath(this.location),a.pointAlongPathFrom(this.location,this.length),this.length),-1===this.direction){var _=h;h=l,l=_}}else h=nt(l=a.pointAlongPathFrom(this.location,this.direction*this.length/2),a.pointOnPath(this.location),this.length);return f=function al(s,o,n){var i=yt(s,o),e=Math.atan(-1/i),t=n/2*Math.sin(e),r=n/2*Math.cos(e);return[{x:o.x+r,y:o.y+t},{x:o.x-r,y:o.y-t}]}(l,h,this.width),{component:e,d:{hxy:l,tail:f,cxy:nt(l,h,this.foldback*this.length)},"stroke-width":this.paintStyle.strokeWidth||t.strokeWidth,stroke:this.paintStyle.stroke||t.stroke,fill:this.paintStyle.fill||t.stroke,xmin:Math.min(l.x,f[0].x,f[1].x),xmax:Math.max(l.x,f[0].x,f[1].x),ymin:Math.min(l.y,f[0].y,f[1].y),ymax:Math.max(l.y,f[0].y,f[1].y)}}}},{key:"updateFrom",value:function(e){}}]),n}(Mn);function Li(s){return s.type===St.type}u(St,"type","Arrow"),it_register(St.type,St);var Gn=function(s){L(n,s);var o=k(n);function n(i,e,t){var r;return P(this,n),(r=o.call(this,i,e,t)).instance=i,u(d(r),"type",n.type),r.length=r.length/2,r.foldback=2,r}return n}(St);function Gi(s){return s.type===Gn.type}u(Gn,"type","Diamond"),it_register(Gn.type,Gn);var Ni=function(s){L(n,s);var o=k(n);function n(i,e,t){var r;return P(this,n),(r=o.call(this,i,e,t)).instance=i,u(d(r),"type",n.type),r.foldback=1,r}return n}(St);function Ri(s){return s.type===Ni.type}u(Ni,"type","PlainArrow"),it_register("PlainArrow",Ni);var Nn=function(s){L(n,s);var o=k(n);function n(i,e,t){var r;return P(this,n),(r=o.call(this,i,e,t)).instance=i,r.component=e,u(d(r),"create",void 0),u(d(r),"type",n.type),r.create=t.create,r}return D(n,[{key:"updateFrom",value:function(e){}}]),n}(Mn);function Ye(s){return s.type===Nn.type}u(Nn,"type","Custom"),it_register(Nn.type,Nn);var Pt="paintStyle",Tt=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),u(d(t=o.call(this,i,e)),"radius",void 0),u(d(t),"defaultOffset",void 0),u(d(t),"defaultInnerRadius",void 0),u(d(t),"type",n.type),t.radius=(e=e||{}).radius||5,t.defaultOffset=.5*t.radius,t.defaultInnerRadius=t.radius/3,t}return n}(mt);u(Tt,"type","Dot");var Du={type:Tt.type,cls:Tt,compute:function(o,n,i,e){var t=n.curX-o.radius,r=n.curY-o.radius,a=2*o.radius,l=2*o.radius;if(e&&e.stroke){var c=e.strokeWidth||1;t-=c,r-=c,a+=2*c,l+=2*c}return o.x=t,o.y=r,o.w=a,o.h=l,[t,r,a,l,o.radius]},getParams:function(o){return{radius:o.radius}}},Fi=function s(o,n){P(this,s),this.instance=o,this.el=n,u(this,"group",void 0)},Mu=function(s){L(n,s);var o=k(n);function n(i,e,t){var r;P(this,n),(r=o.call(this,i,e)).instance=i,u(d(r),"children",[]),u(d(r),"collapsed",!1),u(d(r),"droppable",void 0),u(d(r),"enabled",void 0),u(d(r),"orphan",void 0),u(d(r),"constrain",void 0),u(d(r),"proxied",void 0),u(d(r),"ghost",void 0),u(d(r),"revert",void 0),u(d(r),"prune",void 0),u(d(r),"dropOverride",void 0),u(d(r),"anchor",void 0),u(d(r),"endpoint",void 0),u(d(r),"connections",{source:[],target:[],internal:[]}),u(d(r),"manager",void 0),u(d(r),"id",void 0),u(d(r),"elId",void 0);var a=r.el;return a._isJsPlumbGroup=!0,a._jsPlumbGroup=d(r),r.elId=i.getId(e),r.orphan=!0===t.orphan,r.revert=!0!==r.orphan&&!1!==t.revert,r.droppable=!1!==t.droppable,r.ghost=!0===t.ghost,r.enabled=!1!==t.enabled,r.prune=!0!==r.orphan&&!0===t.prune,r.constrain=r.ghost||!0===t.constrain,r.proxied=!1!==t.proxied,r.id=t.id||q(),r.dropOverride=!0===t.dropOverride,r.anchor=t.anchor,r.endpoint=t.endpoint,r.anchor=t.anchor,i.setAttribute(e,vr,""),r}return D(n,[{key:"contentArea",get:function(){return this.instance.getGroupContentArea(this)}},{key:"overrideDrop",value:function(e,t){return this.dropOverride&&(this.revert||this.prune||this.orphan)}},{key:"getAnchor",value:function(e,t){return this.anchor||"Continuous"}},{key:"getEndpoint",value:function(e,t){return this.endpoint||{type:Tt.type,options:{radius:10}}}},{key:"add",value:function(e,t){var r=this.instance.getGroupContentArea(this),a=e;if(null!=a._jsPlumbParentGroup){if(a._jsPlumbParentGroup===this)return;a._jsPlumbParentGroup.remove(e,!0,t,!1)}a._jsPlumbParentGroup=this,this.children.push(new Fi(this.instance,e)),this.instance._appendElement(a,r),this.manager._updateConnectionsForGroup(this)}},{key:"resolveNode",value:function(e){return null==e?null:zn(this.children,function(t){return t.el===e})}},{key:"remove",value:function(e,t,r,a,l){var c=this.resolveNode(e);null!=c&&this._doRemove(c,t,r,a,l)}},{key:"_doRemove",value:function(e,t,r,a,l){var c=e.el;if(delete c._jsPlumbParentGroup,J(this.children,function(f){return f===e}),t)try{this.instance.getGroupContentArea(this).removeChild(c)}catch(f){Z("Could not remove element from Group "+f)}if(!r){var h={group:this,el:c};l&&(h.targetGroup=l),this.instance.fire("group:member:removed",h)}a||this.manager._updateConnectionsForGroup(this)}},{key:"removeAll",value:function(e,t){for(var r=0,a=this.children.length;r<a;r++){var l=this.children[0];this._doRemove(l,e,t,!0),this.instance.unmanage(l.el,!0)}this.children.length=0,this.manager._updateConnectionsForGroup(this)}},{key:"orphanAll",value:function(){for(var e={},t=0;t<this.children.length;t++){var r=this.manager.orphan(this.children[t].el,!1);e[r.id]=r.pos}return this.children.length=0,e}},{key:"addGroup",value:function(e){if(this.instance.allowNestedGroups&&e!==this){if(this.instance.groupManager.isAncestor(this,e))return!1;null!=e.group&&e.group.removeGroup(e);var t=this.instance.getId(e.el);this.instance.getManagedElements()[t].group=this.elId;var a=this.instance.getOffsetRelativeToRoot(e.el),l=this.instance.getOffsetRelativeToRoot(this.collapsed?this.el:this.instance.getGroupContentArea(this));return e.el._jsPlumbParentGroup=this,this.children.push(e),this.instance._appendElementToGroup(this,e.el),e.group=this,this.instance.setPosition(e.el,{x:a.x-l.x,y:a.y-l.y}),this.instance.fire("group:nested:added",{parent:this,child:e}),!0}return!1}},{key:"removeGroup",value:function(e){if(e.group===this){var t=e.el,r=this.instance.getGroupContentArea(this);r===t.parentNode&&r.removeChild(e.el);var a=this.instance.getId(e.el),l=this.instance.getManagedElements()[a];l&&delete l.group,this.children=this.children.filter(function(c){return c.id!==e.id}),delete e.group,delete t._jsPlumbParentGroup,this.instance.fire("group:nested:removed",{parent:this,child:e})}}},{key:"getGroups",value:function(){return this.children.filter(function(e){return e.constructor===n})}},{key:"getNodes",value:function(){return this.children.filter(function(e){return e.constructor===Fi})}},{key:"collapseParent",get:function(){var e=null;if(null==this.group)return null;for(var t=this.group;null!=t;)t.collapsed&&(e=t),t=t.group;return e}}]),n}(Fi),wu=function(){function s(o){var n=this;P(this,s),this.instance=o,u(this,"groupMap",{}),u(this,"_connectionSourceMap",{}),u(this,"_connectionTargetMap",{}),o.bind(_r,function(i){var e=n.getGroupFor(i.source),t=n.getGroupFor(i.target);null!=e&&null!=t&&e===t?(n._connectionSourceMap[i.connection.id]=e,n._connectionTargetMap[i.connection.id]=e,wt(e.connections.internal,i.connection)):(null!=e&&(wt(i.target._jsPlumbGroup===e?e.connections.internal:e.connections.source,i.connection),n._connectionSourceMap[i.connection.id]=e),null!=t&&(wt(i.source._jsPlumbGroup===t?t.connections.internal:t.connections.target,i.connection),n._connectionTargetMap[i.connection.id]=t))}),o.bind(si,function(i){n._cleanupDetachedConnection(i.connection)}),o.bind(Er,function(i){var t=n.getGroupFor(i.originalEndpoint.element),l=n.getGroupFor(i.connection.endpoints[i.index].element),c=0===i.index?n._connectionSourceMap:n._connectionTargetMap,h=0===i.index?n._connectionTargetMap:n._connectionSourceMap;null!=l?(c[i.connection.id]=l,i.connection.source===i.connection.target&&(h[i.connection.id]=l)):(delete c[i.connection.id],i.connection.source===i.connection.target&&delete h[i.connection.id]),null!=t&&n._updateConnectionsForGroup(t),null!=l&&n._updateConnectionsForGroup(l)})}return D(s,[{key:"_cleanupDetachedConnection",value:function(n){n.proxies.length=0;var e,i=this._connectionSourceMap[n.id];null!=i&&(J(i.connections.source,e=function(r){return r.id===n.id}),J(i.connections.target,e),J(i.connections.internal,e),delete this._connectionSourceMap[n.id]),null!=(i=this._connectionTargetMap[n.id])&&(J(i.connections.source,e=function(r){return r.id===n.id}),J(i.connections.target,e),J(i.connections.internal,e),delete this._connectionTargetMap[n.id])}},{key:"addGroup",value:function(n){var i=n.el;if(null!=this.groupMap[n.id])throw new Error("cannot create Group ["+n.id+"]; a Group with that ID exists");if(null!=i._isJsPlumbGroup)throw new Error("cannot create Group ["+n.id+"]; the given element is already a Group");var e=new Mu(this.instance,n.el,n);return this.groupMap[e.id]=e,n.collapsed&&this.collapseGroup(e),this.instance.manage(e.el),this.instance.addClass(e.el,Ft),e.manager=this,this._updateConnectionsForGroup(e),this.instance.fire("group:added",{group:e}),e}},{key:"getGroup",value:function(n){var i=n;if(Y(n)&&null==(i=this.groupMap[n]))throw new Error("No such group ["+n+"]");return i}},{key:"getGroupFor",value:function(n){for(var i=n,e=this.instance.getContainer(),t=!1,r=null;!t;)null==i||i===e?t=!0:i._jsPlumbParentGroup?(r=i._jsPlumbParentGroup,t=!0):i=i.parentNode;return r}},{key:"getGroups",value:function(){var n=[];for(var i in this.groupMap)n.push(this.groupMap[i]);return n}},{key:"removeGroup",value:function(n,i,e,t){var r=this,a=this.getGroup(n);this.expandGroup(a,!0);var l={};return I(a.children,function(c){var h=r.instance.getManagedElements()[r.instance.getId(c.el)];h&&delete h.group}),i?(I(a.getGroups(),function(c){return r.removeGroup(c,i,e)}),a.removeAll(e,t)):(a.group&&I(a.children,function(c){return a.group.add(c.el)}),l=a.orphanAll()),a.group&&a.group.removeGroup(a),this.instance.unmanage(a.el,!0),delete this.groupMap[a.id],this.instance.fire("group:removed",{group:a}),l}},{key:"removeAllGroups",value:function(n,i,e){for(var t in this.groupMap)this.removeGroup(this.groupMap[t],n,i,e)}},{key:"forEach",value:function(n){for(var i in this.groupMap)n(this.groupMap[i])}},{key:"orphan",value:function(n,i){var e=n;if(e._jsPlumbParentGroup){var t=e._jsPlumbParentGroup,r=this.instance.getId(e),a=this.instance.getOffset(n);return!0!==i&&t.group?this.instance._appendElementToGroup(t.group,n):this.instance._appendElementToContainer(n),this.instance.setPosition(n,a),delete e._jsPlumbParentGroup,{id:r,pos:a}}}},{key:"_updateConnectionsForGroup",value:function(n){var i=this;n.connections.source.length=0,n.connections.target.length=0,n.connections.internal.length=0;var e=n.children.slice().map(function(v){return v.el}),t=[];if(I(e,function(v){Array.prototype.push.apply(t,i.instance.getSelector(v,X))}),Array.prototype.push.apply(e,t),e.length>0){var c,h,r=this.instance.getConnections({source:e,scope:"*"},!0),a=this.instance.getConnections({target:e,scope:"*"},!0),l={},f=function(p){for(var g=0;g<p.length;g++)l[p[g].id]||(l[p[g].id]=!0,c=i.getGroupFor(p[g].source),h=i.getGroupFor(p[g].target),p[g].source===n.el&&h===n||p[g].target===n.el&&c===n?n.connections.internal.push(p[g]):c===n?(h!==n?n.connections.source.push(p[g]):n.connections.internal.push(p[g]),i._connectionSourceMap[p[g].id]=n):h===n&&(n.connections.target.push(p[g]),i._connectionTargetMap[p[g].id]=n))};f(r),f(a)}}},{key:"_collapseConnection",value:function(n,i,e){var t=n.endpoints[0===i?1:0].element;if(t._jsPlumbParentGroup&&!t._jsPlumbParentGroup.proxied&&t._jsPlumbParentGroup.collapsed)return!1;var a=n.endpoints[0].element._jsPlumbParentGroup,l=null!=a?a.collapseParent||a:null,h=n.endpoints[1].element._jsPlumbParentGroup,f=null!=h?h.collapseParent||h:null;if(null==l||null==f||l.id!==f.id){var v=e.el;return this.instance.getId(v),this.instance.proxyConnection(n,i,v,function(p,g){return e.getEndpoint(p,g)},function(p,g){return e.getAnchor(p,g)}),!0}return!1}},{key:"_expandConnection",value:function(n,i,e){this.instance.unproxyConnection(n,i)}},{key:"isElementDescendant",value:function(n,i){for(var e=this.instance.getContainer();;){if(null==n||n===e)return!1;if(n===i)return!0;n=n.parentNode}}},{key:"collapseGroup",value:function(n){var i=this,e=this.getGroup(n);if(null!=e&&!e.collapsed){var t=e.el;if(null==e.collapseParent){if(this.instance.setGroupVisible(e,!1),e.collapsed=!0,this.instance.removeClass(t,Ft),this.instance.addClass(t,gn),e.proxied){var r=new Set,a=function(c,h){for(var f=0;f<c.length;f++){var v=c[f];!0===i._collapseConnection(v,h,e)&&r.add(v.id)}};a(e.connections.source,0),a(e.connections.target,1),I(e.getGroups(),function(l){i.cascadeCollapse(e,l,r)})}this.instance.revalidate(t),this.repaintGroup(e),this.instance.fire("group:collapse",{group:e})}else e.collapsed=!0,this.instance.removeClass(t,Ft),this.instance.addClass(t,gn)}}},{key:"cascadeCollapse",value:function(n,i,e){var t=this;if(n.proxied){var r=function(l,c){for(var h=0;h<l.length;h++){var f=l[h];e.has(f.id)||!0===t._collapseConnection(f,c,n)&&e.add(f.id)}};r(i.connections.source,0),r(i.connections.target,1)}I(i.getGroups(),function(a){t.cascadeCollapse(n,a,e)})}},{key:"expandGroup",value:function(n,i){var e=this,t=this.getGroup(n);if(null!=t){var r=t.el;if(null==t.collapseParent){if(this.instance.setGroupVisible(t,!0),t.collapsed=!1,this.instance.addClass(r,Ft),this.instance.removeClass(r,gn),t.proxied){var a=function(h,f){for(var v=0;v<h.length;v++)e._expandConnection(h[v],f,t)};a(t.connections.source,0),a(t.connections.target,1),I(t.getGroups(),function c(h,f){if(f||h.collapsed){var v=function(g,_){for(var y=0;y<g.length;y++)e._collapseConnection(g[y],_,h.collapseParent||h)};v(h.connections.source,0),v(h.connections.target,1),I(h.connections.internal,function(p){return p.setVisible(!1)}),I(h.getGroups(),function(p){return c(p,!0)})}else e.expandGroup(h,!0)})}this.instance.revalidate(r),this.repaintGroup(t),i||this.instance.fire("group:expand",{group:t})}else t.collapsed=!1,this.instance.addClass(r,Ft),this.instance.removeClass(r,gn)}}},{key:"toggleGroup",value:function(n){null!=(n=this.getGroup(n))&&(n.collapsed?this.expandGroup(n):this.collapseGroup(n))}},{key:"repaintGroup",value:function(n){for(var e=this.getGroup(n).children,t=0;t<e.length;t++)this.instance.revalidate(e[t].el)}},{key:"addToGroup",value:function(n,i){var e=this,t=this.getGroup(n);if(t){for(var r=t.el,l=arguments.length,c=new Array(l>2?l-2:0),h=2;h<l;h++)c[h-2]=arguments[h];I(c,function(v){var g=null!=v._isJsPlumbGroup,_=v._jsPlumbGroup,y=v._jsPlumbParentGroup;if(y!==t){var m=e.instance.manage(v),E=e.instance.getOffset(v),C=t.collapsed?e.instance.getOffsetRelativeToRoot(r):e.instance.getOffset(e.instance.getGroupContentArea(t));m.group=t.elId,null!=y&&(y.remove(v,!1,i,!1,t),e._updateConnectionsForGroup(y)),g?t.addGroup(_):t.add(v,i);var b=function(x,R){var G=0===R?1:0;x.each(function(B){B.setVisible(!1),B.endpoints[G].element._jsPlumbGroup===t?(B.endpoints[G].setVisible(!1),e._expandConnection(B,G,t)):(B.endpoints[R].setVisible(!1),e._collapseConnection(B,R,t))})};t.collapsed&&(b(e.instance.select({source:v}),0),b(e.instance.select({target:v}),1)),e.instance.getId(v);var A={x:E.x-C.x,y:E.y-C.y};if(e.instance.setPosition(v,A),e._updateConnectionsForGroup(t),e.instance.revalidate(v),!i){var w={group:t,el:v,pos:A};y&&(w.sourceGroup=y),e.instance.fire("group:member:added",w)}}})}}},{key:"removeFromGroup",value:function(n,i){var e=this,t=this.getGroup(n);if(t){for(var a=arguments.length,l=new Array(a>2?a-2:0),c=2;c<a;c++)l[c-2]=arguments[c];I(l,function(f){if(t.collapsed){var v=function(_,y){for(var m=0;m<_.length;m++){var E=_[m];if(E.proxies)for(var C=0;C<E.proxies.length;C++)if(null!=E.proxies[C]){var b=E.proxies[C].originalEp.element;(b===f||e.isElementDescendant(b,f))&&e._expandConnection(E,y,t)}}};v(t.connections.source.slice(),0),v(t.connections.target.slice(),1)}t.remove(f,null,i);var p=e.instance.getManagedElements()[e.instance.getId(f)];p&&delete p.group})}}},{key:"getAncestors",value:function(n){for(var i=[],e=n.group;null!=e;)i.push(e),e=e.group;return i}},{key:"isAncestor",value:function(n,i){return null!=n&&null!=i&&-1!==this.getAncestors(n).indexOf(i)}},{key:"getDescendants",value:function(n){var i=[];return function t(r){var a=r.getGroups();i.push.apply(i,ce(a)),I(a,t)}(n),i}},{key:"isDescendant",value:function(n,i){return null!=n&&null!=i&&-1!==this.getDescendants(i).indexOf(n)}},{key:"reset",value:function(){this._connectionSourceMap={},this._connectionTargetMap={},this.groupMap={}}}]),s}(),ws=function(){function s(o,n){P(this,s),this.instance=o,this.entries=n}return D(s,[{key:"length",get:function(){return this.entries.length}},{key:"each",value:function(n){return I(this.entries,function(i){return n(i)}),this}},{key:"get",value:function(n){return this.entries[n]}},{key:"addClass",value:function(n,i){return this.each(function(e){return e.addClass(n,i)}),this}},{key:"removeClass",value:function(n,i){return this.each(function(e){return e.removeClass(n,i)}),this}},{key:"removeAllOverlays",value:function(){return this.each(function(n){return n.removeAllOverlays()}),this}},{key:"setLabel",value:function(n){return this.each(function(i){return i.setLabel(n)}),this}},{key:"clear",value:function(){return this.entries.length=0,this}},{key:"map",value:function(n){var i=[];return this.each(function(e){return i.push(n(e))}),i}},{key:"addOverlay",value:function(n){return this.each(function(i){return i.addOverlay(n)}),this}},{key:"removeOverlay",value:function(n){return this.each(function(i){return i.removeOverlay(n)}),this}},{key:"removeOverlays",value:function(){return this.each(function(n){return n.removeOverlays()}),this}},{key:"showOverlay",value:function(n){return this.each(function(i){return i.showOverlay(n)}),this}},{key:"hideOverlay",value:function(n){return this.each(function(i){return i.hideOverlay(n)}),this}},{key:"setPaintStyle",value:function(n){return this.each(function(i){return i.setPaintStyle(n)}),this}},{key:"setHoverPaintStyle",value:function(n){return this.each(function(i){return i.setHoverPaintStyle(n)}),this}},{key:"setSuspendEvents",value:function(n){return this.each(function(i){return i.setSuspendEvents(n)}),this}},{key:"setParameter",value:function(n,i){return this.each(function(e){return e.parameters[n]=i}),this}},{key:"setParameters",value:function(n){return this.each(function(i){return i.parameters=n}),this}},{key:"setVisible",value:function(n){return this.each(function(i){return i.setVisible(n)}),this}},{key:"addType",value:function(n){return this.each(function(i){return i.addType(n)}),this}},{key:"toggleType",value:function(n){return this.each(function(i){return i.toggleType(n)}),this}},{key:"removeType",value:function(n){return this.each(function(i){return i.removeType(n)}),this}},{key:"bind",value:function(n,i){return this.each(function(e){return e.bind(n,i)}),this}},{key:"unbind",value:function(n,i){return this.each(function(e){return e.unbind(n,i)}),this}},{key:"setHover",value:function(n){var i=this;return this.each(function(e){return i.instance.setHover(e,n)}),this}}]),s}(),Iu=function(s){L(n,s);var o=k(n);function n(){return P(this,n),o.apply(this,arguments)}return D(n,[{key:"setEnabled",value:function(e){return this.each(function(t){return t.enabled=e}),this}},{key:"setAnchor",value:function(e){return this.each(function(t){return t.setAnchor(e)}),this}},{key:"deleteEveryConnection",value:function(){return this.each(function(e){return e.deleteEveryConnection()}),this}},{key:"deleteAll",value:function(){var e=this;return this.each(function(t){return e.instance.deleteEndpoint(t)}),this.clear(),this}}]),n}(ws),Lu=function(s){L(n,s);var o=k(n);function n(){return P(this,n),o.apply(this,arguments)}return D(n,[{key:"setDetachable",value:function(e){return this.each(function(t){return t.setDetachable(e)}),this}},{key:"setReattach",value:function(e){return this.each(function(t){return t.setReattach(e)}),this}},{key:"setConnector",value:function(e){return this.each(function(t){return t._setConnector(e)}),this}},{key:"deleteAll",value:function(){var e=this;this.each(function(t){return e.instance.deleteConnection(t)}),this.clear()}},{key:"repaint",value:function(){var e=this;return this.each(function(t){return e.instance._paintConnection(t)}),this}}]),n}(ws),Gu=function s(){P(this,s),u(this,"affectedElements",new Set)};function Is(){return{x:0,y:0,w:0,h:0,r:0,c:{x:0,y:0},x2:0,y2:0,t:{x:0,y:0,c:{x:0,y:0},w:0,h:0,r:0,x2:0,y2:0,cr:0,sr:0},dirty:!0}}var Rn=function(o,n){var i=0;return n[1]>o[1]?i=-1:n[1]<o[1]&&(i=1),i},Ls=function(o,n){return-1*Rn(o,n)};function Fn(s,o,n,i){!function mo(s,o,n,i){if(0===o.length)o.push(s);else{for(var e=i?-1:1,t=0,r=o.length,a=Math.floor((t+r)/2);r>t;)n(s,o[a])*e<0?r=a:t=a+1,a=Math.floor((t+r)/2);o.splice(a,0,s)}}([s,o],n,Rn,i)}function Xe(s,o){var n=Te(o,function(i){return i[0]===s});n>-1&&o.splice(n,1)}var At,Ru=function(s){L(n,s);var o=k(n);function n(i){var e;return P(this,n),(e=o.call(this)).instance=i,u(d(e),"_currentTransaction",null),u(d(e),"_sortedElements",{xmin:[],xmax:[],ymin:[],ymax:[]}),u(d(e),"_elementMap",new Map),u(d(e),"_transformedElementMap",new Map),u(d(e),"_bounds",{minx:0,maxx:0,miny:0,maxy:0}),e}return D(n,[{key:"_updateBounds",value:function(e,t,r){null!=t&&(Xe(e,this._sortedElements.xmin),Xe(e,this._sortedElements.xmax),Xe(e,this._sortedElements.ymin),Xe(e,this._sortedElements.ymax),Fn(e,t.t.x,this._sortedElements.xmin,!1),Fn(e,t.t.x+t.t.w,this._sortedElements.xmax,!0),Fn(e,t.t.y,this._sortedElements.ymin,!1),Fn(e,t.t.y+t.t.h,this._sortedElements.ymax,!0),!0!==r&&this._recalculateBounds())}},{key:"_recalculateBounds",value:function(){this._bounds.minx=this._sortedElements.xmin.length>0?this._sortedElements.xmin[0][1]:0,this._bounds.maxx=this._sortedElements.xmax.length>0?this._sortedElements.xmax[0][1]:0,this._bounds.miny=this._sortedElements.ymin.length>0?this._sortedElements.ymin[0][1]:0,this._bounds.maxy=this._sortedElements.ymax.length>0?this._sortedElements.ymax[0][1]:0}},{key:"recomputeBounds",value:function(){var e=this;this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.forEach(function(t,r){e._sortedElements.xmin.push([r,t.t.x]),e._sortedElements.xmax.push([r,t.t.x+t.t.w]),e._sortedElements.ymin.push([r,t.t.y]),e._sortedElements.ymax.push([r,t.t.y+t.t.h])}),this._sortedElements.xmin.sort(Rn),this._sortedElements.ymin.sort(Rn),this._sortedElements.xmax.sort(Ls),this._sortedElements.ymax.sort(Ls),this._recalculateBounds()}},{key:"_finaliseUpdate",value:function(e,t,r){t.t=function Nu(s,o,n,i,e){var t_x=s+n/2,t_y=o+i/2,r=Math.cos(e/360*Math.PI*2),a=Math.sin(e/360*Math.PI*2),l=function(C,b){return{x:t_x+Math.round((C-t_x)*r-(b-t_y)*a),y:t_y+Math.round((b-t_y)*r-(C-t_x)*a)}},c=l(s,o),h=l(s+n,o),f=l(s+n,o+i),v=l(s,o+i),p=l(s+n/2,o+i/2),g=Math.min(c.x,h.x,f.x,v.x),_=Math.max(c.x,h.x,f.x,v.x),y=Math.min(c.y,h.y,f.y,v.y),m=Math.max(c.y,h.y,f.y,v.y);return{x:g,y,w:_-g,h:m-y,c:p,r:e,x2:_,y2:m,cr:r,sr:a}}(t.x,t.y,t.w,t.h,t.r),this._transformedElementMap.set(e,t.t),!0!==r&&this._updateBounds(e,t,r)}},{key:"shouldFireEvent",value:function(e,t,r){return!0}},{key:"startTransaction",value:function(){if(null!=this._currentTransaction)throw new Error("Viewport: cannot start transaction; a transaction is currently active.");this._currentTransaction=new Gu}},{key:"endTransaction",value:function(){var e=this;null!=this._currentTransaction&&(this._currentTransaction.affectedElements.forEach(function(t){var r=e.getPosition(t);e._finaliseUpdate(t,r,!0)}),this.recomputeBounds(),this._currentTransaction=null)}},{key:"updateElements",value:function(e){var t=this;I(e,function(r){return t.updateElement(r.id,r.x,r.y,r.width,r.height,r.rotation)})}},{key:"updateElement",value:function(e,t,r,a,l,c,h){var f=ar(this._elementMap,e,Is);return f.dirty=null==t&&null==f.x||null==r&&null==f.y||null==a&&null==f.w||null==l&&null==f.h,null!=t&&(f.x=t),null!=r&&(f.y=r),null!=a&&(f.w=a),null!=l&&(f.h=l),null!=c&&(f.r=c||0),f.c.x=f.x+f.w/2,f.c.y=f.y+f.h/2,f.x2=f.x+f.w,f.y2=f.y+f.h,null==this._currentTransaction?this._finaliseUpdate(e,f,h):this._currentTransaction.affectedElements.add(e),f}},{key:"refreshElement",value:function(e,t){var r=this.instance.getManagedElements(),a=r[e]?r[e].el:null;if(null!=a){var l=this.getSize(a),c=this.getOffset(a);return this.updateElement(e,c.x,c.y,l.w,l.h,null,t)}return null}},{key:"getSize",value:function(e){return this.instance.getSize(e)}},{key:"getOffset",value:function(e){return this.instance.getOffset(e)}},{key:"registerElement",value:function(e,t){return this.updateElement(e,0,0,0,0,0,t)}},{key:"addElement",value:function(e,t,r,a,l,c){return this.updateElement(e,t,r,a,l,c)}},{key:"rotateElement",value:function(e,t){var r=ar(this._elementMap,e,Is);return r.r=t||0,this._finaliseUpdate(e,r),r}},{key:"getBoundsWidth",value:function(){return this._bounds.maxx-this._bounds.minx}},{key:"getBoundsHeight",value:function(){return this._bounds.maxy-this._bounds.miny}},{key:"getX",value:function(){return this._bounds.minx}},{key:"getY",value:function(){return this._bounds.miny}},{key:"setSize",value:function(e,t,r){if(this._elementMap.has(e))return this.updateElement(e,null,null,t,r,null)}},{key:"setPosition",value:function(e,t,r){if(this._elementMap.has(e))return this.updateElement(e,t,r,null,null,null)}},{key:"reset",value:function(){this._sortedElements.xmin.length=0,this._sortedElements.xmax.length=0,this._sortedElements.ymin.length=0,this._sortedElements.ymax.length=0,this._elementMap.clear(),this._transformedElementMap.clear(),this._recalculateBounds()}},{key:"remove",value:function(e){Xe(e,this._sortedElements.xmin),Xe(e,this._sortedElements.xmax),Xe(e,this._sortedElements.ymin),Xe(e,this._sortedElements.ymax),this._elementMap.delete(e),this._transformedElementMap.delete(e),this._recalculateBounds()}},{key:"getPosition",value:function(e){return this._elementMap.get(e)}},{key:"getElements",value:function(){return this._elementMap}},{key:"isEmpty",value:function(){return 0===this._elementMap.size}}]),n}(zt);function Gs(s,o){return o.theta-s.theta}function Ns(s,o){return(s.theta<0?-Math.PI-s.theta:Math.PI-s.theta)-(o.theta<0?-Math.PI-o.theta:Math.PI-o.theta)}var ju=(u(At={},W,Ns),u(At,ne,Gs),u(At,le,Gs),u(At,se,Ns),At);function We(s){return!0===s.isContinuous}function Rs(s){return!0===s.isContinuous}function Hu(s){return s.locations.length>1}function Fs(s){return[s.currentLocation,s.locations[s.currentLocation]]}var Uu=function(){function s(o){var n=this;P(this,s),this.instance=o,u(this,"anchorLists",new Map),u(this,"anchorLocations",new Map),o.bind(si,function(i){i.sourceEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(i.sourceEndpoint),i.targetEndpoint._anchor.isContinuous&&n._removeEndpointFromAnchorLists(i.targetEndpoint)}),o.bind(Cr,function(i){n._removeEndpointFromAnchorLists(i)})}return D(s,[{key:"getAnchorOrientation",value:function(n){var i=this.anchorLocations.get(n.id);return i?[i.ox,i.oy]:[0,0]}},{key:"_distance",value:function(n,i,e,t,r,a,l){var c=t.x+n.x*r.w,h=t.y+n.y*r.h,f=t.x+r.w/2,v=t.y+r.h/2;if(null!=a&&a.length>0){var p=this.instance._applyRotations([c,h,0,0],a);c=p.x,h=p.y}return Math.sqrt(Math.pow(i-c,2)+Math.pow(e-h,2))+Math.sqrt(Math.pow(f-c,2)+Math.pow(v-h,2))}},{key:"_anchorSelector",value:function(n,i,e,t,r,a,l){for(var c=e.x+t.w/2,h=e.y+t.h/2,f=-1,v=1/0,p=0;p<l.length;p++){var g=this._distance(l[p],c,h,n,i,r,a);g<v&&(f=p+0,v=g)}return[f,l[f]]}},{key:"_floatingAnchorCompute",value:function(n,i){var e=i.xy;return this._setComputedPosition(n,{curX:e.x+n.size.w/2,curY:e.y+n.size.h/2,x:0,y:0,ox:0,oy:0})}},{key:"_setComputedPosition",value:function(n,i,e){return this.anchorLocations.set(n.id,i),n.computedPosition=i,e&&(n.timestamp=e),i}},{key:"_computeSingleLocation",value:function(n,i,e,t){var r,a=t.rotation,l={curX:i.x+n.x*e.w+n.offx,curY:i.y+n.y*e.h+n.offy,x:n.x,y:n.y,ox:0,oy:0};if(null!=a&&a.length>0){var c=[n.iox,n.ioy],h={x:l.curX,y:l.curY,cr:0,sr:0};I(a,function(f){h=Lt(h,f.c,f.r);var v=[Math.round(c[0]*h.cr-c[1]*h.sr),Math.round(c[1]*h.cr+c[0]*h.sr)];c=v.slice()}),n.ox=c[0],n.oy=c[1],r={curX:h.x,curY:h.y,x:n.x,y:n.y,ox:c[0],oy:c[1]}}else n.ox=n.iox,n.oy=n.ioy,r=M({ox:n.iox,oy:n.ioy},l);return r}},{key:"_singleAnchorCompute",value:function(n,i){var e=i.xy,t=i.wh,r=i.timestamp,a=this.anchorLocations.get(n.id);if(null!=a&&r&&r===n.timestamp)return a;var c=ue(Fs(n),2);return a=this._computeSingleLocation(c[1],e,t,i),this._setComputedPosition(n,a,r)}},{key:"_defaultAnchorCompute",value:function(n,i){var e;if(1===n.locations.length)return this._singleAnchorCompute(n,i);var t=i.xy,r=i.wh,a=i.txy,l=i.twh,h=ue(Fs(n),2),f=h[0];if(n.locked||null==a||null==l)e=this._computeSingleLocation(h[1],t,r,i);else{var g=ue(this._anchorSelector(t,r,a,l,i.rotation,i.tRotation,n.locations),2),_=g[0],y=g[1];n.currentLocation=_,_!==f&&(n.cssClass=y.cls||n.cssClass,i.element._anchorLocationChanged(n)),e=this._computeSingleLocation(y,t,r,i)}return this._setComputedPosition(n,e,i.timestamp)}},{key:"_placeAnchors",value:function(n,i){var e=this,t=this.instance.viewport.getPosition(n),r=function(l,c,h,f,v,p){if(h.length>0)for(var g=h.sort(ju[l]),y=function Fu(s,o,n,i,e){for(var t=n?s.w:s.h,r=n?s.h:s.w,a=[],l=t/(o.length+1),c=0;c<o.length;c++){var h=(c+1)*l,f=i*r;e&&(h=t-h);var v=n?h:f,p=s.x+v,g=v/s.w,_=n?f:h,y=s.y+_,m=_/s.h;if(0!==s.r&&null!=s.r){var E=Lt({x:p,y},s.c,s.r);p=E.x,y=E.y}a.push({x:p,y,xLoc:g,yLoc:m,c:o[c].c})}return a}(t,g,f,v,l===ne||l===W),m=0;m<y.length;m++){var E=y[m].c;e._setComputedPosition((E.endpoints[0].elementId===n?E.endpoints[0]:E.endpoints[1])._anchor,{curX:y[m].x,curY:y[m].y,x:y[m].xLoc,y:y[m].yLoc,ox:p[0],oy:p[1]})}};r(le,0,i.bottom,!0,1,[0,1]),r(W,0,i.top,!0,0,[0,-1]),r(se,0,i.left,!1,0,[-1,0]),r(ne,0,i.right,!1,1,[1,0])}},{key:"_updateAnchorList",value:function(n,i,e,t,r,a,l,c,h,f,v){var C,p=t.endpoints[l],g=p.id,_=[1,0][l],y={theta:i,order:e,c:t,b:r,elId:a,epId:g},m=n[h],E=p._continuousAnchorEdge?n[p._continuousAnchorEdge]:null;if(E){var b=Te(E,function(x){return x.epId===g});if(-1!==b){E.splice(b,1);for(var A=0;A<E.length;A++)!0!==(C=E[A].c).placeholder&&f.add(C),v.add(E[A].c.endpoints[l]),v.add(E[A].c.endpoints[_])}}for(var w=0;w<m.length;w++)!0!==(C=m[w].c).placeholder&&f.add(C),v.add(m[w].c.endpoints[l]),v.add(m[w].c.endpoints[_]);m.splice(c?0:m.length,0,y),p._continuousAnchorEdge=h}},{key:"_removeEndpointFromAnchorLists",value:function(n){var i=this.anchorLists.get(n.elementId),e=0;(function(t,r){if(t){var a=function(c){return c.epId===r};J(t.top,a),J(t.left,a),J(t.bottom,a),J(t.right,a),e+=t.top.length,e+=t.left.length,e+=t.bottom.length,e+=t.right.length}})(i,n.id),0===e&&this.anchorLists.delete(n.elementId),this.anchorLocations.delete(n._anchor.id)}},{key:"computeAnchorLocation",value:function(n,i){var e;return e=We(n)?this.anchorLocations.get(n.id)||{curX:0,curY:0,x:0,y:0,ox:0,oy:0}:Rs(n)?this._floatingAnchorCompute(n,i):this._defaultAnchorCompute(n,i),n.timestamp=i.timestamp,e}},{key:"computePath",value:function(n,i){var e=this.instance.viewport.getPosition(n.sourceId),t=this.instance.viewport.getPosition(n.targetId),r=n.endpoints[0],a=n.endpoints[1],l=this.getEndpointLocation(r,{xy:e,wh:e,element:r,timestamp:i,rotation:this.instance._getRotations(n.sourceId)}),c=this.getEndpointLocation(a,{xy:t,wh:t,element:a,timestamp:i,rotation:this.instance._getRotations(n.targetId)});n.connector.resetBounds(),n.connector.compute({sourcePos:l,targetPos:c,sourceEndpoint:n.endpoints[0],targetEndpoint:n.endpoints[1],strokeWidth:n.paintStyleInUse.strokeWidth,sourceInfo:e,targetInfo:t})}},{key:"getEndpointLocation",value:function(n,i){i=i||{};var e=n._anchor,t=this.anchorLocations.get(e.id);return(null==t||null!=i.timestamp&&e.timestamp!==i.timestamp)&&(t=this.computeAnchorLocation(e,i),this._setComputedPosition(e,t,i.timestamp)),t}},{key:"getEndpointOrientation",value:function(n){return n._anchor?this.getAnchorOrientation(n._anchor):[0,0]}},{key:"setAnchorOrientation",value:function(n,i){var e=this.anchorLocations.get(n.id);null!=e&&(e.ox=i[0],e.oy=i[1])}},{key:"isDynamicAnchor",value:function(n){return!!n._anchor&&!We(n._anchor)&&n._anchor.locations.length>1}},{key:"isFloating",value:function(n){return!!n._anchor&&Rs(n._anchor)}},{key:"prepareAnchor",value:function(n){return Kt(n)}},{key:"redraw",value:function(n,i,e){var t=this,r=new Set,a=new Set,l=new Set;if(!this.instance._suspendDrawing){var c=this.instance.endpointsByElement[n]||[];i=i||q();for(var f,v,h={},p=0;p<c.length;p++)if(!1!==(v=c[p]).visible)if(a.add(v),f=v._anchor,0===v.connections.length)We(f)&&(this.anchorLists.has(n)||this.anchorLists.set(n,{top:[],right:[],bottom:[],left:[]}),this._updateAnchorList(this.anchorLists.get(n),-Math.PI/2,0,{endpoints:[v,v],placeholder:!0},!1,n,0,!1,Hl(f),r,a),l.add(n));else for(var g=0;g<v.connections.length;g++){var _=v.connections[g],y=_.sourceId,m=_.targetId,E=We(_.endpoints[0]._anchor),C=We(_.endpoints[1]._anchor);if(E||C){var w=[y,(_.endpoints[0]._anchor.faces||[]).join("-"),m,(_.endpoints[1]._anchor.faces||[]).join("-")].join("-"),S=h[w],x=_.sourceId===n?1:0;E&&!this.anchorLists.has(y)&&this.anchorLists.set(y,{top:[],right:[],bottom:[],left:[]}),C&&!this.anchorLists.has(m)&&this.anchorLists.set(m,{top:[],right:[],bottom:[],left:[]});var R=this.instance.viewport.getPosition(m),G=this.instance.viewport.getPosition(y);if(m===y&&(E||C))this._updateAnchorList(this.anchorLists.get(y),-Math.PI/2,0,_,!1,m,0,!1,W,r,a),this._updateAnchorList(this.anchorLists.get(m),-Math.PI/2,0,_,!1,y,1,!1,W,r,a);else{var B=this.instance._getRotations(y),T=this.instance._getRotations(m);S||(S=this._calculateOrientation(y,m,G,R,_.endpoints[0]._anchor,_.endpoints[1]._anchor,B,T),h[w]=S),E&&this._updateAnchorList(this.anchorLists.get(y),S.theta,0,_,!1,m,0,!1,S.a[0],r,a),C&&this._updateAnchorList(this.anchorLists.get(m),S.theta2,-1,_,!0,y,1,!0,S.a[1],r,a)}E&&l.add(y),C&&l.add(m),r.add(_),(E&&0===x||C&&1===x)&&a.add(_.endpoints[x])}else{var ie=v.connections[g].endpoints[_.sourceId===n?1:0];if(Hu(ie._anchor)){this.instance._paintEndpoint(ie,{elementWithPrecedence:n,timestamp:i}),r.add(v.connections[g]);for(var $e=0;$e<ie.connections.length;$e++)ie.connections[$e]!==v.connections[g]&&r.add(ie.connections[$e])}else r.add(v.connections[g])}}l.forEach(function(he){t._placeAnchors(he,t.anchorLists.get(he))}),a.forEach(function(he){var qi=t.instance.viewport.getPosition(he.elementId);t.instance._paintEndpoint(he,{timestamp:i,offset:qi})}),r.forEach(function(he){t.instance._paintConnection(he,{timestamp:i})})}return{c:r,e:a}}},{key:"reset",value:function(){this.anchorLocations.clear(),this.anchorLists.clear()}},{key:"setAnchor",value:function(n,i){null!=i&&(n._anchor=i)}},{key:"setConnectionAnchors",value:function(n,i){n.endpoints[0]._anchor=i[0],n.endpoints[1]._anchor=i[1]}},{key:"_calculateOrientation",value:function(n,i,e,t,r,a,l,c){var h=this;if(n===i)return{orientation:"identity",a:[W,W]};var v=Math.atan2(t.c.y-e.c.y,t.c.x-e.c.x),p=Math.atan2(e.c.y-t.c.y,e.c.x-t.c.x),g=[],_={};!function(w,S){for(var x=0;x<w.length;x++){var R;if(_[w[x]]=(u(R={},se,{x:S[x][0].x,y:S[x][0].c.y}),u(R,ne,{x:S[x][0].x+S[x][0].w,y:S[x][0].c.y}),u(R,W,{x:S[x][0].c.x,y:S[x][0].y}),u(R,le,{x:S[x][0].c.x,y:S[x][0].y+S[x][0].h}),R),null!=S[x][1]&&S[x][1].length>0)for(var G in _[w[x]])_[w[x]][G]=h.instance._applyRotationsXY(_[w[x]][G],S[x][1])}}([ei,"target"],[[e,l],[t,c]]);for(var y=[W,se,ne,le],m=0;m<y.length;m++)for(var E=0;E<y.length;E++)g.push({source:y[m],target:y[E],dist:Ei(_.source[y[m]],_.target[y[E]])});g.sort(function(w,S){if(w.dist<S.dist)return-1;if(S.dist<w.dist)return 1;var x,R=(u(x={},se,0),u(x,W,1),u(x,ne,2),u(x,le,3),x),G=R[w.source],B=R[S.source],T=R[w.target],ie=R[S.target];return G<B?-1:B<G?1:T<ie?-1:ie<T?1:0});for(var C=g[0].source,b=g[0].target,A=0;A<g.length&&(C=We(r)&&r.locked?r.currentFace:!r.isContinuous||as(r,g[A].source)?g[A].source:null,b=a.isContinuous&&a.locked?a.currentFace:!a.isContinuous||as(a,g[A].target)?g[A].target:null,null==C||null==b);A++);return r.isContinuous&&this.setCurrentFace(r,C),a.isContinuous&&this.setCurrentFace(a,b),{a:[C,b],theta:v,theta2:p}}},{key:"setCurrentFace",value:function(n,i,e){n.currentFace=i,e&&null!=n.lockedFace&&(n.lockedFace=n.currentFace)}},{key:"lock",value:function(n){n.locked=!0,We(n)&&(n.lockedFace=n.currentFace)}},{key:"unlock",value:function(n){n.locked=!1,We(n)&&(n.lockedFace=null)}},{key:"selectAnchorLocation",value:function(n,i){var e=Te(n.locations,function(t){return t.x===i.x&&t.y===i.y});return-1!==e&&(n.currentLocation=e,!0)}},{key:"lockCurrentAxis",value:function(n){null!=n.currentFace&&(n.lockedAxis=n.currentFace===se||n.currentFace===ne?Rl:Fl)}},{key:"unlockCurrentAxis",value:function(n){n.lockedAxis=null}},{key:"anchorsEqual",value:function(n,i){if(!n||!i)return!1;var e=n.locations[n.currentLocation],t=i.locations[i.currentLocation];return e.x===t.x&&e.y===t.y&&e.offx===t.offx&&e.offy===t.offy&&e.ox===t.ox&&e.oy===t.oy}}]),s}(),js={},Qt_register=function(o,n){js[o]=n},st=function(s){L(n,s);var o=k(n);function n(i){var e;return P(this,n),u(d(e=o.call(this,i)),"length",void 0),u(d(e),"m",void 0),u(d(e),"m2",void 0),u(d(e),"type",n.segmentType),e._setCoordinates({x1:i.x1,y1:i.y1,x2:i.x2,y2:i.y2}),e}return D(n,[{key:"getPath",value:function(e){return(e?"M "+this.x1+" "+this.y1+" ":"")+"L "+this.x2+" "+this.y2}},{key:"_recalc",value:function(){this.length=Math.sqrt(Math.pow(this.x2-this.x1,2)+Math.pow(this.y2-this.y1,2)),this.m=yt({x:this.x1,y:this.y1},{x:this.x2,y:this.y2}),this.m2=-1/this.m,this.extents={xmin:Math.min(this.x1,this.x2),ymin:Math.min(this.y1,this.y2),xmax:Math.max(this.x1,this.x2),ymax:Math.max(this.y1,this.y2)}}},{key:"getLength",value:function(){return this.length}},{key:"getGradient",value:function(){return this.m}},{key:"_setCoordinates",value:function(e){this.x1=e.x1,this.y1=e.y1,this.x2=e.x2,this.y2=e.y2,this._recalc()}},{key:"pointOnPath",value:function(e,t){return 0!==e||t?1!==e||t?nt({x:this.x1,y:this.y1},{x:this.x2,y:this.y2},t?e>0?e:this.length+e:e*this.length):{x:this.x2,y:this.y2}:{x:this.x1,y:this.y1}}},{key:"gradientAtPoint",value:function(e,t){return this.m}},{key:"pointAlongPathFrom",value:function(e,t,r){var a=this.pointOnPath(e,r),l=t<=0?{x:this.x1,y:this.y1}:{x:this.x2,y:this.y2};return t<=0&&Math.abs(t)>1&&(t*=-1),nt(a,l,t)}},{key:"within",value:function(e,t,r){return r>=Math.min(e,t)&&r<=Math.max(e,t)}},{key:"closest",value:function(e,t,r){return Math.abs(r-e)<Math.abs(r-t)?e:t}},{key:"findClosestPointOnPath",value:function(e,t){var r={d:1/0,x:null,y:null,l:null,x1:this.x1,x2:this.x2,y1:this.y1,y2:this.y2};if(0===this.m)r.y=this.y1,r.x=this.within(this.x1,this.x2,e)?e:this.closest(this.x1,this.x2,e);else if(this.m===1/0||this.m===-1/0)r.x=this.x1,r.y=this.within(this.y1,this.y2,t)?t:this.closest(this.y1,this.y2,t);else{var a=this.y1-this.m*this.x1,c=(t-this.m2*e-a)/(this.m-this.m2),h=this.m*c+a;r.x=this.within(this.x1,this.x2,c)?c:this.closest(this.x1,this.x2,c),r.y=this.within(this.y1,this.y2,h)?h:this.closest(this.y1,this.y2,h)}var f=Ei({x:r.x,y:r.y},{x:this.x1,y:this.y1});return r.d=Ei({x:e,y:t},r),r.l=f/length,r}},{key:"_pointLiesBetween",value:function(e,t,r){return r>t?t<=e&&e<=r:t>=e&&e>=r}},{key:"lineIntersection",value:function(e,t,r,a){var l=Math.abs(yt({x:e,y:t},{x:r,y:a})),c=Math.abs(this.m),h=c===1/0?this.x1:this.y1-c*this.x1,f=[],v=l===1/0?e:t-l*e;if(l!==c)if(l===1/0&&0===c)this._pointLiesBetween(e,this.x1,this.x2)&&this._pointLiesBetween(this.y1,t,a)&&f.push({x:e,y:this.y1});else if(0===l&&c===1/0)this._pointLiesBetween(t,this.y1,this.y2)&&this._pointLiesBetween(this.x1,e,r)&&f.push({x:this.x1,y:t});else{var p,g;l===1/0?this._pointLiesBetween(p=e,this.x1,this.x2)&&this._pointLiesBetween(g=c*e+h,t,a)&&f.push({x:p,y:g}):0===l?this._pointLiesBetween(g=t,this.y1,this.y2)&&this._pointLiesBetween(p=(t-h)/c,e,r)&&f.push({x:p,y:g}):(g=c*(p=(v-h)/(c-l))+h,this._pointLiesBetween(p,this.x1,this.x2)&&this._pointLiesBetween(g,this.y1,this.y2)&&f.push({x:p,y:g}))}return f}},{key:"boxIntersection",value:function(e,t,r,a){var l=[];return l.push.apply(l,this.lineIntersection(e,t,e+r,t)),l.push.apply(l,this.lineIntersection(e+r,t,e+r,t+a)),l.push.apply(l,this.lineIntersection(e+r,t+a,e,t+a)),l.push.apply(l,this.lineIntersection(e,t+a,e,t)),l}}]),n}(vi);u(st,"segmentType","Straight");var jn=function(s){L(n,s);var o=k(n);function n(){var i;P(this,n);for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return u(d(i=o.call.apply(o,[this].concat(t))),"type",n.type),i}return D(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){this._addSegment(st,{x1:e.sx,y1:e.sy,x2:e.startStubX,y2:e.startStubY}),this._addSegment(st,{x1:e.startStubX,y1:e.startStubY,x2:e.endStubX,y2:e.endStubY}),this._addSegment(st,{x1:e.endStubX,y1:e.endStubY,x2:e.tx,y2:e.ty}),this.geometry={source:t.sourcePos,target:t.targetPos}}},{key:"transformGeometry",value:function(e,t,r){return{source:this.transformAnchorPlacement(e.source,t,r),target:this.transformAnchorPlacement(e.target,t,r)}}}]),n}(Ln);function ot(s,o,n){var i=[],e=function(a){return Y(a)?a:s.getId(a)};if(o)if("string"==typeof o){if("*"===o)return o;i.push(o)}else if(n)i=o;else if(null!=o.length){var t;(t=i).push.apply(t,ce(ce(o).map(e)))}else i.push(e(o));return i}function Hn(s,o,n){null!=o&&(o.connections.push(s),1===o.connections.length&&s.instance.addClass(s.source,s.instance.connectedClass)),null!=n&&(null==o||s.sourceId!==s.targetId)&&(n.connections.push(s),1===n.connections.length&&s.instance.addClass(s.target,s.instance.connectedClass))}function Un(s,o,n){if(null!=o){var i=o.connections.length;J(o.connections,function(t){return s.id===t.id}),i>0&&0===o.connections.length&&s.instance.removeClass(s.source,s.instance.connectedClass)}if(null!=n){var e=n.connections.length;(null==o||s.sourceId!==s.targetId)&&J(n.connections,function(t){return s.id===t.id}),e>0&&0===n.connections.length&&s.instance.removeClass(s.target,s.instance.connectedClass)}}u(jn,"type","Straight");var Xu=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),(t=o.call(this))._instanceIndex=i,u(d(t),"defaults",void 0),u(d(t),"_initialDefaults",{}),u(d(t),"isConnectionBeingDragged",!1),u(d(t),"currentlyDragging",!1),u(d(t),"hoverSuspended",!1),u(d(t),"_suspendDrawing",!1),u(d(t),"_suspendedAt",null),u(d(t),"connectorClass",ni),u(d(t),"connectorOutlineClass","jtk-connector-outline"),u(d(t),"connectedClass","jtk-connected"),u(d(t),"endpointClass",dt),u(d(t),"endpointConnectedClass","jtk-endpoint-connected"),u(d(t),"endpointFullClass","jtk-endpoint-full"),u(d(t),"endpointFloatingClass",ii),u(d(t),"endpointDropAllowedClass","jtk-endpoint-drop-allowed"),u(d(t),"endpointDropForbiddenClass","jtk-endpoint-drop-forbidden"),u(d(t),"endpointAnchorClassPrefix","jtk-endpoint-anchor"),u(d(t),"overlayClass",yn),u(d(t),"connections",[]),u(d(t),"endpointsByElement",{}),u(d(t),"endpointsByUUID",new Map),u(d(t),"sourceSelectors",[]),u(d(t),"targetSelectors",[]),u(d(t),"allowNestedGroups",void 0),u(d(t),"_curIdStamp",1),u(d(t),"viewport",new Ru(d(t))),u(d(t),"router",void 0),u(d(t),"groupManager",void 0),u(d(t),"_connectionTypes",new Map),u(d(t),"_endpointTypes",new Map),u(d(t),"_container",void 0),u(d(t),"_managedElements",{}),u(d(t),"DEFAULT_SCOPE",void 0),u(d(t),"_zoom",1),t.defaults={anchor:we.Bottom,anchors:[null,null],connectionsDetachable:!0,connectionOverlays:[],connector:jn.type,container:null,endpoint:Tt.type,endpointOverlays:[],endpoints:[null,null],endpointStyle:{fill:"#456"},endpointStyles:[null,null],endpointHoverStyle:null,endpointHoverStyles:[null,null],hoverPaintStyle:null,listStyle:{},maxConnections:1,paintStyle:{strokeWidth:2,stroke:"#456"},reattachConnections:!1,scope:"jsplumb_defaultscope",allowNestedGroups:!0},e&&M(t.defaults,e),M(t._initialDefaults,t.defaults),null!=t._initialDefaults[Pt]&&(t._initialDefaults[Pt].strokeWidth=t._initialDefaults[Pt].strokeWidth||2),t.DEFAULT_SCOPE=t.defaults.scope,t.allowNestedGroups=!1!==t._initialDefaults.allowNestedGroups,t.router=new Uu(d(t)),t.groupManager=new wu(d(t)),t.setContainer(t._initialDefaults.container),t}return D(n,[{key:"defaultScope",get:function(){return this.DEFAULT_SCOPE}},{key:"currentZoom",get:function(){return this._zoom}},{key:"areDefaultAnchorsSet",value:function(){return this.validAnchorsSpec(this.defaults.anchors)}},{key:"validAnchorsSpec",value:function(e){return null!=e&&null!=e[0]&&null!=e[1]}},{key:"getContainer",value:function(){return this._container}},{key:"setZoom",value:function(e,t){return this._zoom=e,this.fire("zoom",this._zoom),t&&this.repaintEverything(),!0}},{key:"_idstamp",value:function(){return""+this._curIdStamp++}},{key:"checkCondition",value:function(e,t){var r=this.getListener(e),a=!0;if(r&&r.length>0){var l=Array.prototype.slice.call(arguments,1);try{for(var c=0,h=r.length;c<h;c++)a=a&&r[c].apply(r[c],l)}catch(f){Z("cannot check condition ["+e+"]"+f)}}return a}},{key:"getId",value:function(e,t){if(null==e)return null;var r=this.getAttribute(e,Fe);return(!r||"undefined"===r)&&(2===arguments.length&&void 0!==arguments[1]?r=t:(1===arguments.length||3===arguments.length&&!arguments[2])&&(r="jsplumb-"+this._instanceIndex+"-"+this._idstamp()),this.setAttribute(e,Fe,r)),r}},{key:"getConnections",value:function(e,t){e?e.constructor===String&&(e={scope:e}):e={};for(var a=ot(this,e.scope||this.defaultScope,!0),l=ot(this,e.source),c=ot(this,e.target),h=!t&&a.length>1?{}:[],f=function(E,C){if(!t&&a.length>1){var b=h[E];null==b&&(b=h[E]=[]),b.push(C)}else h.push(C)},v=0,p=this.connections.length;v<p;v++){var g=this.connections[v],_=g.proxies&&g.proxies[0]?g.proxies[0].originalEp.elementId:g.sourceId,y=g.proxies&&g.proxies[1]?g.proxies[1].originalEp.elementId:g.targetId;Ke(a,g.scope)&&Ke(l,_)&&Ke(c,y)&&f(g.scope,g)}return h}},{key:"select",value:function(e){return(e=e||{}).scope=e.scope||"*",new Lu(this,e.connections||this.getConnections(e,!0))}},{key:"selectEndpoints",value:function(e){(e=e||{}).scope=e.scope||"*";var t=!e.element&&!e.source&&!e.target,r=t?"*":ot(this,e.element),a=t?"*":ot(this,e.source),l=t?"*":ot(this,e.target),c=ot(this,e.scope,!0),h=[];for(var f in this.endpointsByElement){var v=Ke(r,f,!0),p=Ke(a,f,!0),g="*"!==a,_=Ke(l,f,!0),y="*"!==l;if(v||p||_)e:for(var m=0,E=this.endpointsByElement[f].length;m<E;m++){var C=this.endpointsByElement[f][m];if(Ke(c,C.scope,!0)){if(g&&a.length>0&&!C.isSource||y&&l.length>0&&!C.isTarget)continue e;h.push(C)}}}return new Iu(this,h)}},{key:"setContainer",value:function(e){this._container=e,this.fire("container:change",this._container)}},{key:"_set",value:function(e,t,r){var l,f,c=[{el:"source",elId:"sourceId"},{el:"target",elId:"targetId"}][r],h=e[c.elId],v=e.endpoints[r],p={index:r,originalEndpoint:v,originalSourceId:0===r?h:e.sourceId,newSourceId:e.sourceId,originalTargetId:1===r?h:e.targetId,newTargetId:e.targetId,connection:e,newEndpoint:v};return t instanceof kt?(l=t).addConnection(e):l=(f=this.getId(t))===e[c.elId]?null:e.makeEndpoint(0===r,t,f),null!=l&&(p.newEndpoint=l,v.detachFromConnection(e),e.endpoints[r]=l,e[c.el]=l.element,e[c.elId]=l.elementId,p[0===r?"newSourceId":"newTargetId"]=l.elementId,this.fireMoveEvent(p),this._paintConnection(e)),p}},{key:"setSource",value:function(e,t){Un(e,this._managedElements[e.sourceId]);var r=this._set(e,t,0);Hn(e,this._managedElements[r.newSourceId])}},{key:"setTarget",value:function(e,t){Un(e,this._managedElements[e.targetId]);var r=this._set(e,t,1);Hn(e,this._managedElements[r.newTargetId])}},{key:"setConnectionType",value:function(e,t,r){e.setType(t,r),this._paintConnection(e)}},{key:"isHoverSuspended",value:function(){return this.hoverSuspended}},{key:"setSuspendDrawing",value:function(e,t){var r=this._suspendDrawing;return this._suspendDrawing=e,e?this._suspendedAt=""+(new Date).getTime():(this._suspendedAt=null,this.viewport.recomputeBounds()),t&&this.repaintEverything(),r}},{key:"getSuspendedAt",value:function(){return this._suspendedAt}},{key:"batch",value:function(e,t){var r=!0===this._suspendDrawing;r||this.setSuspendDrawing(!0),e(),r||this.setSuspendDrawing(!1,!t)}},{key:"each",value:function(e,t){if(null!=e){if(null!=e.length)for(var r=0;r<e.length;r++)t(e[r]);else t(e);return this}}},{key:"updateOffset",value:function(e){var t=e.elId;return e.recalc?this.viewport.refreshElement(t):this.viewport.getPosition(t)}},{key:"deleteConnection",value:function(e,t){if(null!=e&&!0!==e.deleted&&((t=t||{}).force||nr(!0,!1,[[e.endpoints[0],vt,[e]],[e.endpoints[1],vt,[e]],[e,vt,[e]],[this,yr,[Pr,e]]]))){Un(e,this._managedElements[e.sourceId],this._managedElements[e.targetId]),this.fireDetachEvent(e,!e.pending&&!1!==t.fireEvent,t.originalEvent);var r=e.endpoints[0],a=e.endpoints[1];return r!==t.endpointToIgnore&&r.detachFromConnection(e,null,!0),a!==t.endpointToIgnore&&a.detachFromConnection(e,null,!0),J(this.connections,function(l){return e.id===l.id}),e.destroy(),r!==t.endpointToIgnore&&r.deleteOnEmpty&&0===r.connections.length&&this.deleteEndpoint(r),a!==t.endpointToIgnore&&a.deleteOnEmpty&&0===a.connections.length&&this.deleteEndpoint(a),!0}return!1}},{key:"deleteEveryConnection",value:function(e){var t=this;e=e||{};var r=this.connections.length,a=0;return this.batch(function(){for(var l=0;l<r;l++)a+=t.deleteConnection(t.connections[0],e)?1:0}),a}},{key:"deleteConnectionsForElement",value:function(e,t){var r=this.getId(e),a=this._managedElements[r];if(a)for(var l=a.connections.length,c=0;c<l;c++)this.deleteConnection(a.connections[0],t);return this}},{key:"fireDetachEvent",value:function(e,t,r){var l=null!=e.id?{connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]}:e;t&&this.fire(mr,l,r),this.fire(si,l,r)}},{key:"fireMoveEvent",value:function(e,t){this.fire(Er,e,t)}},{key:"manageAll",value:function(e,t){for(var r=Y(e)?this.getSelector(this.getContainer(),e):e,a=0;a<r.length;a++)this.manage(r[a],null,t)}},{key:"manage",value:function(e,t,r){null==this.getAttribute(e,Fe)&&(t=t||this.getAttribute(e,"id")||q(),this.setAttribute(e,Fe,t));var a=this.getId(e);if(this._managedElements[a])r&&(this._managedElements[a].viewportElement=this.updateOffset({elId:a,timestamp:null,recalc:!0}));else{var l={el:e,endpoints:[],connections:[],rotation:0,data:{}};this._managedElements[a]=l,l.viewportElement=this._suspendDrawing?this.viewport.registerElement(a,!0):this.updateOffset({elId:a,recalc:!0}),this.fire(xr,{el:e})}return this._managedElements[a]}},{key:"getManagedData",value:function(e,t,r){if(this._managedElements[e]){var a=this._managedElements[e].data[t];return null!=a?a[r]:null}}},{key:"setManagedData",value:function(e,t,r,a){this._managedElements[e]&&(this._managedElements[e].data[t]=this._managedElements[e].data[t]||{},this._managedElements[e].data[t][r]=a)}},{key:"getManagedElement",value:function(e){return this._managedElements[e]?this._managedElements[e].el:null}},{key:"unmanage",value:function(e,t){var r=this;this.removeAllEndpoints(e,!0);var a=function(c){var h=r.getId(c);r.removeAttribute(c,Fe),delete r._managedElements[h],r.viewport.remove(h),r.fire(kr,{el:c,id:h}),c&&t&&r._removeElement(c)};this._getAssociatedElements(e).map(a),a(e)}},{key:"rotate",value:function(e,t,r){var a=this.getId(e);return this._managedElements[a]&&(this._managedElements[a].rotation=t,this.viewport.rotateElement(a,t),!0!==r)?this.revalidate(e):{c:new Set,e:new Set}}},{key:"_getRotation",value:function(e){var t=this._managedElements[e];return null!=t&&t.rotation||0}},{key:"_getRotations",value:function(e){var t=this,r=[],a=this._managedElements[e];return null!=a&&(r.push({r:a.viewportElement.r||0,c:a.viewportElement.c}),function c(h){if(null!=h.group){var f=t._managedElements[h.group];null!=f&&(r.push({r:f.viewportElement.r,c:f.viewportElement.c}),c(f))}}(a)),r}},{key:"_applyRotations",value:function(e,t){var r=e.slice(),a={x:r[0],y:r[1],cr:0,sr:0};return I(t,function(l){a=Lt(a,l.c,l.r)}),a}},{key:"_applyRotationsXY",value:function(e,t){return I(t,function(r){e=Lt(e,r.c,r.r)}),e}},{key:"_internal_newEndpoint",value:function(e){var t=M({},e),r=this.manage(t.element);t.elementId=this.getId(t.element),t.id="ep_"+this._idstamp();var a=new kt(this,t);return function Bu(s,o){s?.endpoints.push(o)}(r,a),e.uuid&&this.endpointsByUUID.set(e.uuid,a),sr(this.endpointsByElement,a.elementId,a),this._suspendDrawing||this._paintEndpoint(a,{timestamp:this._suspendedAt}),a}},{key:"_deriveEndpointAndAnchorSpec",value:function(e,t){for(var r=((t?"":"default ")+e).split(/[\s]/),a=null,l=null,c=null,h=null,f=0;f<r.length;f++){var v=this.getConnectionType(r[f]);v&&(v.endpoints&&(a=v.endpoints),v.endpoint&&(l=v.endpoint),v.anchors&&(h=v.anchors),v.anchor&&(c=v.anchor))}return{endpoints:a||[l,l],anchors:h||[c,c]}}},{key:"revalidate",value:function(e,t){var r=this.getId(e);return this.updateOffset({elId:r,recalc:!0,timestamp:t}),this.repaint(e)}},{key:"repaintEverything",value:function(){var t,e=q();for(t in this._managedElements)this.viewport.refreshElement(t,!0);for(t in this.viewport.recomputeBounds(),this._managedElements)this.repaint(this._managedElements[t].el,e,!0);return this}},{key:"setElementPosition",value:function(e,t,r){var a=this.getId(e);return this.viewport.setPosition(a,t,r),this.repaint(e)}},{key:"repaint",value:function(e,t,r){var a={c:new Set,e:new Set},l=function(g){g.c.forEach(function(_){return a.c.add(_)}),g.e.forEach(function(_){return a.e.add(_)})};if(!this._suspendDrawing){var c=this.getId(e);if(null!=e){var h=this._getAssociatedElements(e);if(null==t&&(t=q()),!r)for(var f=0;f<h.length;f++)this.updateOffset({elId:this.getId(h[f]),recalc:!0,timestamp:t});if(l(this.router.redraw(c,t,null)),h.length>0)for(var v=0;v<h.length;v++)l(this.router.redraw(this.getId(h[v]),t,null))}}return a}},{key:"unregisterEndpoint",value:function(e){var t=e.getUuid();t&&this.endpointsByUUID.delete(t),function Yu(s,o){null!=s&&J(s.endpoints,function(n){return n===o})}(this._managedElements[e.elementId],e);var r=this.endpointsByElement[e.elementId];null!=r&&(this.endpointsByElement[e.elementId]=r.filter(function(a){return a!==e})),this.fire(Cr,e)}},{key:"_maybePruneEndpoint",value:function(e){return!(!e.deleteOnEmpty||0!==e.connections.length||(this.deleteEndpoint(e),0))}},{key:"deleteEndpoint",value:function(e){var t=this,r="string"==typeof e?this.endpointsByUUID.get(e):e;if(r){var a=r.proxiedBy,l=r.connections.slice();I(l,function(c){r.detachFromConnection(c,null,!0)}),this.unregisterEndpoint(r),r.destroy(),I(l,function(c){t.deleteConnection(c,{force:!0,endpointToIgnore:r})}),null!=a&&this.deleteEndpoint(a)}return this}},{key:"addEndpoint",value:function(e,t,r){var a=M({},r=r||{});M(a,t||{});var l=M({element:e},a);return this._internal_newEndpoint(l)}},{key:"addEndpoints",value:function(e,t,r){for(var a=[],l=0,c=t.length;l<c;l++)a.push(this.addEndpoint(e,t[l],r));return a}},{key:"reset",value:function(){var e=this;this.silently(function(){e.endpointsByElement={},e._managedElements={},e.endpointsByUUID.clear(),e.viewport.reset(),e.router.reset(),e.groupManager.reset(),e.connections.length=0})}},{key:"destroy",value:function(){this.reset(),this.unbind(),this.sourceSelectors.length=0,this.targetSelectors.length=0,this._connectionTypes.clear(),this._endpointTypes.clear()}},{key:"getEndpoints",value:function(e){return this.endpointsByElement[this.getId(e)]||[]}},{key:"getEndpoint",value:function(e){return this.endpointsByUUID.get(e)}},{key:"setEndpointUuid",value:function(e,t){e.uuid&&this.endpointsByUUID.delete(e.uuid),e.uuid=t,this.endpointsByUUID.set(t,e)}},{key:"connect",value:function(e,t){try{var r=this._prepareConnectionParams(e,t),a=this._newConnection(r);return this._finaliseConnection(a,r),a}catch(l){return void Z(l)}}},{key:"_prepareConnectionParams",value:function(e,t){var r=M({},e);t&&M(r,t);var a=r;if(a.source&&a.source.endpoint&&(a.sourceEndpoint=a.source),a.target&&a.target.endpoint&&(a.targetEndpoint=a.target),e.uuids&&(a.sourceEndpoint=this.getEndpoint(e.uuids[0]),a.targetEndpoint=this.getEndpoint(e.uuids[1])),null!=a.sourceEndpoint){if(a.sourceEndpoint.isFull())throw"Cannot establish connection: source endpoint is full";if(a.type||(a.type=a.sourceEndpoint.edgeType),a.sourceEndpoint.connectorOverlays){a.overlays=a.overlays||[];for(var l=0,c=a.sourceEndpoint.connectorOverlays.length;l<c;l++)a.overlays.push(a.sourceEndpoint.connectorOverlays[l])}a.sourceEndpoint.scope&&(a.scope=a.sourceEndpoint.scope)}else if(null==a.source)throw"Cannot establish connection: source does not exist";if(null!=a.targetEndpoint){if(a.targetEndpoint.isFull())throw"Cannot establish connection: target endpoint is full"}else if(null==a.target)throw"Cannot establish connection: target does not exist";if(a.sourceEndpoint&&a.targetEndpoint&&!function Vu(s,o){for(var n=s.scope.split(/\s/),i=o.scope.split(/\s/),e=0;e<n.length;e++)for(var t=0;t<i.length;t++)if(i[t]===n[e])return!0;return!1}(a.sourceEndpoint,a.targetEndpoint))throw"Cannot establish connection: scopes do not match";return a}},{key:"_newConnection",value:function(e){e.id="con_"+this._idstamp();var t=new Zt(this,e);return Hn(t,this._managedElements[t.sourceId],this._managedElements[t.targetId]),this._paintConnection(t),t}},{key:"_finaliseConnection",value:function(e,t,r){t=t||{},e.suspendedEndpoint||this.connections.push(e),e.pending=null,e.endpoints[0].isTemporarySource=!1,this.repaint(e.source);var a={connection:e,source:e.source,target:e.target,sourceId:e.sourceId,targetId:e.targetId,sourceEndpoint:e.endpoints[0],targetEndpoint:e.endpoints[1]};this.fire(_r,a,r),!t.doNotFireConnectionEvent&&!1!==t.fireEvent&&this.fire(ri,a,r)}},{key:"removeAllEndpoints",value:function(e,t){var r=this,a=function(c){var v,p,h=r.getId(c),f=r.endpointsByElement[h];if(f)for(v=0,p=f.length;v<p;v++)r.deleteEndpoint(f[v]);delete r.endpointsByElement[h]};return t&&this._getAssociatedElements(e).map(a),a(e),this}},{key:"_createSourceDefinition",value:function(e,t){var r=M({},t);M(r,e),r.edgeType=r.edgeType||xn;var a=this._deriveEndpointAndAnchorSpec(r.edgeType);r.endpoint=r.endpoint||a.endpoints[0],r.anchor=r.anchor||a.anchors[0];var l=r.maxConnections||-1;return{def:M({},r),uniqueEndpoint:r.uniqueEndpoint,maxConnections:l,enabled:!0,endpoint:null}}},{key:"addSourceSelector",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this._createSourceDefinition(t),l=new ys(e,a,r);return this.sourceSelectors.push(l),l}},{key:"removeSourceSelector",value:function(e){J(this.sourceSelectors,function(t){return t===e})}},{key:"removeTargetSelector",value:function(e){J(this.targetSelectors,function(t){return t===e})}},{key:"addTargetSelector",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=this._createTargetDefinition(t),l=new ys(e,a,r);return this.targetSelectors.push(l),l}},{key:"_createTargetDefinition",value:function(e,t){var r=M({},t);M(r,e),r.edgeType=r.edgeType||xn;var a=r.maxConnections||-1;return{def:M({},r),uniqueEndpoint:r.uniqueEndpoint,maxConnections:a,enabled:!0,endpoint:null}}},{key:"show",value:function(e,t){return this._setVisible(e,ti,t)}},{key:"hide",value:function(e,t){return this._setVisible(e,ft,t)}},{key:"_setVisible",value:function(e,t,r){var a=t===ti,l=null;r&&(l=function(f){f.setVisible(a,!0,!0)});var c=this.getId(e);return this._operation(e,function(h){a&&r?h.endpoints[h.sourceId===c?1:0].isVisible()&&h.setVisible(!0):h.setVisible(a)},l),this}},{key:"toggleVisible",value:function(e,t){var r=null;t&&(r=function(l){var c=l.isVisible();l.setVisible(!c)}),this._operation(e,function(a){var l=a.isVisible();a.setVisible(!l)},r)}},{key:"_operation",value:function(e,t,r){var a=this.getId(e),l=this.endpointsByElement[a];if(l&&l.length)for(var c=0,h=l.length;c<h;c++){for(var f=0,v=l[c].connections.length;f<v;f++)if(t(l[c].connections[f]))return;r&&r(l[c])}}},{key:"registerConnectionType",value:function(e,t){if(this._connectionTypes.set(e,M({},t)),t.overlays){for(var r={},a=0;a<t.overlays.length;a++){var l=Mi(t.overlays[a]);r[l.options.id]=l}this._connectionTypes.get(e).overlays=r}}},{key:"registerConnectionTypes",value:function(e){for(var t in e)this.registerConnectionType(t,e[t])}},{key:"registerEndpointType",value:function(e,t){if(this._endpointTypes.set(e,M({},t)),t.overlays){for(var r={},a=0;a<t.overlays.length;a++){var l=Mi(t.overlays[a]);r[l.options.id]=l}this._endpointTypes.get(e).overlays=r}}},{key:"registerEndpointTypes",value:function(e){for(var t in e)this.registerEndpointType(t,e[t])}},{key:"getType",value:function(e,t){return"connection"===t?this.getConnectionType(e):this.getEndpointType(e)}},{key:"getConnectionType",value:function(e){return this._connectionTypes.get(e)}},{key:"getEndpointType",value:function(e){return this._endpointTypes.get(e)}},{key:"importDefaults",value:function(e){for(var t in e)this.defaults[t]=e[t];return null!=this.defaults[Pt]&&(this.defaults[Pt].strokeWidth=this.defaults[Pt].strokeWidth||2),e.container&&this.setContainer(e.container),this}},{key:"restoreDefaults",value:function(){return this.defaults=M({},this._initialDefaults),this}},{key:"getManagedElements",value:function(){return this._managedElements}},{key:"proxyConnection",value:function(e,t,r,a,l){var h,c=null!=e.proxies[t],f=c?e.proxies[t].originalEp.elementId:e.endpoints[t].elementId,v=c?e.proxies[t].originalEp:e.endpoints[t],p=this.getId(r);e.proxies[t]?e.proxies[t].ep.elementId===p?h=e.proxies[t].ep:(e.proxies[t].ep.detachFromConnection(e,t),h=this._internal_newEndpoint({element:r,endpoint:a(e,t),anchor:l(e,t),parameters:{isProxyEndpoint:!0}})):h=this._internal_newEndpoint({element:r,endpoint:a(e,t),anchor:l(e,t),parameters:{isProxyEndpoint:!0}}),h.deleteOnEmpty=!0,e.proxies[t]={ep:h,originalEp:v},this.sourceOrTargetChanged(f,p,e,r,t),v.detachFromConnection(e,null,!0),h.connections=[e],e.endpoints[t]=h,v.proxiedBy=h,v.setVisible(!1),e.setVisible(!0),this.revalidate(r)}},{key:"unproxyConnection",value:function(e,t){if(null!=e.proxies&&null!=e.proxies[t]){var r=e.proxies[t].originalEp.element,a=e.proxies[t].originalEp.elementId,l=e.proxies[t].ep.elementId;e.endpoints[t]=e.proxies[t].originalEp,delete e.proxies[t].originalEp.proxiedBy,this.sourceOrTargetChanged(l,a,e,r,t),e.proxies[t].ep.detachFromConnection(e,null),e.proxies[t].originalEp.addConnection(e),e.isVisible()&&e.proxies[t].originalEp.setVisible(!0),e.proxies[t]=null,-1===Te(e.proxies,function(c){return null!=c})&&(e.proxies.length=0)}}},{key:"sourceOrTargetChanged",value:function(e,t,r,a,l){e!==t&&(0===l?(r.sourceId=t,r.source=a):1===l&&(r.targetId=t,r.target=a),Un(r,this._managedElements[e]),Hn(r,this._managedElements[t]))}},{key:"getGroup",value:function(e){return this.groupManager.getGroup(e)}},{key:"getGroupFor",value:function(e){return this.groupManager.getGroupFor(e)}},{key:"addGroup",value:function(e){return this.groupManager.addGroup(e)}},{key:"addToGroup",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];return(t=this.groupManager).addToGroup.apply(t,[e,!1].concat(a))}},{key:"collapseGroup",value:function(e){this.groupManager.collapseGroup(e)}},{key:"expandGroup",value:function(e){this.groupManager.expandGroup(e)}},{key:"toggleGroup",value:function(e){this.groupManager.toggleGroup(e)}},{key:"removeGroup",value:function(e,t,r,a){return this.groupManager.removeGroup(e,t,r,a)}},{key:"removeAllGroups",value:function(e,t){this.groupManager.removeAllGroups(e,t,!1)}},{key:"removeFromGroup",value:function(e,t,r){this.groupManager.removeFromGroup(e,r,t),this._appendElement(t,this.getContainer()),this.updateOffset({recalc:!0,elId:this.getId(t)})}},{key:"_paintEndpoint",value:function(e,t){var a=(t=t||{}).timestamp,l=!1!==t.recalc;if(!a||e.timestamp!==a){var c=this.viewport.getPosition(e.elementId),h=t.offset?{x:t.offset.x,y:t.offset.y}:{x:c.x,y:c.y};if(null!=h){var f=t.anchorLoc;if(null==f){var v={xy:h,wh:c,element:e,timestamp:a};if(l&&this.router.isDynamicAnchor(e)&&e.connections.length>0){var p=function r(C){var b=0;if(null!=t.elementWithPrecedence)for(var A=0;A<C.connections.length;A++)if(C.connections[A].sourceId===t.elementWithPrecedence||C.connections[A].targetId===t.elementWithPrecedence){b=A;break}return C.connections[b]}(e),g=p.endpoints[0]===e?1:0,_=0===g?p.sourceId:p.targetId,y=this.viewport.getPosition(_);v.index=0===g?1:0,v.connection=p,v.txy=y,v.twh=y,v.tElement=p.endpoints[g],v.tRotation=this._getRotations(_)}else e.connections.length>0&&(v.connection=e.connections[0]);v.rotation=this._getRotations(e.elementId),f=this.router.computeAnchorLocation(e._anchor,v)}for(var m in e.endpoint.compute(f,this.router.getEndpointOrientation(e),e.paintStyleInUse),this.renderEndpoint(e,e.paintStyleInUse),e.timestamp=a,e.overlays)if(e.overlays.hasOwnProperty(m)){var E=e.overlays[m];E.isVisible()&&(e.overlayPlacements[m]=this.drawOverlay(E,e.endpoint,e.paintStyleInUse,e.getAbsoluteOverlayPosition(E)),this._paintOverlay(E,e.overlayPlacements[m],{xmin:0,ymin:0}))}}}}},{key:"_paintConnection",value:function(e,t){if(!this._suspendDrawing&&!1!==e.visible){var r=(t=t||{}).timestamp;if(null!=r&&r===e.lastPaintedAt)return;if(null==r||r!==e.lastPaintedAt){this.router.computePath(e,r);var a={xmin:1/0,ymin:1/0,xmax:-1/0,ymax:-1/0};for(var l in e.overlays)if(e.overlays.hasOwnProperty(l)){var c=e.overlays[l];c.isVisible()&&(e.overlayPlacements[l]=this.drawOverlay(c,e.connector,e.paintStyleInUse,e.getAbsoluteOverlayPosition(c)),a.xmin=Math.min(a.xmin,e.overlayPlacements[l].xmin),a.xmax=Math.max(a.xmax,e.overlayPlacements[l].xmax),a.ymin=Math.min(a.ymin,e.overlayPlacements[l].ymin),a.ymax=Math.max(a.ymax,e.overlayPlacements[l].ymax))}var h=parseFloat(""+e.paintStyleInUse.strokeWidth||"1")/2,f=parseFloat(""+e.paintStyleInUse.strokeWidth||"0"),v={xmin:Math.min(e.connector.bounds.xmin-(h+f),a.xmin),ymin:Math.min(e.connector.bounds.ymin-(h+f),a.ymin),xmax:Math.max(e.connector.bounds.xmax+(h+f),a.xmax),ymax:Math.max(e.connector.bounds.ymax+(h+f),a.ymax)};for(var p in this.paintConnector(e.connector,e.paintStyleInUse,v),e.overlays)if(e.overlays.hasOwnProperty(p)){var g=e.overlays[p];g.isVisible()&&this._paintOverlay(g,e.overlayPlacements[p],v)}}e.lastPaintedAt=r}}},{key:"_refreshEndpoint",value:function(e){e._anchor.isFloating||(e.connections.length>0?this.addEndpointClass(e,this.endpointConnectedClass):this.removeEndpointClass(e,this.endpointConnectedClass),e.isFull()?this.addEndpointClass(e,this.endpointFullClass):this.removeEndpointClass(e,this.endpointFullClass))}},{key:"_makeConnector",value:function(e,t,r){return function(o,n,i){var e=js[n];if(e)return new e(o,i);throw{message:"jsPlumb: unknown connector type '"+n+"'"}}(e,t,r)}},{key:"addOverlay",value:function(e,t,r){e.addOverlay(t),r||this.revalidate(e instanceof kt?e.element:e.source)}},{key:"removeOverlay",value:function(e,t){e.removeOverlay(t),this.revalidate(e instanceof kt?e.element:e.source)}},{key:"setOutlineColor",value:function(e,t){e.paintStyleInUse.outlineStroke=t,this._paintConnection(e)}},{key:"setOutlineWidth",value:function(e,t){e.paintStyleInUse.outlineWidth=t,this._paintConnection(e)}},{key:"setColor",value:function(e,t){e.paintStyleInUse.stroke=t,this._paintConnection(e)}},{key:"setLineWidth",value:function(e,t){e.paintStyleInUse.strokeWidth=t,this._paintConnection(e)}},{key:"setLineStyle",value:function(e,t){null!=t.lineWidth&&(e.paintStyleInUse.strokeWidth=t.lineWidth),null!=t.outlineWidth&&(e.paintStyleInUse.outlineWidth=t.outlineWidth),null!=t.color&&(e.paintStyleInUse.stroke=t.color),null!=t.outlineColor&&(e.paintStyleInUse.outlineStroke=t.outlineColor),this._paintConnection(e)}},{key:"getPathData",value:function(e){for(var t="",r=0;r<e.segments.length;r++)t+=e.segments[r].getPath(0===r),t+=" ";return t}}]),n}(zt),Hs={};function ji(s,o){Hs[s]=o}function Us(s,o,n){var i=o,e=U(o.getBoundingClientRect)!==jr?o.getBoundingClientRect():{left:0,top:0,width:0,height:0},t=document.body,r=document.documentElement,a=window.pageYOffset||r.scrollTop||t.scrollTop,l=window.pageXOffset||r.scrollLeft||t.scrollLeft,p=e.top+a-(r.clientTop||t.clientTop||0)+0*n,g=e.left+l-(r.clientLeft||t.clientLeft||0)+0*n,_=kn(s);return{x:(_.x-g)/(e.width||i.offsetWidth*n),y:(_.y-p)/(e.height||i.offsetHeight*n)}}function Ot(s){return Li(s)||Gi(s)||Ri(s)}function Vs(s,o){s.canvas&&(s.canvas.style.display=o?"block":"none")}function Bs(s){s.canvas&&s.canvas.parentNode.removeChild(s.canvas),delete s.canvas}function en(s){return s.canvas}function me(s){return Di.getElement(s)}function at(s){return Di.getElement(s,s.component,function(o){var n=s.create(o);return s.instance.addClass(n,s.instance.overlayClass),n})}function Wu(s,o,n,i){var e=s.x,t=s.y;return o._jsPlumbParentGroup&&o._jsPlumbParentGroup.constrain&&(e=Math.max(s.x,0),t=Math.max(s.y,0),e=Math.min(e,n.w-i.w),t=Math.min(t,n.h-i.h)),{x:e,y:t}}var $u=function(s){L(n,s);var o=k(n);function n(i,e){var t;if(P(this,n),(t=o.call(this,i,e))._instanceIndex=i,u(d(t),"containerType",null),u(d(t),"dragSelection",void 0),u(d(t),"dragManager",void 0),u(d(t),"_connectorClick",void 0),u(d(t),"_connectorDblClick",void 0),u(d(t),"_connectorTap",void 0),u(d(t),"_connectorDblTap",void 0),u(d(t),"_endpointClick",void 0),u(d(t),"_endpointDblClick",void 0),u(d(t),"_overlayClick",void 0),u(d(t),"_overlayDblClick",void 0),u(d(t),"_overlayTap",void 0),u(d(t),"_overlayDblTap",void 0),u(d(t),"_connectorMouseover",void 0),u(d(t),"_connectorMouseout",void 0),u(d(t),"_endpointMouseover",void 0),u(d(t),"_endpointMouseout",void 0),u(d(t),"_connectorContextmenu",void 0),u(d(t),"_connectorMousedown",void 0),u(d(t),"_connectorMouseup",void 0),u(d(t),"_endpointMousedown",void 0),u(d(t),"_endpointMouseup",void 0),u(d(t),"_overlayMouseover",void 0),u(d(t),"_overlayMouseout",void 0),u(d(t),"_elementClick",void 0),u(d(t),"_elementTap",void 0),u(d(t),"_elementDblTap",void 0),u(d(t),"_elementMouseenter",void 0),u(d(t),"_elementMouseexit",void 0),u(d(t),"_elementMousemove",void 0),u(d(t),"_elementMouseup",void 0),u(d(t),"_elementMousedown",void 0),u(d(t),"_elementContextmenu",void 0),u(d(t),"_resizeObserver",void 0),u(d(t),"eventManager",void 0),u(d(t),"draggingClass","jtk-dragging"),u(d(t),"elementDraggingClass","jtk-element-dragging"),u(d(t),"hoverClass","jtk-hover"),u(d(t),"sourceElementDraggingClass","jtk-source-element-dragging"),u(d(t),"targetElementDraggingClass","jtk-target-element-dragging"),u(d(t),"hoverSourceClass","jtk-source-hover"),u(d(t),"hoverTargetClass","jtk-target-hover"),u(d(t),"dragSelectClass","jtk-drag-select"),u(d(t),"managedElementsSelector",void 0),u(d(t),"elementsDraggable",void 0),u(d(t),"elementDragHandler",void 0),u(d(t),"groupDragOptions",void 0),u(d(t),"elementDragOptions",void 0),u(d(t),"svg",{node:function(a,l){return Ce(a,l)},attr:function(a,l){return Ee(a,l)},pos:function(a){return Or(a)}}),e=e||{},t.containerType=Qn(t.getContainer()),t.elementsDraggable=e&&!1!==e.elementsDraggable,t.managedElementsSelector=e&&e.managedElementsSelector||X,t.eventManager=new mi,t.dragSelection=new Tl(d(t)),t.dragManager=new Il(d(t),t.dragSelection),t.dragManager.addHandler(new Es(d(t))),t.groupDragOptions={constrainFunction:Wu},t.dragManager.addHandler(new Cs(d(t),t.dragSelection),t.groupDragOptions),t.elementDragHandler=new Ai(d(t),t.dragSelection),t.elementDragOptions=e&&e.dragOptions||{},t.dragManager.addHandler(t.elementDragHandler,t.elementDragOptions),e&&e.dragOptions&&e.dragOptions.filter&&t.dragManager.addFilter(e.dragOptions.filter),t._createEventListeners(),t._attachEventDelegates(),!1!==e.resizeObserver)try{t._resizeObserver=new ResizeObserver(function(r){r.filter(function(l){var c=t.getAttribute(l.target,Fe);if(null!=c){var h=t.viewport._elementMap.get(c);return!!h&&(h.w!==l.contentRect.width||h.h!==l.contentRect.height)}return!1}).forEach(function(l){return t.revalidate(l.target)})})}catch{Z("WARN: ResizeObserver could not be attached.")}return t}return D(n,[{key:"fireOverlayMethod",value:function(e,t,r){var l=V(e.component instanceof Zt?be:Oe,t);r._jsPlumbOverlay=e,e.fire(t,{e:r,overlay:e}),this.fire(l,e.component,r)}},{key:"addDragFilter",value:function(e,t){this.dragManager.addFilter(e,t)}},{key:"removeDragFilter",value:function(e){this.dragManager.removeFilter(e)}},{key:"setDragGrid",value:function(e){this.dragManager.setOption(this.elementDragHandler,{grid:e})}},{key:"setDragConstrainFunction",value:function(e){this.dragManager.setOption(this.elementDragHandler,{constrainFunction:e})}},{key:"_removeElement",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}},{key:"_appendElement",value:function(e,t){t&&t.appendChild(e)}},{key:"_appendElementToGroup",value:function(e,t){this.getGroupContentArea(e).appendChild(t)}},{key:"_appendElementToContainer",value:function(e){this._appendElement(e,this.getContainer())}},{key:"_getAssociatedElements",value:function(e){var t=[];if(3!==e.nodeType&&8!==e.nodeType){var r=e.querySelectorAll(X);Array.prototype.push.apply(t,r)}return t.filter(function(a){return 3!==a.nodeType&&8!==a.nodeType})}},{key:"shouldFireEvent",value:function(e,t,r){return!0}},{key:"getClass",value:function(e){return function Co(s){return Zn(s)}(e)}},{key:"addClass",value:function(e,t){qe(e,t)}},{key:"hasClass",value:function(e,t){return function xo(s,o){return s.classList?s.classList.contains(o):-1!==Zn(s).indexOf(o)}(e,t)}},{key:"removeClass",value:function(e,t){Jn(e,t)}},{key:"toggleClass",value:function(e,t){!function bo(s,o){var n=this,i=function(t,r){null!=t&&null!=r&&r.length>0&&(t.classList?t.classList.toggle(r):n.hasClass(t,r)?n.removeClass(t,r):n.addClass(t,r))};ut(s)?I(s,function(e){return i(e,o)}):i(s,o)}(e,t)}},{key:"setAttribute",value:function(e,t,r){e.setAttribute(t,r)}},{key:"getAttribute",value:function(e,t){return e.getAttribute(t)}},{key:"setAttributes",value:function(e,t){for(var r in t)e.setAttribute(r,t[r])}},{key:"removeAttribute",value:function(e,t){e.removeAttribute&&e.removeAttribute(t)}},{key:"on",value:function(e,t,r,a){var l=this,c=function(f){null==a?l.eventManager.on(f,t,r):l.eventManager.on(f,t,r,a)};return ut(e)?I(e,function(h){return c(h)}):c(e),this}},{key:"off",value:function(e,t,r){var a=this;return ut(e)?I(e,function(l){return a.eventManager.off(l,t,r)}):this.eventManager.off(e,t,r),this}},{key:"trigger",value:function(e,t,r,a,l){this.eventManager.trigger(e,t,r,a,l)}},{key:"getOffsetRelativeToRoot",value:function(e){return ct(e)}},{key:"getOffset",value:function(e){for(var t=e,r=this.getContainer(),a=this.getPosition(t),l=e!==r&&t.offsetParent!==r?t.offsetParent:null;null!=l;)a.x+=l.offsetLeft,a.y+=l.offsetTop,null!=(p=l)&&p!==document.body&&(p.scrollTop>0||p.scrollLeft>0)&&(a.x-=p.scrollLeft,a.y-=p.scrollTop),l=l.offsetParent===r?null:l.offsetParent;var p;if(null!=r&&(r.scrollTop>0||r.scrollLeft>0)){var h=null!=t.offsetParent?this.getStyle(t.offsetParent,Fr):"static",f=this.getStyle(t,Fr);f!==Rt&&"fixed"!==f&&h!==Rt&&"fixed"!==h&&(a.x-=r.scrollLeft,a.y-=r.scrollTop)}return a}},{key:"getSize",value:function(e){var t=e;return null!=t.offsetWidth?function ko(s){return{w:s.offsetWidth,h:s.offsetHeight}}(e):t.width&&t.width.baseVal?function So(s){try{return{w:parseFloat(s.width.baseVal.value),h:parseFloat(s.height.baseVal.value)}}catch{return{w:0,h:0}}}(t):void 0}},{key:"getPosition",value:function(e){var t=e;return null!=t.offsetLeft?{x:parseFloat(t.offsetLeft),y:parseFloat(t.offsetTop)}:t.x&&t.x.baseVal?function Po(s){try{return{x:parseFloat(s.x.baseVal.value),y:parseFloat(s.y.baseVal.value)}}catch{return{x:0,y:0}}}(t):void 0}},{key:"getStyle",value:function(e,t){return U(window.getComputedStyle)!==jr?getComputedStyle(e,null).getPropertyValue(t):e.currentStyle[t]}},{key:"getGroupContentArea",value:function(e){var t=this.getSelector(e.el,Ra);return t&&t.length>0?t[0]:e.el}},{key:"getSelector",value:function(e,t){var r=null;if(1===arguments.length){if(!Y(e)){var a=document.createDocumentFragment();return a.appendChild(e),cn(a.childNodes)}r=cn(document.querySelectorAll(e))}else r=cn(e.querySelectorAll(t));return r}},{key:"setPosition",value:function(e,t){var r=e;r.style.left=t.x+"px",r.style.top=t.y+"px"}},{key:"setDraggable",value:function(e,t){t?this.removeAttribute(e,pn):this.setAttribute(e,pn,"true")}},{key:"isDraggable",value:function(e){var t=this.getAttribute(e,pn);return null==t||t===pt}},{key:"toggleDraggable",value:function(e){var t=this.isDraggable(e);return this.setDraggable(e,!t),!t}},{key:"_createEventListeners",value:function(){var e=function(m,E){if(!E.defaultPrevented&&null==E._jsPlumbOverlay){var C=Ae(fe(E),_e,this.getContainer(),!0);this.fire(m,C.jtk.connector.connection,E)}};this._connectorClick=e.bind(this,Rr),this._connectorDblClick=e.bind(this,Aa),this._connectorTap=e.bind(this,Ga),this._connectorDblTap=e.bind(this,Oa);var t=function(m,E){var C=fe(E).parentNode;if(C.jtk&&C.jtk.connector){var b=C.jtk.connector,A=b.connection;this.setConnectorHover(b,m),m?(this.addClass(A.source,this.hoverSourceClass),this.addClass(A.target,this.hoverTargetClass)):(this.removeClass(A.source,this.hoverSourceClass),this.removeClass(A.target,this.hoverTargetClass)),this.fire(m?Ma:Da,C.jtk.connector.connection,E)}};this._connectorMouseover=t.bind(this,!0),this._connectorMouseout=t.bind(this,!1);var r=function(m,E){var C=fe(E).parentNode;C.jtk&&C.jtk.connector&&this.fire(m?wa:Ia,C.jtk.connector.connection,E)};this._connectorMouseup=r.bind(this,!0),this._connectorMousedown=r.bind(this,!1),this._connectorContextmenu=function(y){var m=fe(y).parentNode;m.jtk&&m.jtk.connector&&this.fire(La,m.jtk.connector.connection,y)}.bind(this);var a=function(m,E,C){!E.defaultPrevented&&null==E._jsPlumbOverlay&&this.fire(m,C.jtk.endpoint,E)};this._endpointClick=a.bind(this,xa),this._endpointDblClick=a.bind(this,ba);var l=function(m,E){var C=fe(E);C.jtk&&C.jtk.endpoint&&(this.setEndpointHover(C.jtk.endpoint,m),this.fire(m?Sa:ka,C.jtk.endpoint,E))};this._endpointMouseover=l.bind(this,!0),this._endpointMouseout=l.bind(this,!1);var c=function(m,E){var C=fe(E);C.jtk&&C.jtk.endpoint&&this.fire(m?Pa:Ta,C.jtk.endpoint,E)};this._endpointMouseup=c.bind(this,!0),this._endpointMousedown=c.bind(this,!1);var h=function(y,m){var C=Ae(fe(m),Me,this.getContainer(),!0).jtk.overlay;C&&this.fireOverlayMethod(C,y,m)}.bind(this);this._overlayClick=h.bind(this,ae),this._overlayDblClick=h.bind(this,de),this._overlayTap=h.bind(this,ye),this._overlayDblTap=h.bind(this,ve);var f=function(m,E){var b=Ae(fe(E),Me,this.getContainer(),!0).jtk.overlay;b&&this.setOverlayHover(b,m)};this._overlayMouseover=f.bind(this,!0),this._overlayMouseout=f.bind(this,!1),this._elementClick=function(m,E,C){E.defaultPrevented||this.fire(1===E.detail?Lr:pa,C,E)}.bind(this,Lr),this._elementTap=function(m,E,C){E.defaultPrevented||this.fire(Nr,C,E)}.bind(this,Nr),this._elementDblTap=function(m,E,C){E.defaultPrevented||this.fire(Gr,C,E)}.bind(this,Gr);var _=function(m,E){this.fire(m?ya:ga,fe(E),E)};this._elementMouseenter=_.bind(this,!0),this._elementMouseexit=_.bind(this,!1),this._elementMousemove=function(y){this.fire(_a,fe(y),y)}.bind(this),this._elementMouseup=function(y){this.fire(ma,fe(y),y)}.bind(this),this._elementMousedown=function(y){this.fire(Ea,fe(y),y)}.bind(this),this._elementContextmenu=function(y){this.fire(Ca,fe(y),y)}.bind(this)}},{key:"_attachEventDelegates",value:function(){var e=this.getContainer();this.eventManager.on(e,ae,Me,this._overlayClick),this.eventManager.on(e,de,Me,this._overlayDblClick),this.eventManager.on(e,ye,Me,this._overlayTap),this.eventManager.on(e,ve,Me,this._overlayDblTap),this.eventManager.on(e,ae,_e,this._connectorClick),this.eventManager.on(e,de,_e,this._connectorDblClick),this.eventManager.on(e,ye,_e,this._connectorTap),this.eventManager.on(e,ve,_e,this._connectorDblTap),this.eventManager.on(e,ae,Je,this._endpointClick),this.eventManager.on(e,de,Je,this._endpointDblClick),this.eventManager.on(e,ae,this.managedElementsSelector,this._elementClick),this.eventManager.on(e,ye,this.managedElementsSelector,this._elementTap),this.eventManager.on(e,ve,this.managedElementsSelector,this._elementDblTap),this.eventManager.on(e,ge,_e,this._connectorMouseover),this.eventManager.on(e,pe,_e,this._connectorMouseout),this.eventManager.on(e,De,_e,this._connectorContextmenu),this.eventManager.on(e,j,_e,this._connectorMouseup),this.eventManager.on(e,F,_e,this._connectorMousedown),this.eventManager.on(e,ge,Je,this._endpointMouseover),this.eventManager.on(e,pe,Je,this._endpointMouseout),this.eventManager.on(e,j,Je,this._endpointMouseup),this.eventManager.on(e,F,Je,this._endpointMousedown),this.eventManager.on(e,ge,Me,this._overlayMouseover),this.eventManager.on(e,pe,Me,this._overlayMouseout),this.eventManager.on(e,ge,X,this._elementMouseenter),this.eventManager.on(e,pe,X,this._elementMouseexit),this.eventManager.on(e,Q,X,this._elementMousemove),this.eventManager.on(e,j,X,this._elementMouseup),this.eventManager.on(e,F,X,this._elementMousedown),this.eventManager.on(e,De,X,this._elementContextmenu)}},{key:"_detachEventDelegates",value:function(){var e=this.getContainer();e&&(this.eventManager.off(e,ae,this._connectorClick),this.eventManager.off(e,de,this._connectorDblClick),this.eventManager.off(e,ye,this._connectorTap),this.eventManager.off(e,ve,this._connectorDblTap),this.eventManager.off(e,ae,this._endpointClick),this.eventManager.off(e,de,this._endpointDblClick),this.eventManager.off(e,ae,this._overlayClick),this.eventManager.off(e,de,this._overlayDblClick),this.eventManager.off(e,ye,this._overlayTap),this.eventManager.off(e,ve,this._overlayDblTap),this.eventManager.off(e,ae,this._elementClick),this.eventManager.off(e,ye,this._elementTap),this.eventManager.off(e,ve,this._elementDblTap),this.eventManager.off(e,ge,this._connectorMouseover),this.eventManager.off(e,pe,this._connectorMouseout),this.eventManager.off(e,De,this._connectorContextmenu),this.eventManager.off(e,j,this._connectorMouseup),this.eventManager.off(e,F,this._connectorMousedown),this.eventManager.off(e,ge,this._endpointMouseover),this.eventManager.off(e,pe,this._endpointMouseout),this.eventManager.off(e,j,this._endpointMouseup),this.eventManager.off(e,F,this._endpointMousedown),this.eventManager.off(e,ge,this._overlayMouseover),this.eventManager.off(e,pe,this._overlayMouseout),this.eventManager.off(e,fi,this._elementMouseenter),this.eventManager.off(e,di,this._elementMouseexit),this.eventManager.off(e,Q,this._elementMousemove),this.eventManager.off(e,j,this._elementMouseup),this.eventManager.off(e,F,this._elementMousedown),this.eventManager.off(e,De,this._elementContextmenu))}},{key:"setContainer",value:function(e){var r,t=this;if(e===document||e===document.body)throw new Error("Cannot set document or document.body as container element");this._detachEventDelegates(),null!=this.dragManager&&(r=this.dragManager.reset()),this.setAttribute(e,Dr,q().replace("-",""));var a=this.getContainer();null!=a&&(a.removeAttribute(Dr),I(cn(a.childNodes).filter(function(c){return null!=c&&(t.hasClass(c,ni)||t.hasClass(c,dt)||t.hasClass(c,yn)||c.getAttribute&&null!=c.getAttribute(Fe))}),function(c){e.appendChild(c)})),N(O(n.prototype),"setContainer",this).call(this,e),this.containerType=Qn(e),null!=this.eventManager&&this._attachEventDelegates(),null!=this.dragManager&&(this.dragManager.addHandler(new Es(this)),this.dragManager.addHandler(new Cs(this,this.dragSelection),this.groupDragOptions),this.elementDragHandler=new Ai(this,this.dragSelection),this.dragManager.addHandler(this.elementDragHandler,this.elementDragOptions),null!=r&&this.dragManager.setFilters(r))}},{key:"reset",value:function(){N(O(n.prototype),"reset",this).call(this),this._resizeObserver&&this._resizeObserver.disconnect(),I(this.getContainer().querySelectorAll([X,Je,_e,Me].join(",")),function(r){return r.parentNode&&r.parentNode.removeChild(r)})}},{key:"destroy",value:function(){this._detachEventDelegates(),null!=this.dragManager&&this.dragManager.reset(),this.clearDragSelection(),N(O(n.prototype),"destroy",this).call(this)}},{key:"unmanage",value:function(e,t){null!=this._resizeObserver&&this._resizeObserver.unobserve(e),this.removeFromDragSelection(e),N(O(n.prototype),"unmanage",this).call(this,e,t)}},{key:"addToDragSelection",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];I(r,function(l){return e.dragSelection.add(l)})}},{key:"clearDragSelection",value:function(){this.dragSelection.clear()}},{key:"removeFromDragSelection",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];I(r,function(l){return e.dragSelection.remove(l)})}},{key:"toggleDragSelection",value:function(){for(var e=this,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];I(r,function(l){return e.dragSelection.toggle(l)})}},{key:"addToDragGroup",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];(t=this.elementDragHandler).addToDragGroup.apply(t,[e].concat(a))}},{key:"removeFromDragGroup",value:function(){var e;(e=this.elementDragHandler).removeFromDragGroup.apply(e,arguments)}},{key:"setDragGroupState",value:function(e){for(var t,r=arguments.length,a=new Array(r>1?r-1:0),l=1;l<r;l++)a[l-1]=arguments[l];(t=this.elementDragHandler).setDragGroupState.apply(t,[e].concat(a))}},{key:"clearDragGroup",value:function(e){this.elementDragHandler.clearDragGroup(e)}},{key:"consume",value:function(e,t){Gt(e,t)}},{key:"rotate",value:function(e,t,r){var a=this.getId(e);return this._managedElements[a]?(this._managedElements[a].el.style.transform="rotate("+t+"deg)",this._managedElements[a].el.style.transformOrigin="center center",N(O(n.prototype),"rotate",this).call(this,e,t,r)):{c:new Set,e:new Set}}},{key:"addOverlayClass",value:function(e,t){if(Be(e))e.instance.addClass(me(e),t);else if(Ot(e))e.instance.addClass(Jt(e),t);else{if(!Ye(e))throw"Could not add class to overlay of type ["+e.type+"]";e.instance.addClass(at(e),t)}}},{key:"removeOverlayClass",value:function(e,t){if(Be(e))e.instance.removeClass(me(e),t);else if(Ot(e))e.instance.removeClass(Jt(e),t);else{if(!Ye(e))throw"Could not remove class from overlay of type ["+e.type+"]";e.instance.removeClass(at(e),t)}}},{key:"_paintOverlay",value:function(e,t,r){if(Be(e)){me(e);var a=e.component.getXY();e.canvas.style.left=a.x+t.d.minx+"px",e.canvas.style.top=a.y+t.d.miny+"px"}else if(Ot(e))!function Cu(s,o,n,i){Jt(s);var e=[0,0];i.xmin<0&&(e[0]=-i.xmin),i.ymin<0&&(e[1]=-i.ymin),Ee(s.path,{d:o,stroke:n.stroke?n.stroke:null,fill:n.fill?n.fill:null,transform:"translate("+e[0]+","+e[1]+")","pointer-events":"visibleStroke"})}(e,isNaN(t.d.cxy.x)||isNaN(t.d.cxy.y)?"M 0 0":"M"+t.d.hxy.x+","+t.d.hxy.y+" L"+t.d.tail[0].x+","+t.d.tail[0].y+" L"+t.d.cxy.x+","+t.d.cxy.y+" L"+t.d.tail[1].x+","+t.d.tail[1].y+" Z",t,r);else{if(!Ye(e))throw"Could not paint overlay of type ["+e.type+"]";at(e);var c=e.component.getXY();e.canvas.style.left=c.x+t.d.minx+"px",e.canvas.style.top=c.y+t.d.miny+"px"}}},{key:"setOverlayVisible",value:function(e,t){var r=t?"block":"none";function a(l){null!=l&&(l.style.display=r)}Be(e)?a(me(e)):Ye(e)?a(at(e)):Ot(e)&&a(e.path)}},{key:"reattachOverlay",value:function(e,t){Be(e)?e.instance._appendElement(me(e),this.getContainer()):Ye(e)?e.instance._appendElement(at(e),this.getContainer()):Ot(e)&&this._appendElement(Jt(e),t.connector.canvas)}},{key:"setOverlayHover",value:function(e,t){var r;Be(e)?r=me(e):Ye(e)?r=at(e):Ot(e)&&(r=Jt(e)),null!=r&&(null!=this.hoverClass&&(t?this.addClass(r,this.hoverClass):this.removeClass(r,this.hoverClass)),this.setHover(e.component,t))}},{key:"destroyOverlay",value:function(e){if(Be(e)){var t=me(e);t.parentNode.removeChild(t),delete e.canvas,delete e.cachedDimensions}else if(Li(e)||Gi(e)||Ri(e))!function xu(s){var n=s;null!=n.path&&null!=n.path.parentNode&&n.path.parentNode.removeChild(n.path),null!=n.bgPath&&null!=n.bgPath.parentNode&&n.bgPath.parentNode.removeChild(n.bgPath),delete n.path,delete n.bgPath}(e);else if(Ye(e)){var r=at(e);r.parentNode.removeChild(r),delete e.canvas,delete e.cachedDimensions}}},{key:"drawOverlay",value:function(e,t,r,a){if(Be(e)||Ye(e)){var l=Di._getDimensions(e);if(null!=l&&null!=l.w&&null!=l.h){var c={x:0,y:0};if(a)c={x:a.x,y:a.y};else if(t instanceof mt){var h=Array.isArray(e.location)?e.location:[e.location,e.location];c={x:h[0]*t.w,y:h[1]*t.h}}else{var f=e.location,v=!1;(Y(e.location)||e.location<0||e.location>1)&&(f=parseInt(""+e.location,10),v=!0),c=t.pointOnPath(f,v)}var p=c.x-l.w/2,g=c.y-l.h/2;return{component:e,d:{minx:p,miny:g,td:l,cxy:c},xmin:p,xmax:p+l.w,ymin:g,ymax:g+l.h}}return{xmin:0,xmax:0,ymin:0,ymax:0}}if(Li(e)||Gi(e)||Ri(e))return e.draw(t,r,a);throw"Could not draw overlay of type ["+e.type+"]"}},{key:"updateLabel",value:function(e){if(Re(e.label)){var t=e.label(this);me(e).innerText=null!=t?t:""}else null==e.labelText&&(e.labelText=e.label,me(e).innerText=null!=e.labelText?e.labelText:"")}},{key:"setHover",value:function(e,t){e._hover=t,e instanceof kt&&null!=e.endpoint?this.setEndpointHover(e,t,-1):e instanceof Zt&&null!=e.connector&&this.setConnectorHover(e.connector,t)}},{key:"paintConnector",value:function(e,t,r){!function bu(s,o,n,i){(function ku(s,o){if(null!=o.canvas)return o.canvas;var n=Ce("svg",{style:"",width:"0",height:"0","pointer-events":ft,position:Rt});o.canvas=n,s._appendElement(o.canvas,s.getContainer()),null!=o.cssClass&&s.addClass(n,o.cssClass),s.addClass(n,s.connectorClass),n.jtk=n.jtk||{},n.jtk.connector=o})(s,o),Ms.paint(o,s,n,i);var t=[0,0];if(i.xmin<0&&(t[0]=-i.xmin),i.ymin<0&&(t[1]=-i.ymin),o.segments.length>0){var r={d:s.getPathData(o),transform:"translate("+t[0]+","+t[1]+")","pointer-events":"visibleStroke"},a=null;if(n.outlineStroke){var c=n.strokeWidth+2*(n.outlineWidth||1);(a=M({},n)).stroke=n.outlineStroke,a.strokeWidth=c,null==o.bgPath?(o.bgPath=Ce(li,r),s.addClass(o.bgPath,s.connectorOutlineClass),_n(o.canvas,o.bgPath,0)):Ee(o.bgPath,r),ci(0,o.bgPath,a)}var h=o;null==h.path?(h.path=Ce(li,r),_n(h.canvas,h.path,n.outlineStroke?1:0)):(h.path.parentNode!==h.canvas&&_n(h.canvas,h.path,n.outlineStroke?1:0),Ee(o.path,r)),ci(0,o.path,n)}}(this,e,t,r)}},{key:"setConnectorHover",value:function(e,t,r){if(!1===t||!this.currentlyDragging&&!this.isHoverSuspended()){var a=e.canvas;null!=a&&(null!=e.hoverClass&&(t?this.addClass(a,e.hoverClass):this.removeClass(a,e.hoverClass)),t?this.addClass(a,this.hoverClass):this.removeClass(a,this.hoverClass)),null!=e.connection.hoverPaintStyle&&(e.connection.paintStyleInUse=t?e.connection.hoverPaintStyle:e.connection.paintStyle,this._suspendDrawing||this._paintConnection(e.connection)),e.connection.endpoints[0]!==r&&this.setEndpointHover(e.connection.endpoints[0],t,0,!0),e.connection.endpoints[1]!==r&&this.setEndpointHover(e.connection.endpoints[1],t,1,!0)}}},{key:"destroyConnector",value:function(e){null!=e.connector&&Bs(e.connector)}},{key:"addConnectorClass",value:function(e,t){e.canvas&&this.addClass(e.canvas,t)}},{key:"removeConnectorClass",value:function(e,t){e.canvas&&this.removeClass(e.canvas,t)}},{key:"getConnectorClass",value:function(e){return e.canvas?e.canvas.className.baseVal:""}},{key:"setConnectorVisible",value:function(e,t){Vs(e,t)}},{key:"applyConnectorType",value:function(e,t){if(e.canvas&&t.cssClass){var r=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(e.canvas,r.join(" "))}}},{key:"addEndpointClass",value:function(e,t){var r=en(e.endpoint);null!=r&&this.addClass(r,t)}},{key:"applyEndpointType",value:function(e,t){if(t.cssClass){var r=en(e.endpoint);if(r){var a=Array.isArray(t.cssClass)?t.cssClass:[t.cssClass];this.addClass(r,a.join(" "))}}}},{key:"destroyEndpoint",value:function(e){this.removeClass(e.element,this.endpointAnchorClassPrefix+(e.currentAnchorClass?"-"+e.currentAnchorClass:"")),Bs(e.endpoint)}},{key:"renderEndpoint",value:function(e,t){var r=Hs[e.endpoint.type];null!=r?Su.paint(e.endpoint,r,t):Z("jsPlumb: no endpoint renderer found for type ["+e.endpoint.type+"]")}},{key:"removeEndpointClass",value:function(e,t){var r=en(e.endpoint);null!=r&&this.removeClass(r,t)}},{key:"getEndpointClass",value:function(e){var t=en(e.endpoint);return null!=t?t.className:""}},{key:"setEndpointHover",value:function(e,t,r,a){if(null!=e&&(!1===t||!this.currentlyDragging&&!this.isHoverSuspended())){var l=en(e.endpoint);if(null!=l&&(null!=e.hoverClass&&(t?this.addClass(l,e.hoverClass):this.removeClass(l,e.hoverClass)),0===r||1===r)){var c=0===r?this.hoverSourceClass:this.hoverTargetClass;t?this.addClass(l,c):this.removeClass(l,c)}if(null!=e.hoverPaintStyle&&(e.paintStyleInUse=t?e.hoverPaintStyle:e.paintStyle,this._suspendDrawing||this.renderEndpoint(e,e.paintStyleInUse)),!a)for(var h=0;h<e.connections.length;h++)this.setConnectorHover(e.connections[h].connector,t,e)}}},{key:"setEndpointVisible",value:function(e,t){Vs(e.endpoint,t)}},{key:"setGroupVisible",value:function(e,t){for(var r=e.el.querySelectorAll(X),a=0;a<r.length;a++)t?this.show(r[a],!0):this.hide(r[a],!0)}},{key:"deleteConnection",value:function(e,t){return null!=e&&!0!==e.deleted&&(!0!==e.endpoints[0].deleted&&this.setEndpointHover(e.endpoints[0],!1,0,!0),!0!==e.endpoints[1].deleted&&this.setEndpointHover(e.endpoints[1],!1,1,!0),N(O(n.prototype),"deleteConnection",this).call(this,e,t))}},{key:"addSourceSelector",value:function(e,t,r){return this.addDragFilter(e),N(O(n.prototype),"addSourceSelector",this).call(this,e,t,r)}},{key:"removeSourceSelector",value:function(e){this.removeDragFilter(e.selector),N(O(n.prototype),"removeSourceSelector",this).call(this,e)}},{key:"manage",value:function(e,t,r){if(this.containerType===ht.SVG&&!function To(s){return Qn(s)===ht.SVG}(e))throw new Error("ERROR: cannot manage non-svg element when container is an SVG element.");var a=N(O(n.prototype),"manage",this).call(this,e,t,r);return null!=a&&null!=this._resizeObserver&&this._resizeObserver.observe(a.el),a}}]),n}(Xu),Vn=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),u(d(t=o.call(this,i,e)),"width",void 0),u(d(t),"height",void 0),u(d(t),"type",n.type),t.width=(e=e||{}).width||10,t.height=e.height||10,t}return D(n,null,[{key:"_getParams",value:function(e){return{width:e.width,height:e.height}}}]),n}(mt);u(Vn,"type","Rectangle");var qu={type:Vn.type,cls:Vn,compute:function(o,n,i,e){var t=e.width||o.width,r=e.height||o.height,a=n.curX-t/2,l=n.curY-r/2;return o.x=a,o.y=l,o.w=t,o.h=r,[a,l,t,r]},getParams:function(o){return{width:o.width,height:o.height}}},Bn=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),u(d(t=o.call(this,i,e)),"type",n.type),t}return n}(mt);u(Bn,"type","Blank");var Qu={type:Bn.type,cls:Bn,compute:function(o,n,i,e){return o.x=n.curX,o.y=n.curY,o.w=10,o.h=0,[n.curX,n.curY,10,0]},getParams:function(o){return{}}},Ys={width:10,height:0,fill:"transparent",stroke:"transparent"};ji(Tt.type,{makeNode:function(n,i){return Ce("circle",{cx:n.w/2,cy:n.h/2,r:n.radius})},updateNode:function(n,i){Ee(i,{cx:""+n.w/2,cy:""+n.h/2,r:""+n.radius})}}),ji(Bn.type,{makeNode:function(n,i){return Ce("rect",Ys)},updateNode:function(n,i){Ee(i,Ys)}}),ji(Vn.type,{makeNode:function(n,i){return Ce("rect",{width:n.w,height:n.h})},updateNode:function(n,i){Ee(i,{width:n.w,height:n.h})}});var Le=function(s){return s[s.top=0]="top",s[s.bottom=1]="bottom",s}(Le||{}),Hi=new Map;Hi.set(Le.top,[we.TopRight,we.TopLeft]),Hi.set(Le.bottom,[we.BottomRight,we.BottomLeft]);var tc={deriveAnchor:function(o,n,i,e){return Hi.get(o)[n]}},Ui="jtk-scrollable-list",nc=vn(Ui),ic=(D(function s(o,n){var i=this;P(this,s),this.instance=o,u(this,"options",void 0),u(this,"count",void 0),u(this,"lists",void 0),this.count=0,this.lists={},this.options=n||{},this.instance.bind(xr,function(e){for(var t=i.instance.getSelector(e.el,nc),r=0;r<t.length;r++)i.addList(t[r])}),this.instance.bind(kr,function(e){i.removeList(e.el)}),this.instance.bind(ri,function(e,t){if(null==t){var r=i.findParentList(e.target);r?.newConnection(e.connection,e.target,1);var a=i.findParentList(e.source);a?.newConnection(e.connection,e.source,0)}}),this.instance.bind(oi,function(e){var t=e.dropEndpoint.element,r=i.findParentList(t);return null==r||t.offsetTop>=r.domElement.scrollTop&&t.offsetTop+t.offsetHeight<=r.domElement.scrollTop+r.domElement.offsetHeight})},[{key:"addList",value:function(n,i){var e=M({},tc);M(e,this.options),i=M(e,i||{});var t=[this.instance._instanceIndex,this.count++].join("_");return this.lists[t]=new ic(this.instance,n,i,t),this.lists[t]}},{key:"getList",value:function(n){var i=this.instance.getAttribute(n,Ui);if(null!=i)return this.lists[i]}},{key:"removeList",value:function(n){var i=this.getList(n);i&&(i.destroy(),delete this.lists[i.id])}},{key:"findParentList",value:function(n){for(var t,i=n.parentNode,e=this.instance.getContainer();null!=i&&i!==e&&i!==document;){if(null!=(t=this.getList(i)))return t;i=i.parentNode}}}]),function(){function s(o,n,i,e){P(this,s),this.instance=o,this.el=n,this.options=i,this.id=e,u(this,"_scrollHandler",void 0),u(this,"domElement",void 0),u(this,"elId",void 0),this.domElement=n,this.elId=this.instance.getId(n),o.setAttribute(n,Ui,e),this._scrollHandler=this.scrollHandler.bind(this),this.domElement._jsPlumbScrollHandler=this._scrollHandler,o.on(n,"scroll",this._scrollHandler),this._scrollHandler()}return D(s,[{key:"deriveAnchor",value:function(n,i,e,t){return this.options.anchor?this.options.anchor:this.options.deriveAnchor(n,i,e,t)}},{key:"deriveEndpoint",value:function(n,i,e,t){return this.options.deriveEndpoint?this.options.deriveEndpoint(n,i,e,t):this.options.endpoint?this.options.endpoint:e.endpoint.type}},{key:"newConnection",value:function(n,i,e){i.offsetTop<this.el.scrollTop?this._proxyConnection(i,n,e,Le.top):i.offsetTop+i.offsetHeight>this.el.scrollTop+this.domElement.offsetHeight&&this._proxyConnection(i,n,e,Le.bottom)}},{key:"scrollHandler",value:function(){for(var n=this,i=this.instance.getSelector(this.el,X),e=function(a){if(i[a].offsetTop<n.el.scrollTop)i[a]._jsPlumbProxies=i[a]._jsPlumbProxies||[],n.instance.select({source:i[a]}).each(function(c){n._proxyConnection(i[a],c,0,Le.top)}),n.instance.select({target:i[a]}).each(function(c){n._proxyConnection(i[a],c,1,Le.top)});else if(i[a].offsetTop+i[a].offsetHeight>n.el.scrollTop+n.domElement.offsetHeight)i[a]._jsPlumbProxies=i[a]._jsPlumbProxies||[],n.instance.select({source:i[a]}).each(function(c){n._proxyConnection(i[a],c,0,Le.bottom)}),n.instance.select({target:i[a]}).each(function(c){n._proxyConnection(i[a],c,1,Le.bottom)});else if(i[a]._jsPlumbProxies){for(var l=0;l<i[a]._jsPlumbProxies.length;l++)n.instance.unproxyConnection(i[a]._jsPlumbProxies[l][0],i[a]._jsPlumbProxies[l][1]);delete i[a]._jsPlumbProxies}n.instance.revalidate(i[a])},t=0;t<i.length;t++)e(t)}},{key:"_proxyConnection",value:function(n,i,e,t){var r=this;this.instance.proxyConnection(i,e,this.domElement,function(a,l){return r.deriveEndpoint(t,l,i.endpoints[l],i)},function(a,l){return r.deriveAnchor(t,l,i.endpoints[l],i)}),n._jsPlumbProxies=n._jsPlumbProxies||[],n._jsPlumbProxies.push([i,e])}},{key:"destroy",value:function(){this.instance.off(this.el,"scroll",this._scrollHandler),delete this.domElement._jsPlumbScrollHandler;for(var n=this.instance.getSelector(this.el,X),i=0;i<n.length;i++)if(n[i]._jsPlumbProxies){for(var e=0;e<n[i]._jsPlumbProxies.length;e++)this.instance.unproxyConnection(n[i]._jsPlumbProxies[e][0],n[i]._jsPlumbProxies[e][1]);delete n[i]._jsPlumbProxies}}}]),s}());function $s(s){var o=Math.floor(s),n=Math.ceil(s);return s-o<1e-10?o:n-s<1e-10?n:s}var Vi=function(s){L(n,s);var o=k(n);function n(i){var e;return P(this,n),u(d(e=o.call(this,i)),"type",n.segmentType),u(d(e),"cx",void 0),u(d(e),"cy",void 0),u(d(e),"radius",void 0),u(d(e),"anticlockwise",void 0),u(d(e),"startAngle",void 0),u(d(e),"endAngle",void 0),u(d(e),"sweep",void 0),u(d(e),"length",void 0),u(d(e),"circumference",void 0),u(d(e),"frac",void 0),e.cx=i.cx,e.cy=i.cy,e.radius=i.r,e.anticlockwise=i.ac,i.startAngle&&i.endAngle?(e.startAngle=i.startAngle,e.endAngle=i.endAngle,e.x1=e.cx+e.radius*Math.cos(e.startAngle),e.y1=e.cy+e.radius*Math.sin(e.startAngle),e.x2=e.cx+e.radius*Math.cos(e.endAngle),e.y2=e.cy+e.radius*Math.sin(e.endAngle)):(e.startAngle=e._calcAngle(e.x1,e.y1),e.endAngle=e._calcAngle(e.x2,e.y2)),e.endAngle<0&&(e.endAngle+=tt),e.startAngle<0&&(e.startAngle+=tt),e.sweep=Math.abs((e.endAngle<e.startAngle?e.endAngle+tt:e.endAngle)-e.startAngle),e.anticlockwise&&(e.sweep=tt-e.sweep),e.circumference=2*Math.PI*e.radius,e.frac=e.sweep/tt,e.length=e.circumference*e.frac,e.extents={xmin:e.cx-e.radius,xmax:e.cx+e.radius,ymin:e.cy-e.radius,ymax:e.cy+e.radius},e}return D(n,[{key:"_calcAngle",value:function(e,t){return function rl(s,o){var n=yt(s,o),i=Math.atan(n),e=Ci(s,o);return(4==e||3==e)&&(i+=Math.PI),i<0&&(i+=2*Math.PI),i}({x:this.cx,y:this.cy},{x:e,y:t})}},{key:"_calcAngleForLocation",value:function(e,t){if(e.anticlockwise){var r=e.startAngle<e.endAngle?e.startAngle+tt:e.startAngle;return r-Math.abs(r-e.endAngle)*t}var c=Math.abs((e.endAngle<e.startAngle?e.endAngle+tt:e.endAngle)-e.startAngle);return e.startAngle+c*t}},{key:"getPath",value:function(e){var t=this.sweep>Math.PI?1:0;return(e?"M"+this.x1+" "+this.y1+" ":"")+"A "+this.radius+" "+this.radius+" 0 "+t+","+(this.anticlockwise?0:1)+" "+this.x2+" "+this.y2}},{key:"getLength",value:function(){return this.length}},{key:"pointOnPath",value:function(e,t){if(0===e)return{x:this.x1,y:this.y1,theta:this.startAngle};if(1===e)return{x:this.x2,y:this.y2,theta:this.endAngle};t&&(e/=length);var r=this._calcAngleForLocation(this,e),a=this.cx+this.radius*Math.cos(r),l=this.cy+this.radius*Math.sin(r);return{x:$s(a),y:$s(l),theta:r}}},{key:"gradientAtPoint",value:function(e,t){var r=this.pointOnPath(e,t),a=function il(s,o){return-1/yt(s,o)}({x:this.cx,y:this.cy},r);return!this.anticlockwise&&(a===1/0||a===-1/0)&&(a*=-1),a}},{key:"pointAlongPathFrom",value:function(e,t,r){var a=this.pointOnPath(e,r),l=t/this.circumference*2*Math.PI,h=a.theta+(this.anticlockwise?-1:1)*l;return{x:this.cx+this.radius*Math.cos(h),y:this.cy+this.radius*Math.sin(h)}}}]),n}(vi);u(Vi,"segmentType","Arc");var Ks=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),(t=o.call(this,i,e)).connection=i,u(d(t),"showLoopback",void 0),u(d(t),"curviness",void 0),u(d(t),"margin",void 0),u(d(t),"proximityLimit",void 0),u(d(t),"orientation",void 0),u(d(t),"loopbackRadius",void 0),u(d(t),"clockwise",void 0),u(d(t),"isLoopbackCurrently",void 0),u(d(t),"geometry",null),t.showLoopback=!1!==(e=e||{}).showLoopback,t.curviness=e.curviness||10,t.margin=e.margin||5,t.proximityLimit=e.proximityLimit||80,t.clockwise=e.orientation&&"clockwise"===e.orientation,t.loopbackRadius=e.loopbackRadius||25,t.isLoopbackCurrently=!1,t}return D(n,[{key:"getDefaultStubs",value:function(){return[0,0]}},{key:"_compute",value:function(e,t){var r=t.sourcePos,a=t.targetPos,l=Math.abs(r.curX-a.curX),c=Math.abs(r.curY-a.curY);if(this.showLoopback&&t.sourceEndpoint.elementId===t.targetEndpoint.elementId){this.isLoopbackCurrently=!0;var h=t.sourcePos.curX,f=t.sourcePos.curY-this.margin,v=h,p=f-this.loopbackRadius,g=v-this.loopbackRadius,_=p-this.loopbackRadius;l=2*this.loopbackRadius,c=2*this.loopbackRadius,e.points[0]=g,e.points[1]=_,e.points[2]=l,e.points[3]=c,this._addSegment(Vi,{loopback:!0,x1:h-g+4,y1:f-_,startAngle:0,endAngle:2*Math.PI,r:this.loopbackRadius,ac:!this.clockwise,x2:h-g-4,y2:f-_,cx:v-g,cy:p-_})}else this.isLoopbackCurrently=!1,this._computeBezier(e,t,r,a,l,c)}},{key:"exportGeometry",value:function(){return null==this.geometry?null:{controlPoints:[M({},this.geometry.controlPoints[0]),M({},this.geometry.controlPoints[1])],source:M({},this.geometry.source),target:M({},this.geometry.target)}}},{key:"transformGeometry",value:function(e,t,r){return{controlPoints:[{x:e.controlPoints[0].x+t,y:e.controlPoints[0].y+r},{x:e.controlPoints[1].x+t,y:e.controlPoints[1].y+r}],source:this.transformAnchorPlacement(e.source,t,r),target:this.transformAnchorPlacement(e.target,t,r)}}},{key:"importGeometry",value:function(e){return!(null==e||(null==e.controlPoints||2!=e.controlPoints.length?(Z("jsPlumb Bezier: cannot import geometry; controlPoints missing or does not have length 2"),this.setGeometry(null,!0),1):null==e.controlPoints[0].x||null==e.controlPoints[0].y||null==e.controlPoints[1].x||null==e.controlPoints[1].y?(Z("jsPlumb Bezier: cannot import geometry; controlPoints malformed"),this.setGeometry(null,!0),1):null==e.source||null==e.source.curX||null==e.source.curY?(Z("jsPlumb Bezier: cannot import geometry; source missing or malformed"),this.setGeometry(null,!0),1):null==e.target||null==e.target.curX||null==e.target.curY?(Z("jsPlumb Bezier: cannot import geometry; target missing or malformed"),this.setGeometry(null,!0),1):(this.setGeometry(e,!1),0)))}}]),n}(Ln),Se_subtract=function(o,n){return{x:o.x-n.x,y:o.y-n.y}},Se_dotProduct=function(o,n){return o.x*n.x+o.y*n.y},Se_square=function(o){return Math.sqrt(o.x*o.x+o.y*o.y)},Se_scale=function(o,n){return{x:o.x*n,y:o.y*n}},zs=64,rc=Math.pow(2,-zs-1);function sc(s,o){for(var h,n=[],i=function ac(s,o){for(var n=o.length-1,i=2*n-1,e=[],t=[],r=[],a=[],l=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;c<=n;c++)e[c]=Se_subtract(o[c],s);for(var h=0;h<=n-1;h++)t[h]=Se_subtract(o[h+1],o[h]),t[h]=Se_scale(t[h],3);for(var f=0;f<=n-1;f++)for(var v=0;v<=n;v++)r[f]||(r[f]=[]),r[f][v]=Se_dotProduct(t[f],e[v]);for(var p=0;p<=i;p++)a[p]||(a[p]=[]),a[p].y=0,a[p].x=parseFloat(""+p)/i;for(var g=n,_=n-1,y=0;y<=g+_;y++)for(var m=Math.max(0,y-_),E=Math.min(y,g),C=m;C<=E;C++){var b=y-C;a[C+b].y+=r[b][C]*l[b][C]}return a}(s,o),e=o.length-1,r=Bi(i,2*e-1,n,0),a=Se_subtract(s,o[0]),l=Se_square(a),c=0,f=0;f<r;f++)a=Se_subtract(s,Yi(o,e,n[f],null,null)),(h=Se_square(a))<l&&(l=h,c=n[f]);return a=Se_subtract(s,o[e]),(h=Se_square(a))<l&&(l=h,c=1),{location:c,distance:l}}function Bi(s,o,n,i){var r,a,e=[],t=[],l=[],c=[];switch(function lc(s,o){var i,e,n=0;i=e=hn(s[0].y);for(var t=1;t<=o;t++)(i=hn(s[t].y))!=e&&n++,e=i;return n}(s,o)){case 0:return 0;case 1:if(i>=zs)return n[0]=(s[0].x+s[o].x)/2,1;if(function uc(s,o){var i,e,t,a,l,c,y,E,C;a=s[0].y-s[o].y,l=s[o].x-s[0].x,c=s[0].x*s[o].y-s[o].x*s[0].y,E=C=0;for(var b=1;b<o;b++){var A=a*s[b].x+l*s[b].y+c;A>E?E=A:A<C&&(C=A)}return i=(1*(c-E)-(y=l)*0)*(1/(0*y-a*1)),e=(1*(c-C)-0*(y=l))*(1/(0*y-1*a)),t=Math.min(i,e),Math.max(i,e)-t<rc?1:0}(s,o))return n[0]=function cc(s,o){var e=s[o].x-s[0].x,t=s[o].y-s[0].y;return 0+1*((e*(s[0].y-0)-t*(s[0].x-0))*(1/(0*e-1*t)))}(s,o),1}Yi(s,o,.5,e,t),r=Bi(e,o,l,i+1),a=Bi(t,o,c,i+1);for(var h=0;h<r;h++)n[h]=l[h];for(var f=0;f<a;f++)n[f+r]=c[f];return r+a}function Yi(s,o,n,i,e){for(var t=[[]],r=0;r<=o;r++)t[0][r]=s[r];for(var a=1;a<=o;a++)for(var l=0;l<=o-a;l++)t[a]||(t[a]=[]),t[a][l]||(t[a][l]={}),t[a][l].x=(1-n)*t[a-1][l].x+n*t[a-1][l+1].x,t[a][l].y=(1-n)*t[a-1][l].y+n*t[a-1][l+1].y;if(null!=i)for(var c=0;c<=o;c++)i[c]=t[c][0];if(null!=e)for(var h=0;h<=o;h++)e[h]=t[o-h][h];return t[o][0]}function fc(s,o){var n={x:0,y:0};if(0===s)return o[0];var i=o.length-1;if(1===s)return o[i];var e=o,t=1-s;if(0===i)return o[0];if(1===i)return{x:t*e[0].x+s*e[1].x,y:t*e[0].y+s*e[1].y};if(4>i){var c,h,f,r=t*t,a=s*s,l=0;return 2===i?(e=[e[0],e[1],e[2],n],c=r,h=t*s*2,f=a):3===i&&(c=r*t,h=r*s*3,f=t*a*3,l=s*a),{x:c*e[0].x+h*e[1].x+f*e[2].x+l*e[3].x,y:c*e[0].y+h*e[1].y+f*e[2].y+l*e[3].y}}return n}var qs=new Map;function tn(s,o){for(var n=function vc(s){var o=qs.get(s);if(!o){var e=function(p){return function(g){return p}},a=function(p){return function(g){for(var _=1,y=0;y<p.length;y++)_*=p[y](g);return _}};(o=[]).push(function(p){return Math.pow(p,s)});for(var l=1;l<s;l++){for(var c=[e(s)],h=0;h<s-l;h++)c.push(function(p){return p});for(var f=0;f<l;f++)c.push(function(p){return 1-p});o.push(a(c))}o.push(function(p){return Math.pow(1-p,s)}),qs.set(s,o)}return o}(s.length-1),i=0,e=0,t=0;t<s.length;t++)i+=s[t].x*n[t](o),e+=s[t].y*n[t](o);return{x:i,y:e}}function Zs(s,o){return Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2))}function Js(s){return s[0].x===s[1].x&&s[0].y===s[1].y}function Yn(s,o,n){if(Js(s))return{point:s[0],location:o};for(var i=tn(s,o),e=0,t=o,r=n>0?1:-1,a=null;e<Math.abs(n);)e+=Zs(a=tn(s,t+=.005*r),i),i=a;return{point:a,location:t}}function Ge(s,o,n,i,e){var t=i-o,r=s-n,a=s*(o-i)+o*(n-s),l=function yc(s){return[Qs(s,"x"),Qs(s,"y")]}(e),h=_c.apply(null,[t*l[0][0]+r*l[1][0],t*l[0][1]+r*l[1][1],t*l[0][2]+r*l[1][2],t*l[0][3]+r*l[1][3]+a]),f=[];if(null!=h)for(var v=0;v<3;v++){var m,p=h[v],g=Math.pow(p,2),_=Math.pow(p,3),y={x:l[0][0]*_+l[0][1]*g+l[0][2]*p+l[0][3],y:l[1][0]*_+l[1][1]*g+l[1][2]*p+l[1][3]};m=n-s!=0?(y[0]-s)/(n-s):(y[1]-o)/(i-o),p>=0&&p<=1&&m>=0&&m<=1&&f.push(y)}return f}function Qs(s,o){return[3*s[1][o]-s[0][o]+-3*s[2][o]+s[3][o],3*s[0][o]-6*s[1][o]+3*s[2][o],-3*s[0][o]+3*s[1][o],s[0][o]]}function _c(s,o,n,i){var h,f,e=o/s,t=n/s,r=i/s,a=(3*t-Math.pow(e,2))/9,l=(9*e*t-27*r-2*Math.pow(e,3))/54,c=Math.pow(a,3)+Math.pow(l,2),v=[0,0,0];if(c>=0)h=hn(l+Math.sqrt(c))*Math.pow(Math.abs(l+Math.sqrt(c)),1/3),f=hn(l-Math.sqrt(c))*Math.pow(Math.abs(l-Math.sqrt(c)),1/3),v[0]=-e/3+(h+f),v[1]=-e/3-(h+f)/2,v[2]=-e/3-(h+f)/2,0!==Math.abs(Math.sqrt(3)*(h-f)/2)&&(v[1]=-1,v[2]=-1);else{var p=Math.acos(l/Math.sqrt(-Math.pow(a,3)));v[0]=2*Math.sqrt(-a)*Math.cos(p/3)-e/3,v[1]=2*Math.sqrt(-a)*Math.cos((p+2*Math.PI)/3)-e/3,v[2]=2*Math.sqrt(-a)*Math.cos((p+4*Math.PI)/3)-e/3}for(var g=0;g<3;g++)(v[g]<0||v[g]>1)&&(v[g]=-1);return v}var Wi=function(s){L(n,s);var o=k(n);function n(i){var e;return P(this,n),u(d(e=o.call(this,i)),"curve",void 0),u(d(e),"cp1x",void 0),u(d(e),"cp1y",void 0),u(d(e),"cp2x",void 0),u(d(e),"cp2y",void 0),u(d(e),"length",0),u(d(e),"type",n.segmentType),e.cp1x=i.cp1x,e.cp1y=i.cp1y,e.cp2x=i.cp2x,e.cp2y=i.cp2y,e.x1=i.x1,e.x2=i.x2,e.y1=i.y1,e.y2=i.y2,e.curve=[{x:e.x1,y:e.y1},{x:e.cp1x,y:e.cp1y},{x:e.cp2x,y:e.cp2y},{x:e.x2,y:e.y2}],e.extents={xmin:Math.min(e.x1,e.x2,e.cp1x,e.cp2x),ymin:Math.min(e.y1,e.y2,e.cp1y,e.cp2y),xmax:Math.max(e.x1,e.x2,e.cp1x,e.cp2x),ymax:Math.max(e.y1,e.y2,e.cp1y,e.cp2y)},e}return D(n,[{key:"getPath",value:function(e){return(e?"M "+this.x2+" "+this.y2+" ":"")+"C "+this.cp2x+" "+this.cp2y+" "+this.cp1x+" "+this.cp1y+" "+this.x1+" "+this.y1}},{key:"pointOnPath",value:function(e,t){return e=n._translateLocation(this.curve,e,t),tn(this.curve,e)}},{key:"gradientAtPoint",value:function(e,t){return e=n._translateLocation(this.curve,e,t),function Xi(s,o){var n=tn(s,o),i=tn(s.slice(0,s.length-1),o),e=i.y-n.y;return 0===e?1/0:Math.atan(e/(i.x-n.x))}(this.curve,e)}},{key:"pointAlongPathFrom",value:function(e,t,r){return e=n._translateLocation(this.curve,e,r),function pc(s,o,n){return Yn(s,o,n).point}(this.curve,e,t)}},{key:"getLength",value:function(){return(null==this.length||0===this.length)&&(this.length=function dc(s){var o=0;if(!Js(s))for(var i=function hc(s,o){var n=[];s--;for(var i=0;i<=s;i++)n.push(fc(i/s,o));return n}(16,s),e=0;e<15;e++)o+=Zs(i[e],i[e+1]);return o}(this.curve)),this.length}},{key:"findClosestPointOnPath",value:function(e,t){var r=function oc(s,o){var n=sc(s,o);return{point:Yi(o,o.length-1,n.location,null,null),location:n.location}}({x:e,y:t},this.curve);return{d:Math.sqrt(Math.pow(r.point.x-e,2)+Math.pow(r.point.y-t,2)),x:r.point.x,y:r.point.y,l:1-r.location,s:this,x1:null,y1:null,x2:null,y2:null}}},{key:"lineIntersection",value:function(e,t,r,a){return Ge(e,t,r,a,this.curve)}}],[{key:"_translateLocation",value:function(e,t,r){return r&&(t=function gc(s,o,n){return Yn(s,o,n).location}(e,t>0?0:1,t)),t}}]),n}(vi);u(Wi,"segmentType","Bezier");var $i=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),(t=o.call(this,i,e)).connection=i,u(d(t),"type",n.type),u(d(t),"majorAnchor",void 0),u(d(t),"minorAnchor",void 0),t.majorAnchor=(e=e||{}).curviness||150,t.minorAnchor=10,t}return D(n,[{key:"getCurviness",value:function(){return this.majorAnchor}},{key:"_findControlPoint",value:function(e,t,r,a,l){var h={x:0,y:0};return a[0]!==l[0]||a[1]===l[1]?(h.x=0===l[0]?r.curX<t.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:e.x+this.majorAnchor*l[0],h.y=0===l[1]?r.curY<t.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:e.y+this.majorAnchor*a[1]):(h.x=0===a[0]?t.curX<r.curX?e.x+this.minorAnchor:e.x-this.minorAnchor:e.x-this.majorAnchor*a[0],h.y=0===a[1]?t.curY<r.curY?e.y+this.minorAnchor:e.y-this.minorAnchor:e.y+this.majorAnchor*l[1]),h}},{key:"_computeBezier",value:function(e,t,r,a,l,c){var h,f,v=r.curX<a.curX?l:0,p=r.curY<a.curY?c:0,g=r.curX<a.curX?0:l,_=r.curY<a.curY?0:c;!0!==this.edited?(h=this._findControlPoint({x:v,y:p},r,a,e.so,e.to),f=this._findControlPoint({x:g,y:_},a,r,e.to,e.so)):(h=this.geometry.controlPoints[0],f=this.geometry.controlPoints[1]),this.geometry={controlPoints:[h,f],source:t.sourcePos,target:t.targetPos},this._addSegment(Wi,{x1:v,y1:p,x2:g,y2:_,cp1x:h.x,cp1y:h.y,cp2x:f.x,cp2y:f.y})}}]),n}(Ks);u($i,"type","Bezier");var Ki=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),(t=o.call(this,i,e)).connection=i,u(d(t),"type",n.type),u(d(t),"_controlPoint",void 0),t.curviness=e.curviness||10,t.margin=e.margin||5,t.proximityLimit=e.proximityLimit||80,t.clockwise=e.orientation&&"clockwise"===e.orientation,t}return D(n,[{key:"_computeBezier",value:function(e,t,r,a,l,c){var E,C,b,A,h=r.curX<a.curX?0:l,f=r.curY<a.curY?0:c,v=r.curX<a.curX?l:0,p=r.curY<a.curY?c:0;if(0===r.x&&(h-=this.margin),1===r.x&&(h+=this.margin),0===r.y&&(f-=this.margin),1===r.y&&(f+=this.margin),0===a.x&&(v-=this.margin),1===a.x&&(v+=this.margin),0===a.y&&(p-=this.margin),1===a.y&&(p+=this.margin),!0!==this.edited){var g=(h+v)/2,_=(f+p)/2,y=function mc(s,o,n,i){return s<=n&&i<=o?1:s<=n&&o<=i?2:n<=s&&i>=o?3:4}(h,f,v,p),m=Math.sqrt(Math.pow(v-h,2)+Math.pow(p-f,2));this._controlPoint=function Ec(s,o,n,i,e,t,r,a,l){return a<=l?{x:s,y:o}:1===n?i.curY<=0&&e.curY>=1?{x:s+(i.x<.5?-1*t:t),y:o}:i.curX>=1&&e.curX<=0?{x:s,y:o+(i.y<.5?-1*r:r)}:{x:s+-1*t,y:o+-1*r}:2===n?i.curY>=1&&e.curY<=0?{x:s+(i.x<.5?-1*t:t),y:o}:i.curX>=1&&e.curX<=0?{x:s,y:o+(i.y<.5?-1*r:r)}:{x:s+t,y:o+-1*r}:3===n?i.curY>=1&&e.curY<=0?{x:s+(i.x<.5?-1*t:t),y:o}:i.curX<=0&&e.curX>=1?{x:s,y:o+(i.y<.5?-1*r:r)}:{x:s+-1*t,y:o+-1*r}:4===n?i.curY<=0&&e.curY>=1?{x:s+(i.x<.5?-1*t:t),y:o}:i.curX<=0&&e.curX>=1?{x:s,y:o+(i.y<.5?-1*r:r)}:{x:s+t,y:o+-1*r}:void 0}(g,_,y,t.sourcePos,t.targetPos,this.curviness,this.curviness,m,this.proximityLimit)}else this._controlPoint=this.geometry.controlPoints[0];E=this._controlPoint.x,C=this._controlPoint.x,b=this._controlPoint.y,A=this._controlPoint.y,this.geometry={controlPoints:[this._controlPoint,this._controlPoint],source:t.sourcePos,target:t.targetPos},this._addSegment(Wi,{x1:v,y1:p,x2:h,y2:f,cp1x:E,cp1y:b,cp2x:C,cp2y:A})}}]),n}(Ks);function eo(s){return s<0?-1:0===s?0:1}function to(s){return[eo(s[2]-s[0]),eo(s[3]-s[1])]}function no(s){return Math.sqrt(Math.pow(s[0]-s[2],2)+Math.pow(s[1]-s[3],2))}function io(s){var o=[];return o.push.apply(o,s),o}u(Ki,"type","StateMachine"),Qt_register($i.type,$i),Qt_register(Ki.type,Ki);var zi=function(s){L(n,s);var o=k(n);function n(i,e){var t;return P(this,n),(t=o.call(this,i,e)).connection=i,u(d(t),"type",n.type),u(d(t),"internalSegments",[]),u(d(t),"midpoint",void 0),u(d(t),"alwaysRespectStubs",void 0),u(d(t),"cornerRadius",void 0),u(d(t),"lastx",void 0),u(d(t),"lasty",void 0),u(d(t),"lastOrientation",void 0),u(d(t),"loopbackRadius",void 0),u(d(t),"isLoopbackCurrently",void 0),t.midpoint=null==e.midpoint||isNaN(e.midpoint)?.5:e.midpoint,t.cornerRadius=null!=e.cornerRadius?e.cornerRadius:0,t.alwaysRespectStubs=!0===e.alwaysRespectStubs,t.lastx=null,t.lasty=null,t.lastOrientation=null,t.loopbackRadius=e.loopbackRadius||25,t.isLoopbackCurrently=!1,t}return D(n,[{key:"getDefaultStubs",value:function(){return[30,30]}},{key:"addASegment",value:function(e,t,r){if(this.lastx!==e||this.lasty!==t){var a=null==this.lastx?r.sx:this.lastx,l=null==this.lasty?r.sy:this.lasty,c=a===e?"v":"h";this.lastx=e,this.lasty=t,this.internalSegments.push([a,l,e,t,c])}}},{key:"writeSegments",value:function(e){for(var r,a,l,t=null,c=0;c<this.internalSegments.length-1;c++){if(t=t||io(this.internalSegments[c]),r=io(this.internalSegments[c+1]),a=to(t),l=to(r),this.cornerRadius>0&&t[4]!==r[4]){var h=Math.min(no(t),no(r)),f=Math.min(this.cornerRadius,h/2);t[2]-=a[0]*f,t[3]-=a[1]*f,r[0]+=l[0]*f,r[1]+=l[1]*f;var v=a[1]===l[0]&&1===l[0]||a[1]===l[0]&&0===l[0]&&a[0]!==l[1]||a[1]===l[0]&&-1===l[0],_=(r[1]>t[3]?1:-1)==(r[0]>t[2]?1:-1),y=_&&v||!_&&!v?r[0]:t[2],m=_&&v||!_&&!v?t[3]:r[1];this._addSegment(st,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]}),this._addSegment(Vi,{r:f,x1:t[2],y1:t[3],x2:r[0],y2:r[1],cx:y,cy:m,ac:v})}else this._addSegment(st,{x1:t[0],y1:t[1],x2:t[2],y2:t[3]});t=r}null!=r&&this._addSegment(st,{x1:r[0],y1:r[1],x2:r[2],y2:r[3]})}},{key:"_compute",value:function(e,t){var r=this;this.internalSegments.length=0,this.lastx=null,this.lasty=null,this.lastOrientation=null;var a=function(S){return[e.startStubX,e.startStubY,e.endStubX,e.endStubY]},c={perpendicular:a,orthogonal:a,opposite:function(S){var x=e,R="x"===S?0:1;return!r.alwaysRespectStubs&&{x:function(){return 1===x.so[R]&&(x.startStubX>x.endStubX&&x.tx>x.startStubX||x.sx>x.endStubX&&x.tx>x.sx)||-1===x.so[R]&&(x.startStubX<x.endStubX&&x.tx<x.startStubX||x.sx<x.endStubX&&x.tx<x.sx)},y:function(){return 1===x.so[R]&&(x.startStubY>x.endStubY&&x.ty>x.startStubY||x.sy>x.endStubY&&x.ty>x.sy)||-1===x.so[R]&&(x.startStubY<x.endStubY&&x.ty<x.startStubY||x.sy<x.endStubY&&x.ty<x.sy)}}[S]()?{x:[(e.sx+e.tx)/2,e.startStubY,(e.sx+e.tx)/2,e.endStubY],y:[e.startStubX,(e.sy+e.ty)/2,e.endStubX,(e.sy+e.ty)/2]}[S]:[e.startStubX,e.startStubY,e.endStubX,e.endStubY]}}[e.anchorOrientation](e.sourceAxis),h="x"===e.sourceAxis?0:1,f="x"===e.sourceAxis?1:0,v=c[h],p=c[f],g=c[h+2],_=c[f+2];this.addASegment(c[0],c[1],e);var y=e.startStubX+(e.endStubX-e.startStubX)*this.midpoint,m=e.startStubY+(e.endStubY-e.startStubY)*this.midpoint,E={x:[0,1],y:[1,0]},b={perpendicular:function(S,x,R,G,B){var Mt={x:[[e.startStubX,e.endStubX],null,[e.endStubX,e.startStubX]],y:[[e.startStubY,e.endStubY],null,[e.endStubY,e.startStubY]]},Xn={x:[e.startStubY,e.endStubY],y:[e.startStubX,e.endStubX]},Zi=E[S][1],Ji=e.so[E[S][0]]+1,Qi=-1===e.to[Zi]&&Xn[S][1]<Xn[S][0]||1===e.to[Zi]&&Xn[S][1]>Xn[S][0],oo=Mt[S][Ji][0],ao=Mt[S][Ji][1],lt={x:[[[1,2,3,4],null,[2,1,4,3]],null,[[4,3,2,1],null,[3,4,1,2]]],y:[[[3,2,1,4],null,[2,3,4,1]],null,[[4,1,2,3],null,[1,4,3,2]]]}[S][Ji][e.to[Zi]+1];return e.segment===lt[3]||e.segment===lt[2]&&Qi?{x:[[y,e.startStubY],[y,e.endStubY]],y:[[e.startStubX,m],[e.endStubX,m]]}[S]:e.segment===lt[2]&&ao<oo?{x:[[e.endStubX,e.startStubY]],y:[[e.startStubX,e.endStubY]]}[S]:e.segment===lt[2]&&ao>=oo||e.segment===lt[1]&&!Qi?{x:[[e.startStubX,m],[e.endStubX,m],[e.endStubX,e.endStubY]],y:[[y,e.startStubY],[y,e.endStubY],[e.endStubX,e.endStubY]]}[S]:e.segment===lt[0]||e.segment===lt[1]&&Qi?{x:[[e.startStubX,e.endStubY],[e.endStubX,e.endStubY]],y:[[e.endStubX,e.startStubY],[e.endStubX,e.endStubY]]}[S]:void 0},orthogonal:function(S,x,R,G,B){var T=e,ie={x:-1===T.so[0]?Math.min(x,G):Math.max(x,G),y:-1===T.so[1]?Math.min(x,G):Math.max(x,G)}[S];return{x:[[ie,R],[ie,B],[G,B]],y:[[R,ie],[B,ie],[B,G]]}[S]},opposite:function(S,x,R,G,B){var T=e,ie={x:"y",y:"x"}[S],Mt={x:"h",y:"w"}[S],$e=T["is"+S.toUpperCase()+"GreaterThanStubTimes2"];if(t.sourceEndpoint.elementId===t.targetEndpoint.elementId){var he=R+(1-t.sourceEndpoint._anchor.computedPosition[ie])*t.sourceInfo[Mt]+r.maxStub;return{x:[[x,he],[G,he]],y:[[he,x],[he,G]]}[S]}return!$e||1===T.so[h]&&x>G||-1===T.so[h]&&x<G?{x:[[x,m],[G,m]],y:[[y,x],[y,G]]}[S]:1===T.so[h]&&x<G||-1===T.so[h]&&x>G?{x:[[y,T.sy],[y,T.ty]],y:[[T.sx,m],[T.tx,m]]}[S]:void 0}}[e.anchorOrientation](e.sourceAxis,v,p,g,_);if(b)for(var A=0;A<b.length;A++)this.addASegment(b[A][0],b[A][1],e);this.addASegment(c[2],c[3],e),this.addASegment(e.tx,e.ty,e),this.writeSegments(e)}},{key:"transformGeometry",value:function(e,t,r){return e}}]),n}(Ln);function Cc(){var s=Math.floor(2e3*Math.random()),o=Math.floor(2e3*Math.random());return{clientX:s,clientY:o,screenX:s,screenY:o,pageX:s,pageY:o}}u(zi,"type","Flowchart"),Qt_register(zi.type,zi),Ue.registerHandler(Du),Ue.registerHandler(qu),Ue.registerHandler(Qu),Qt_register(jn.type,jn);for(var Dt={clientX:5e4,clientY:5e4,screenX:5e4,screenY:5e4,pageX:5e4,pageY:5e4},xc=[],nn=0;nn<256;nn++)xc[nn]=(nn<16?"0":"")+nn.toString(16);D(function s(o,n,i){P(this,s),this._jsPlumb=o,this.ok=n,this.equal=i,u(this,"_divs",[]),u(this,"mottle",void 0),this.mottle=new mi},[{key:"_t",value:function(n,i,e,t){this.mottle.trigger(n,i,{pageX:e,pageY:t,screenX:e,screenY:t,clientX:e,clientY:t})}},{key:"addDiv",value:function(n,i,e,t,r,a,l){var c=document.createElement("div");return c.style.position="absolute",c.innerHTML=n,i?i.appendChild(c):this._jsPlumb.getContainer().appendChild(c),c.setAttribute("id",n),c.style.left=(t??Math.floor(1e3*Math.random()))+"px",c.style.top=(r??Math.floor(1e3*Math.random()))+"px",e&&(c.className=e),a&&(c.style.width=a+"px"),l&&(c.style.height=l+"px"),this._divs.push(n),c}},{key:"addDivs",value:function(n,i){for(var e=0;e<n.length;e++)this.addDiv(n[e],i)}},{key:"assertEndpointCount",value:function(n,i){var e=this._jsPlumb.getEndpoints(n);this.equal(e?e.length:0,i,n.getAttribute("data-jtk-managed")+" has "+i+(i>1||0==i?" endpoints":" endpoint"))}},{key:"_assertManagedEndpointCount",value:function(n,i){var e=this._jsPlumb.getId(n);this.equal(this._jsPlumb._managedElements[e].endpoints.length,i,e+" has "+i+" endpoints in managed record")}},{key:"_assertManagedConnectionCount",value:function(n,i){var e=this._jsPlumb.getId(n);this.equal(this._jsPlumb._managedElements[e].connections.length,i,e+" has "+i+" connections in managed record")}},{key:"_registerDiv",value:function(n){this._divs.push(n)}},{key:"makeDragStartEvt",value:function(n){var i=this.makeEvent(n),e=this._jsPlumb.getContainer();return i.clientX+=e.offsetLeft,i.screenX+=e.offsetLeft,i.pageX+=e.offsetLeft,i.clientY+=e.offsetTop,i.screenY+=e.offsetTop,i.pageY+=e.offsetTop,i}},{key:"getAttribute",value:function(n,i){return n.getAttribute(i)}},{key:"dragNodeBy",value:function(n,i,e,t){(t=t||{}).before&&t.before();var r=this.makeEvent(n);this._jsPlumb.trigger(n,F,r),t.beforeMouseMove&&t.beforeMouseMove(),this._t(document,Q,r.pageX+i,r.pageY+e),t.beforeMouseUp&&t.beforeMouseUp(),this.mottle.trigger(document,j,null),t.after&&t.after()}},{key:"dragNodeTo",value:function(n,i,e,t){t=t||{};var r=this._jsPlumb.viewport.getPosition(this._jsPlumb.getId(n));t.before&&t.before();var a=this.makeEvent(n);this._jsPlumb.trigger(n,F,a);var l=this._jsPlumb.getContainer().getBoundingClientRect();t.beforeMouseMove&&t.beforeMouseMove(),this._t(document,Q,l.x+i+r.w/2,l.y+e+r.h/2),t.beforeMouseUp&&t.beforeMouseUp(),this.mottle.trigger(document,j,null),t.after&&t.after()}},{key:"dragToGroup",value:function(n,i,e){var t=this._jsPlumb.getGroup(i),r=this._jsPlumb.viewport.getPosition(t.elId);this.dragNodeTo(n,r.x+r.w/2,r.y+r.h/2,e)}},{key:"aSyncDragNodeBy",value:function(n,i,e,t){var r=this;(t=t||{}).before&&t.before();var a=this.makeEvent(n);this._jsPlumb.trigger(n,F,a),t.beforeMouseMove&&t.beforeMouseMove(),setTimeout(function(){r._t(document,Q,a.pageX+i,a.pageY+e),t.beforeMouseUp&&t.beforeMouseUp(),setTimeout(function(){r.mottle.trigger(document,j,null),t.after&&t.after()},45)},45)}},{key:"dragANodeAround",value:function(n,i,e){this._jsPlumb.trigger(n,F,this.makeEvent(n));for(var t=50*Math.random(),r=0;r<t;r++){var a=Cc();n.style.left=a.screenX+"px",n.style.top=a.screenY+"px",this._jsPlumb.trigger(document,Q,a)}i&&this.ok(i(),e||"while dragging assert"),this._jsPlumb.trigger(document,j,Dt)}},{key:"dragConnection",value:function(n,i,e,t){var r=this.getCanvas(n),a=this.getCanvas(i),l=this.makeEvent(r),c=this.makeEvent(a);t=t||{};var h=this._jsPlumb.select().length;return this._jsPlumb.trigger(r,F,l),t.beforeMouseMove&&t.beforeMouseMove(),this._jsPlumb.trigger(e?a:document,Q,c),t.beforeMouseUp&&t.beforeMouseUp(),this._jsPlumb.trigger(e?a:document,j,c),this._jsPlumb.select().get(h)}},{key:"aSyncDragConnection",value:function(n,i,e){var t=this;e=e||{};var r=this.getCanvas(n),a=this.getCanvas(i),l=this.makeEvent(r),c=this.makeEvent(a),h=this._jsPlumb.select().length;this._jsPlumb.trigger(r,F,l),setTimeout(function(){e.beforeMouseMove&&e.beforeMouseMove(),t._jsPlumb.trigger(document,Q,c),setTimeout(function(){e.beforeMouseUp&&e.beforeMouseUp(),t._jsPlumb.trigger(a,j,c),e.after&&e.after(t._jsPlumb.select().get(h))},5)},5)}},{key:"dragAndAbortConnection",value:function(n){var i=this.getCanvas(n),e=this.makeEvent(i);this._jsPlumb.trigger(i,F,e),this._jsPlumb.trigger(document,Q,Dt),this._jsPlumb.trigger(document,j,Dt)}},{key:"detachConnection",value:function(n,i){i=i||{};var e=this.getEndpointCanvas(n),t=this.makeEvent(e);i.before&&i.before(),this._jsPlumb.trigger(e,F,t),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(document,Q,Dt),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(document,j,Dt),i.after&&i.after()}},{key:"detachAndReattachConnection",value:function(n,i){i=i||{};var e=this.getEndpointCanvas(n),t=this.makeEvent(e);i.before&&i.before(),this._jsPlumb.trigger(e,F,t),i.beforeMouseMove&&i.beforeMouseMove(),this._jsPlumb.trigger(document,Q,Dt),this._jsPlumb.trigger(document,Q,t),i.beforeMouseUp&&i.beforeMouseUp(),this._jsPlumb.trigger(document,j,t),i.after&&i.after()}},{key:"detachConnectionByTarget",value:function(n,i){this.detachConnection(n.endpoints[1],i)}},{key:"relocateTarget",value:function(n,i,e){this.relocate(n,1,i,e)}},{key:"relocate",value:function(n,i,e,t){t=t||{},e=this.getCanvas(e);var r=this.getEndpointCanvas(n.endpoints[i]),a=this.makeEvent(r),l=this.makeEvent(e);t.before&&t.before(),this._jsPlumb.trigger(r,F,a),t.beforeMouseMove&&t.beforeMouseMove(),this._jsPlumb.trigger(document,Q,l),t.beforeMouseUp&&t.beforeMouseUp(),this._jsPlumb.trigger(e,j,l),t.after&&t.after()}},{key:"relocateSource",value:function(n,i,e){this.relocate(n,0,i,e)}},{key:"makeEvent",value:function(n){var i=n.getBoundingClientRect(),e=i.x+i.width/2,t=i.y+i.height/2;return{clientX:e,clientY:t,screenX:e,screenY:t,pageX:e,pageY:t}}},{key:"getCanvas",value:function(n){return n.endpoint?this.getEndpointCanvas(n):n}},{key:"getEndpointCanvas",value:function(n){return n.endpoint.canvas}},{key:"getConnectionCanvas",value:function(n){return n.connector.canvas}},{key:"getEndpointCanvasPosition",value:function(n){var i=this.getEndpointCanvas(n);return{x:parseInt(i.style.left,10),y:parseInt(i.style.top,10),w:i.getAttribute("width"),h:i.getAttribute("height")}}},{key:"within",value:function(n,i,e){this.ok(Math.abs(n-i)<1e-11,e+"[expected: "+i+" got "+n+"] [diff:"+Math.abs(n-i)+"]")}},{key:"assertManagedEndpointCount",value:function(n,i){var e=this._jsPlumb.getId(n);this.equal(this._jsPlumb._managedElements[e].endpoints.length,i,e+" has "+i+" endpoints in managed record")}},{key:"assertManagedConnectionCount",value:function(n,i){var e=this._jsPlumb.getId(n);this.equal(this._jsPlumb._managedElements[e].connections.length,i,e+" has "+i+" connections in managed record")}},{key:"fireEventOnEndpoint",value:function(n){for(var i=this.getEndpointCanvas(n),e=0;e<(arguments.length<=1?0:arguments.length-1);e++)this._jsPlumb.trigger(i,e+1<1||arguments.length<=e+1?void 0:arguments[e+1])}},{key:"fireEventOnElement",value:function(n){for(var i=0;i<(arguments.length<=1?0:arguments.length-1);i++)this._jsPlumb.trigger(n,i+1<1||arguments.length<=i+1?void 0:arguments[i+1])}},{key:"fireEventOnConnection",value:function(n){for(var i=this.getConnectionCanvas(n),e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];this.fireEventOnElement.apply(this,[i].concat(t))}},{key:"clickOnConnection",value:function(n){this.fireEventOnConnection(n,ae)}},{key:"dblClickOnConnection",value:function(n){this.fireEventOnConnection(n,de)}},{key:"tapOnConnection",value:function(n){this.fireEventOnConnection(n,F),this.fireEventOnConnection(n,j)}},{key:"dblTapOnConnection",value:function(n){this.fireEventOnConnection(n,F),this.fireEventOnConnection(n,j),this.fireEventOnConnection(n,F),this.fireEventOnConnection(n,j)}},{key:"clickOnElement",value:function(n,i){this._jsPlumb.trigger(n,ae,null,null,i??1)}},{key:"dblClickOnElement",value:function(n){this._jsPlumb.trigger(n,de)}},{key:"tapOnElement",value:function(n){this._jsPlumb.trigger(n,F),this._jsPlumb.trigger(n,j)}},{key:"dblTapOnElement",value:function(n){this._jsPlumb.trigger(n,F),this._jsPlumb.trigger(n,j),this._jsPlumb.trigger(n,F),this._jsPlumb.trigger(n,j)}},{key:"getOverlayCanvas",value:function(n){return n.canvas||n.path}},{key:"fireEventOnOverlay",value:function(n,i,e){var t=n.getOverlay(i),r=this.getOverlayCanvas(t);this._jsPlumb.trigger(r,e)}},{key:"clickOnOverlay",value:function(n,i){this.fireEventOnOverlay(n,i,ae)}},{key:"dblClickOnOverlay",value:function(n,i){this.fireEventOnOverlay(n,i,de)}},{key:"tapOnOverlay",value:function(n,i){this.fireEventOnOverlay(n,i,F),this.fireEventOnOverlay(n,i,j)}},{key:"dblTapOnOverlay",value:function(n,i){this.fireEventOnOverlay(n,i,F),this.fireEventOnOverlay(n,i,j),this.fireEventOnOverlay(n,i,F),this.fireEventOnOverlay(n,i,j)}},{key:"cleanup",value:function(){var n=this._jsPlumb.getContainer();for(var i in this._jsPlumb.destroy(),this._divs){var e=document.getElementById(this._divs[i]);e&&e.parentNode.removeChild(e)}this._divs.length=0;var t=this._jsPlumb.select().length,r=this._jsPlumb.selectEndpoints().length,a=n.querySelectorAll(".jtk-endpoint").length,l=n.querySelectorAll(".jtk-connector").length;for(var c in n.__ta)for(var h in n.__ta[c])throw"Container event bindings not empty for key "+c;if(t>0)throw"there are connections in the data model!";if(r>0)throw"there are endpoints in the data model!";if(a>0)throw"there are "+a+" endpoints left in the dom!";if(l>0)throw"there are "+l+" connections left in the dom!"}},{key:"makeContent",value:function(n){var i=document.createElement("div");return i.innerHTML=n,i.firstChild}},{key:"length",value:function(n){var i=0;for(var e in n)n.hasOwnProperty(e)&&i++;return i}},{key:"head",value:function(n){for(var i in n)return n[i]}},{key:"uuid",value:function(){return q()}}]);var so=0;function Sc(s){return new $u(function kc(){var s=so+1;return so++,s}(),s)}function Pc(s){!function n(){/complete|loaded|interactive/.test(document.readyState)&&typeof document.body<"u"&&null!=document.body?s():setTimeout(n,9)}()}},5293:(rn,Pe,$)=>{$.d(Pe,{A:()=>K});const P={randomUUID:typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let re;const D=new Uint8Array(16);function u(){if(!re&&(re=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!re))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return re(D)}const L=[];for(let k=0;k<256;++k)L.push((k+256).toString(16).slice(1));const K=function d(k,H,N){if(P.randomUUID&&!H&&!k)return P.randomUUID();const ue=(k=k||{}).random||(k.rng||u)();if(ue[6]=15&ue[6]|64,ue[8]=63&ue[8]|128,H){N=N||0;for(let ce=0;ce<16;++ce)H[N+ce]=ue[ce];return H}return function O(k,H=0){return L[k[H+0]]+L[k[H+1]]+L[k[H+2]]+L[k[H+3]]+"-"+L[k[H+4]]+L[k[H+5]]+"-"+L[k[H+6]]+L[k[H+7]]+"-"+L[k[H+8]]+L[k[H+9]]+"-"+L[k[H+10]]+L[k[H+11]]+L[k[H+12]]+L[k[H+13]]+L[k[H+14]]+L[k[H+15]]}(ue)}}}]);